/*!
 * ebook5 version 4.1.20.0 180819
 * https://www.ebook5.net
 * Date: 19 Aug. 2018
 *
 * Copyright Luler Inc. 
 * More infomation available at 
 * https://www.ebook5.net/license
 * Author by Universal Plus,Inc.
 *
 * Requires jQuery v1.8+
 * Copyright John Resig (http://jquery.com/)
 *
 * Includes jQuery Mousewheel 
 * Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net/)
 * Licensed under the MIT License.
 *
 */

/************************************************************/
function startebook(n){function rt(){var t=location.hash||window.location.hash,n;return t.match(/^#page[0-9]+$/)?(n=parseInt(t.replace("#page","")),n--,n):-1}var s,h,r,c,y,e,p,l,a,t,i,u,tt,it,d;$("meta[name=viewport]").attr("content","width=device-width,initial-scale=1,user-scalable=no");s=["bookmark_thumb_url","link_thumb_url","spacegif_url","sp_icon_path"];for(t in s)ebook.data[s[t]]=ebook.data.img_cmn_base_path+ebook.data[s[t]];if(ebook.data.ClassPageToolBar=typeof ClassPageToolBar==_undefined?"#ctrl_header ":ClassPageToolBar,ebook.data.ClassPageToolBar_left=typeof ClassPageToolBar_left==_undefined?"#ctrl_header .leftpage":ClassPageToolBar_left,ebook.data.ClassPageToolBar_right=typeof ClassPageToolBar_right==_undefined?"#ctrl_header .rightpage":ClassPageToolBar_right,ebook.data.ClassMainToolBar=typeof ClassMainToolBar==_undefined?"#ctrl_footer ":ClassMainToolBar,ebook.data.bookmark_imgSize=new Size(26,64),ebook.data.bookmark_imgOffs=new Position(10,0),ebook.PageFlipper.realMousePos=new Point(0,0),ebook.PageFlipper.basePage_size=new Size(500,0),ebook.PageFlipper.canvas_size=new Size(300,0),ebook.PageFlipper.diaplayPage_size=new Size(300,0),ebook.PageFlipper.diaplayPage_offset=new Position(40,50),ebook.Compatibility.checkDevice(),ebook.Compatibility.isTabletDevice||ebook.Compatibility.isSmartPhone)$("html").on("touchmove",function(n){return n.originalEvent.touches.length>1?!1:$(n.target).parents(".enable_move")?void 0:!1});ebook.BookData=typeof n===_undefined?ebook_data:n;typeof ebook.BookData.pageTitleText==_undefined&&(ebook.BookData.pageTitleText=[]);typeof ebook.BookData.pageTextContents==_undefined&&(ebook.BookData.pageTextContents=[]);var g=["pageImgSize","pageImgSize_thumb","pageImgSize_large","pageImgPathList","pageImgPathList_thumb","pageImgPathList_large","pageTitleText","pageTextContents"],nt=["pageImgPathList","pageImgPathList_thumb","pageImgPathList_large","pageTitleText","pageTextContents"],f=[];for(t in g)r=g[t]||"",typeof ebook.BookData[r]==_undefined&&f.push(r+" is required,");if(f.length>0){alert(f.join("\n"));return}h=-1;for(t in nt)r=nt[t]||"",typeof ebook.BookData[r]!="object"?f.push(r+" is not array object."):(h<0&&(h=ebook.BookData[r].length),ebook.BookData[r].length!=h&&f.push(r+"("+ebook.BookData[r].length+") is different length."));typeof ebook.BookData.local==_undefined&&(ebook.BookData.local="ja");c=$("html").prop("xml:lang")||$("html").prop("lang")||ebook.BookData.local;ebook.data.context[c]||(c="en");y=["search_paging_text","search_result","search_not_found","download_this_page","download_all_page","cancel","download"];for(t in y)e=y[t],typeof ebook.data["context_"+e]!=_undefined&&ebook.data["context_"+e]||(ebook.data["context_"+e]=ebook.data.context[c][e]);if(f.length>0){alert(f.join("\n"));return}if(typeof ebook.BookData.pageLinkContents==_undefined&&(ebook.BookData.pageLinkContents={}),typeof ebook.BookData.pageTopDirectionIsLeft==_undefined&&(ebook.BookData.pageTopDirectionIsLeft=!0),typeof ebook.BookData.use_pageFooterToolbar==_undefined&&(ebook.BookData.use_pageFooterToolbar=!0),typeof ebook.BookData.use_pageSideToolbar==_undefined&&(ebook.BookData.use_pageSideToolbar=!0),typeof ebook.BookData.use_largeImage==_undefined&&(ebook.BookData.use_largeImage=!0),typeof ebook.BookData.use_bookReflection==_undefined&&(ebook.BookData.use_bookReflection=!1),typeof ebook.BookData.autoPlayInterval==_undefined&&(ebook.BookData.autoPlayInterval=5),typeof ebook.BookData.pageShadow==_undefined&&(ebook.BookData.pageShadow=!1),typeof ebook.BookData.pageRollShadow==_undefined&&(ebook.BookData.pageRollShadow=!0),typeof ebook.BookData.maxScaleX1==_undefined&&(ebook.BookData.maxScaleX1=!1),typeof ebook.BookData.SetBookmarkCallBack==_undefined&&(ebook.BookData.SetBookmarkCallBack=function(n){}),typeof ebook.BookData.PageChangeCallBack==_undefined&&(ebook.BookData.PageChangeCallBack=function(n){}),typeof ebook.BookData.PageZoomCallBack==_undefined&&(ebook.BookData.PageZoomCallBack=function(n){}),typeof ebook.BookData.LinkClickCallBack==_undefined&&(ebook.BookData.LinkClickCallBack=function(n,t){}),typeof ebook.BookData.ZoomNarrowRectCallBack==_undefined&&(ebook.BookData.ZoomNarrowRectCallBack=function(n,t){}),typeof ebook.BookData.ZoomWideRectCallBack==_undefined&&(ebook.BookData.ZoomWideRectCallBack=function(n,t,i){}),typeof ebook.BookData.DownloadCallBack==_undefined&&(ebook.BookData.DownloadCallBack=function(n,t){}),typeof ebook.BookData.PrintPageCallBack==_undefined&&(ebook.BookData.PrintPageCallBack=function(n,t){}),typeof ebook.BookData.SearchKeywordCallBack==_undefined&&(ebook.BookData.SearchKeywordCallBack=function(n){}),typeof ebook.BookData.LoadingAfterCallBack==_undefined&&(ebook.BookData.LoadingAfterCallBack=function(){}),typeof ebook.BookData.LoadingBeforeCallBack==_undefined&&(ebook.BookData.LoadingBeforeCallBack=function(){}),typeof ebook.BookData.KeywordSearchCallBack==_undefined&&(ebook.BookData.KeywordSearchCallBack=function(n){}),typeof ebook.BookData.KeywordClearCallBack==_undefined&&(ebook.BookData.KeywordClearCallBack=function(n){}),typeof ebook.BookData.narrowContentsPageListBeforeCallBack==_undefined&&(ebook.BookData.narrowContentsPageListBeforeCallBack=function(){}),typeof ebook.BookData.narrowContentsPageListAfterCallBack==_undefined&&(ebook.BookData.narrowContentsPageListAfterCallBack=function(){}),typeof ebook.BookData.pageNoCahe==_undefined&&(ebook.BookData.pageNoCahe=!1),typeof ebook.BookData.use_WidePageToolBar==_undefined&&(ebook.BookData.use_WidePageToolBar=!0),typeof ebook.BookData.use_NarrowTools==_undefined&&(ebook.BookData.use_NarrowTools=!0),typeof ebook.BookData.youtubeDefaultUrl==_undefined&&(ebook.BookData.youtubeDefaultUrl="https://www.youtube.com/embed/(ID:)?f=videos&amp;app=youtube_gdata&amp;autoplay=1&amp;id=youtubeVideo"),typeof ebook.BookData.googlemapApiV3DefaultUrl==_undefined&&(ebook.BookData.googlemapApiV3DefaultUrl="http://maps.google.com/maps/api/js?"),(typeof ebook.BookData.use_Download==_undefined||typeof ebook.BookData.downloadList==_undefined)&&(ebook.BookData.use_Download=!1,ebook.BookData.downloadList={}),typeof ebook.BookData.singlePageMdoe==_undefined&&(ebook.BookData.singlePageMdoe=!1),typeof ebook.BookData.use_TextView==_undefined&&(ebook.BookData.use_TextView=!1),typeof ebook.BookData.enableFlash==_undefined&&(ebook.BookData.enableFlash=!0),ebook.BookData.singlePageMdoe&&(ebook.PageWide=ebook.SingleView),initOptinalLayer(),ebook.BookData.use_Download&&(p=0,$("#menu_download").each(function(){p++}),p==0&&$("ul#navi>li#end_dummy").each(function(){$(this).before('<li id="menu_download" style="display:block;"><a href="javascript:void(0);" title="Download">Download<\/a><\/li>')}),initDownloadDialog()),typeof ebook.BookData.pageDummyImagePath==_undefined&&(ebook.BookData.pageDummyImagePath=ebook.data.img_cmn_base_path+"pagedummy.gif"),typeof ebook.BookData.autoSizeEvenPages==_undefined&&(ebook.BookData.autoSizeEvenPages=!0),typeof ebook.BookData.pageHintEnable==_undefined&&(ebook.BookData.pageHintEnable=!1),ebook.BookData.pageHintEnable&&(typeof ebook.BookData.pageHintImageSize!=_undefined&&(pageHintImageSize=ebook.BookData.pageHintEnable),typeof ebook.BookData.pageHintImageUrl!=_undefined&&(pageHintImageSize=ebook.BookData.pageHintImageUrl),typeof ebook.BookData.pageHintInfoUrl!=_undefined&&(pageHintInfoUrl=ebook.BookData.pageHintInfoUrl)),typeof ebook.BookData.pageListTitleBlankPackEnable==_undefined&&(ebook.BookData.pageListTitleBlankPackEnable=!1),typeof ebook.BookData.initLoadingThumbSkipEnable==_undefined&&(ebook.BookData.initLoadingThumbSkipEnable=!1),typeof ebook.BookData.linkopenNatural==_undefined&&ebook.Compatibility.isIE&&(ebook.BookData.linkopenNatural=!0),typeof ebook.BookData.linkopenNatural==_undefined&&(ebook.BookData.linkopenNatural=!1),ebook.Compatibility.isAndroid&&(l=$("meta[name=viewport]"),a=l.attr("content"),/target-densitydpi/i.test(a)||(ebook.Compatibility.isKindle?l.attr("content",a+",target-densitydpi=device-dpi,"):l.attr("content",a+",target-densitydpi=medium-dpi"))),(!ebook.Compatibility.isIE||ebook.Compatibility.isIEver>=9)&&$("html").addClass("html5"),ebook.Compatibility.isIPad&&$("body").addClass("ipadClass"),ebook.Compatibility.isSmartPhone&&($("body").addClass("smartphoneClass"),setInterval(function(){$("#narrowContentsPageList").is(":visible")||hideAddress(!0)},500)),ebook.BookData.autoSizeEvenPages){var w=ebook.BookData.pageDummyImagePath,b=ebook.BookData.pageImgPathList,v=ebook.BookData.pageImgPathList_thumb,k=ebook.BookData.pageImgPathList_large,o=b.length>v.length?b.length:v.length>k.length?v.length:k.length;for(o+=o%2,t=b.length;t<o;t++)ebook.BookData.pageImgPathList.push(w);for(t=v.length;t<o;t++)ebook.BookData.pageImgPathList_thumb.push(w);for(t=k.length;t<o;t++)ebook.BookData.pageImgPathList_large.push(w)}if(ebook.BookData.pageImgPathList.length!=ebook.BookData.pageTitleText.length||ebook.BookData.pageImgPathList.length!=ebook.BookData.pageTextContents.length)for(ip_l=ebook.BookData.pageImgPathList.length,t=0;t<ip_l;t++)typeof ebook.BookData.pageTitleText[t]==_undefined&&(ebook.BookData.pageTitleText[t]="Page "+(t+1)),typeof ebook.BookData.pageTextContents[t]==_undefined&&(ebook.BookData.pageTextContents[t]="");ebook.BookData.PageJump=function(n){setTimeout(function(){var t=getPageNum(n-1);pageView_jumpPage(t)},0)};ebook.BookData.GetPageImgPath=function(n){var t=ebook.BookData.pageImgPathList[n];return ebook.BookData.pageNoCahe?t+"?"+(new Date).getTime():t};ebook.BookData.GetPageImgThumbPath=function(n){return ebook.BookData.pageImgPathList_thumb[n]};ebook.BookData.GetPageImgLargePath=function(n){return ebook.BookData.pageImgPathList_large[n]};$("html").on("contextmenu",function(){return!1});if(i=getQueryParameter(),!0&&i.print+""!=_undefined&&i.type+""!=_undefined&&i.page+""!=_undefined){printingPage(i);return}u=0;!0&&typeof i.print===_undefined&&i.page+""!=_undefined&&(u=parseInt(i.page),u--,ebook.data.firstPageRequest=u);!0&&typeof i.print===_undefined&&i.search+""!=_undefined&&(tt=i.search,$("input.search_text").val(tt),ebook.BookData.initLoadingThumbSkipEnable=1,it=ebook.BookData.LoadingAfterCallBack,ebook.BookData.LoadingAfterCallBack=function(){it();setTimeout(function(){$(".search_box .search_btn").trigger("click")},2e3)});(location.hash||window.location.hash)&&(u=rt(),location.hash="");$(window).on("hashchange",function(){var n=rt();n>=0&&(location.hash="",pageView_jumpPage(getPageNum(n)))});if(ebook.BookData.use_pageSideToolbar||(ebook.data.stageTopMargin=0),ebook.BookData.use_pageFooterToolbar||(ebook.data.stageFootMargin=18),ebook.Compatibility.isSupportCanvas&&!ebook.Compatibility.isTouchDevice)$(ebook.Compatibility.isIE?"html":window).on(leb.e.mm,function(n){return ebook.PageFlipper.realMousePos=new Point(n.pageX,n.pageY),!0});ebook.PageFlipper.pageCount=ebook.BookData.pageImgPathList_thumb.length;u<0&&(u=0);u>=ebook.PageFlipper.pageCount&&(u=ebook.PageFlipper.pageCount-1);d=getPageNum(u);ebook.PageFlipper.narrowCurrentPageNum=d;ebook.PageWide.zoomPage_pageNum=d;ebook.PageFlipper.currentPageNum_left=ebook.PageFlipper.narrowCurrentPageNum%2==0?ebook.PageFlipper.narrowCurrentPageNum-1:ebook.PageFlipper.narrowCurrentPageNum;ui_init();$("html").on("selectstart",function(){return!1});$("html").on("dblclick",function(n){return n.preventDefault(),!1});if(ebook.Compatibility.isTouchDevice){$("#canvas_base").on(leb.e.ts+".pagemove",ebook.PageFlipper.EVENT_page_mousedown_canvas);$("#row_page").hide()}else if(ebook.Compatibility.isSupportCanvas){$("#canvas_base").on(leb.e.md+".pagemove",ebook.PageFlipper.EVENT_page_mousedown_canvas);$("#canvas_base").on(leb.e.mm+".pagemove",ebook.PageFlipper.EVENT_page_mouseover_canvas);$("#row_page").hide()}else $("#canvas1,#canvas2").hide();ebook.Compatibility.isAndroid&&$("*").css({"-webkit-tap-highlight-color":"rgba(0,0,0,0) !important"});$("#navi>li>a").empty().attr("title","");bindPinchTouchAction("#canvas",function(){return!0},function(n,t){if(ebook.PageFlipper.isWideMode()){if($("#sub_scrwindow").is(":visible"))return;if(n.scale>1)return t.preventDefault(),m_move_clear(),n.firstEvent.pageX=n.firstPoint.x,n.firstEvent.pageY=n.firstPoint.y,ebook.PageFlipper.pageNumAdd(),ebook.PageFlipper.changeZoomPage(n.firstEvent),!1}});ebook.PageWide.initZoomView();$(ebook.data.ClassMainToolBar).hide();ebook.PageFlipper.initNarrowPage();closeScrwindow();loadingProgress_init();autoPlay(!1);ebook.data.bookmarktag_img=new Image;ebook.data.bookmarktag_img.src=ebook.data.bookmark_thumb_url;ebook.data.spacer_img=new Image;ebook.data.spacer_img.src=ebook.data.spacegif_url;setTimeout(function(){ebookLoadData()},100)}function ebookLoadData(){var i,r,n,t,u;if(loading_now=!0,i=ebook.BookData.pageImgPathList_thumb,ebook.PageFlipper.pageCount=i.length,ebook.Compatibility.isTouchDevice||ebook.BookData.initLoadingThumbSkipEnable)setTimeout(function(){ebookLoaded()},100);else for(r=ebook.PageFlipper.pageCount,ebook.data.loading_stack=r,waitLoading(),n=0;n<r;n++)if(i[n]){t=new Image;try{t.onload=initOnLoad;t.src=i[n]}catch(f){u=ebook.data.loading_stack;ebook.data.loading_stack=0;loading_now=!1;alert("loading error "+u);break}t.complete&&initOnLoad();ebook.pageCache.pagess[n]=t}loading_now=!1}function initOnLoad(){ebook.data.loading_stack>0&&ebook.data.loading_stack--;loadingProgress_call(ebook.PageFlipper.pageCount,ebook.data.loading_stack)}function waitLoading(){ebook.data.loading_stack!=0||loading_now?setTimeout(function(){waitLoading()},100):setTimeout(function(){ebookLoaded()},100)}function loadingimage(n){return _bgLoadingImageFunc(n,initOnLoad)}function m_move_clear(){ebook.PageFlipper.handleStartPos=!1;ebook.PageFlipper.handlePos_old=!1;ebook.PageFlipper.hit_startPageSide=!1;ebook.PageFlipper.moveHandlePos=!1;ebook.data.auto_move=!1;ebook.PageFlipper.pageDrag_status=!1}function loadingProgress_init(){ebook.BookData.LoadingBeforeCallBack();$("body").append('<div id="progressbar" class="theme_bcolor"><div class="ui-progressbar-value theme_hcolor" ><\/div><\/div>');$("#progressbar .ui-progressbar-value").css("width","0%");$("#progressbar").show()}function loadingProgress_end(){$("#progressbar").hide()}function loadingProgress_call(n,t){var r=$("#progressbar").width(),i=parseInt((n-t)*100/n);$("#progressbar .ui-progressbar-value").css("width",i+"%").text(i+"%("+(n-t)+"/"+n+")")}function ebookLoaded(){$(window).on("scroll",function(n){return n.preventDefault(),!1});loadingProgress_end();makeToolsbars();keybordInit();pageHintInit();ebook.BookData.use_TextView&&ebook.PageTextView&&ebook.PageTextView.init();EVENT_resizeContainer();zoom_fit();$(window).on("resize_page",function(n){EVENT_resizeContainer(n);zoom_fit(n)});var n=!1;$(window).on("resize",function(t){ebook.Compatibility.isTouchDevice||(n&&clearInterval(n),n=setTimeout(function(){n=!1;$(window).trigger("resize_page")},1e3/30))});$(window).on("orientationchange",function(t){n&&clearInterval(n);n=setTimeout(function(){n=!1;$(window).trigger("resize_page")},100)});ebook.BookData.LoadingAfterCallBack()}function keybordInit(){ebook._event.key_ctrl=!1;ebook._event.key_shift=!1;$("body").on("keyup keydown",function(n){var t=n||window.event;ebook.Compatibility.isIE6&&(t=window.event);switch(t.keyCode){case 16:ebook._event.key_shift=t.type=="keydown";break;case 17:ebook._event.key_ctrl=t.type=="keydown";break}}).on("keyup keypress",function(n){var t=n||window.event,r,i;if(ebook.Compatibility.isIE6&&(t=window.event),r=!0,$(":focus").each(function(){var n=this.tagName.toLowerCase();if(/(input|textarea|select)/.test(n))return r=!1,!1}),r)if(ebook.PageFlipper.isWideMode()){if($("#ctrl_panel").hasClass("open")&&t.type=="keyup")switch(t.keyCode){case 27:ebook.PageTool.openSidePanel(!0);break}if($("#sub_scrwindow").is(":visible")){if(t.type=="keyup")switch(t.keyCode){case 27:$("#sub_scrwindow").is(":visible")?closeScrwindow():$("#sub_contents_block").is(":visible")&&$("#sub_contents_block .menu_back").click();break}return}if(t.type=="keyup")switch(t.keyCode){case 37:case 188:i=ebook._event.key_ctrl?0:ebook.PageFlipper.currentPageNum_left-1;pageView_jumpPage(i);break;case 39:case 190:i=ebook._event.key_ctrl?ebook.PageFlipper.pageCount-1:ebook.PageFlipper.currentPageNum_left+2;pageView_jumpPage(i);break;case 76:ebook.PageTool.openPageListMenu();break;case 80:ebook.PageTool.openPrintMenu();break;case 84:ebook.PageTool.openThumbListMenu();break;case 32:pageView_jumpPage(ebook.PageFlipper.currentPageNum_left+(ebook.BookData.pageTopDirectionIsLeft?2:-1));break;case 90:ebook.PageFlipper.changeZoomPage(!1);break;case 65:ebook.PageTextView&&ebook.PageTextView.viewchange();break}else if(t.type=="keypress")switch(t.which){case 43:break;case 45:break}}else if(ebook.PageFlipper.isZoomMode()){if($("#ctrl_panel").hasClass("open")&&t.type=="keyup")switch(t.keyCode){case 27:ebook.PageTool.openSidePanel(!0);break}if($("#l_canvas").is(":visible")&&t.type=="keyup")switch(t.keyCode){case 27:$("#l_canvas").is(":visible")&&$("#l_canvas .z_close").click();break}if(t.type=="keyup")switch(t.keyCode){case 37:case 188:i=ebook._event.key_ctrl?0:ebook.PageFlipper.currentPageNum_left-1;pageView_jumpPage(i);break;case 39:case 190:i=ebook._event.key_ctrl?ebook.PageFlipper.pageCount-1:ebook.PageFlipper.currentPageNum_left+2;pageView_jumpPage(i);break}}})}function autoPlay(n,t){if(autoPlayFlag){if(!(ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount+1)||!(ebook.PageFlipper.currentPageNum_left>=-1)){stopAutoPlay();return}var i=ebook.BookData.autoPlayInterval*1e3;if(typeof t!=_undefined&&(i=t),typeof n==_undefined&&(n=!1),ebook.Compatibility.isSupportCanvas){if(ebook.PageFlipper.pageDrag_status)i=100;else if(!ebook.PageFlipper.Html5.makeAutoPageMove(ebook.BookData.pageTopDirectionIsLeft))return}else ebook.data.auto_pageNext=ebook.BookData.pageTopDirectionIsLeft?2:-2,ebook.PageFlipper.pageNumAdd();setTimeout(function(){autoPlay(!0)},i)}}function startAutoPlay(){if(getPageNum(ebook.PageFlipper.currentPageNum_left)>=ebook.PageFlipper.pageCount-1){stopAutoPlay();return}autoPlayFlag=!autoPlayFlag;autoPlayFlag?($(ClassPlayButton).addClass("now_playing"),setTimeout(function(){autoPlay()},1e3)):stopAutoPlay()}function stopAutoPlay(){$(ClassPlayButton).removeClass("now_playing");autoPlayFlag=!1}function EVENT_resizeContainer(n){isOrientationchange=typeof n!=_undefined&&n.type.toLowerCase()=="orientationchange";_EVENT_resizeContainer++;_EVENT_resizeContainer>1&&!isOrientationchange;var t=new Date;_EVENT_resizeContainer_lasttim=(new Date).getTime();$("body").addClass("resize");setTimeout(function(){onResize_changeViewerMode();$("body").removeClass("resize");setTimeout(function(){onResize_setViewrMode();_EVENT_resizeContainer=0},1)},isOrientationchange?1:ebook.Compatibility.isAndroid?400:300)}function onResize_changeViewerMode(){var n=$(window).height(),t=$(window).width(),i,r;ebook.Compatibility.checkViewPort();ebook.Compatibility.viewport.width&&(t=ebook.Compatibility.viewport.width,n=ebook.Compatibility.viewport.height);ebook.Compatibility.isTouchDevice?ebook.Compatibility.isSmartPhone&&(!ebook.data.wide_width_min||t<ebook.data.wide_width_min)?(ebook.Compatibility.isAndroid?$("body").height(n):ebook.Compatibility.isAppleDev&&(i={height:480,width:320},ebook.Compatibility.viewport.width&&(i=ebook.Compatibility.viewport.height>=ebook.Compatibility.viewport.width?{height:ebook.Compatibility.viewport.height,width:ebook.Compatibility.viewport.width}:{height:ebook.Compatibility.viewport.width,width:ebook.Compatibility.viewport.height}),n>=t?(n=i.height,t=i.width):(n=i.width,t=i.height),ebook.Compatibility.isMobSafari&&ebook.Compatibility.isIOS10&&n<t&&$(".ebook5-ui-zoom-wrap").css("position","absolute"),$("body").height(n).width(t)),(!ebook.PageFlipper.isNarrowMode()||ebook.PageFlipper.isWideMode())&&changeNarrowPage(!1)):($("body").height(n).width(t),ebook.PageFlipper.isWideMode()?n>t&&changeNarrowPage(!1):ebook.PageFlipper.isNarrowMode()?n<=t&&(ebook.BookData.singlePageMdoe?ebook.PageFlipper.changeZoomPage():ebook.PageFlipper.changeWidePage()):ebook.PageFlipper.isZoomMode()?n>t&&changeNarrowPage(!1):n>t?changeNarrowPage(!1):ebook.BookData.singlePageMdoe?ebook.PageFlipper.changeZoomPage():ebook.PageFlipper.changeWidePage()):ebook.PageFlipper.viewMode==0&&(ebook.BookData.singlePageMdoe?(ebook.PageFlipper.viewMode=ebook.data._viewModeZoom,ebook.PageFlipper.changeZoomPage()):ebook.PageFlipper.viewMode=ebook.data._viewModeWide);r=n-$("#canvas").offset().top;ebook.PageFlipper.isWideMode()?($("body").addClass("vmode_wide"),$("#canvas").css({height:r-ebook.data.stageFootMargin+"px","overflow-y":"hidden","overflow-x":"hidden"})):ebook.PageFlipper.isZoomMode()?($("#stage").css({"min-height":r+"px"}),$("#l_canvas").css({height:r+"px","overflow-y":"hidden","overflow-x":"hidden"})):ebook.PageFlipper.isNarrowMode()&&$("#NarrowPage").css({height:n+"px","overflow-y":"hidden","overflow-x":"hidden"});ebook.Compatibility.isTouchDevice&&(n<t&&ebook.Compatibility.isIOS11,ebook.PageFlipper.isNarrowMode()&&$(".ebook5-ui-zoom-wrap").css({top:n-48+"px","z-index":"10",bottom:"",position:"absolute"}))}function onResize_setViewrMode(){var n;ebook.PageFlipper.isWideMode()&&(ebook.PageFlipper.canvas_size=new Size($("#canvas").width(),$("#canvas").height()),n=[$("#canvas1"),$("#canvas2")],function(n){for(var t=0;t<n.length;t++)n[t].attr({height:ebook.PageFlipper.canvas_size.height,width:ebook.PageFlipper.canvas_size.width})}(n),m_move_clear(),ebook.PageFlipper.InitResampleBook(),ebook.PageFlipper.updatePageView());ebook.PageFlipper.isZoomMode()&&(ebook.PageFlipper.InitResampleBook(),ebook.PageFlipper.canvasl_size=new Size($("#l_canvas").width(),$("#l_canvas").height()),n=[$("#l_canvas2")],function(n){for(var t=0;t<n.length;t++)n[t].attr({height:ebook.PageFlipper.canvasl_size.height,width:ebook.PageFlipper.canvasl_size.width})}(n),ebook.PageWide.setupZoomPageSize(),ebook.PageWide.setLargeImagePos());ebook.PageFlipper.isNarrowMode()&&ResizeNarrowView()}function ui_init(){var n=!1,t=!1;typeof ebook.BookData.useAutoPlay!==_undefined&&(n=ebook.BookData.useAutoPlay);typeof ebook.BookData.useThumbIndex!==_undefined&&(t=ebook.BookData.useThumbIndex);ebook.BookData.pageHintEnable||$(".icon_faq").parent().hide();$(document).on("click","#sub_scrwindow .menu_back,#l_canvas .z_close,#icon_set_zoom .icon_close",function(n){return closeScrwindow(),!ebook.PageFlipper.isNarrowMode()&&ebook.PageFlipper.isZoomMode()&&ebook.PageFlipper.changeWidePage(),!1});if(!ebook.Compatibility.isSupportCanvas){$("#row_page >.page_left .hit_area").on("click",function(){return pageView_jumpPage(ebook.PageFlipper.currentPageNum_left-1),!1});$("#row_page >.page_right .hit_area").on("click",function(){return pageView_jumpPage(ebook.PageFlipper.currentPageNum_left+2),!1})}$("#navi").removeClass(ebook.BookData.pageTopDirectionIsLeft?"navi_right":"navi_left").addClass(ebook.BookData.pageTopDirectionIsLeft?"navi_left":"navi_right");$("#select_area #print_all,#select_area #print_left,#select_area #print_right").on("click",function(){return $("#select_area #print_all,#select_area #print_left,#select_area #print_right").removeClass("select"),$(this).addClass("select"),!1});$("#icon_set_wide .zoomout_icon").on("click",function(){return $(this).hasClass("disable")||ebook.PageWide.setZoomPageLeft(),!1});ebook.Compatibility.isIPad&&(ebook.BookData.pageShadow=!1);$("#icon_panel").click(function(){return ebook.PageTool.openSidePanel(),!1});$("#icon_set_wide .icon_bookmark").click(function(){return $(this).hasClass("disable")||ebook.PageTool.openSecnavi(this),!1});$("#icon_set_submenu .icon_print").click(function(){return $(this).hasClass("disable")||(ebook.PageTool.openSecnavi($("#icon_set_submenu .icon_download"),!0),ebook.PageTool.openSecnavi(this)),!1});$("#icon_set_submenu .icon_download").click(function(){return!$(this).hasClass("disable")&&ebook.BookData.use_Download&&(ebook.PageTool.openSecnavi($("#icon_set_submenu .icon_print"),!0),ebook.PageTool.openSecnavi(this)),!1});$("body.vmode_wide ,body.vmode_zoom").click(function(n){$(this).hasClass("disable")||ebook.PageTool.openSidePanel(!0)});ebook.BookData.use_Download||$("#icon_set_submenu .icon_download").hide();$("#icon_thumb").click(function(){return $("#list_and_thumb .thumbs").is(":hidden")&&($("#list_and_thumb .lists").hide(),$("#list_and_thumb .thumbs").show(),$("#icon_list").addClass("not_selected"),$("#icon_thumb").removeClass("not_selected"),ebook.PageTool.setCurrentHereThumbList()),!1});$("#icon_list").click(function(){return $("#list_and_thumb .lists").is(":hidden")&&($("#list_and_thumb .lists").show(),$("#list_and_thumb .thumbs").hide(),$("#icon_list").removeClass("not_selected"),$("#icon_thumb").addClass("not_selected"),ebook.PageTool.setCurrentHerePageList()),!1});$("#icon_set_wide .icon_item,#icon_set_submenu .icon_item").hover(function(){$(this).addClass("theme_hcolor")},function(){$(this).removeClass("theme_hcolor")});$("#ctrl_cont .search_text_wrap input").click(function(){return $(this).focus(),!1});loadBookmark();ebook.PageTool.makePageListThumb();$(".search_box .search_text").on("keypress",function(n){var t=n||window.event;ebook.Compatibility.isIE6&&(t=window.event);switch(t.keyCode){case 13:$(".search_box .search_btn").trigger("click");default:break}});$(".search_box .search_btn").on("click",function(){var n=$(".search_box .search_text").val();return ebook.PageTool.searchKeywords(n),ebook.PageTool.makePageListThumb(),$("#ctrl_panel").hasClass("open")||ebook.PageFlipper.changePageMode(0),!1});$(".search_box .search_text").on("blur",function(){return!1});$(".search_box .search_cancel_btn").on("click",function(){return $(".search_box .search_text").val(""),ebook.PageTool.searchClear(),ebook.PageTool.makePageListThumb(),$("#ctrl_panel").hasClass("open")||ebook.PageFlipper.changePageMode(0),!1});$("#ctrl_panel .print_menuset .widepage a").on("click",function(n){return ebook.PageTool.closeAllSecNav(),pagePrint(0),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .print_menuset .leftpage a").on("click",function(n){return ebook.PageTool.closeAllSecNav(),pagePrint(1),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .print_menuset .rightpage a").on("click",function(n){return ebook.PageTool.closeAllSecNav(),pagePrint(2),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .download_menuset .allpage a").on("click",function(n){ebook.PageTool.closeAllSecNav();var t=getDownloadPath(!0);return setTimeout(function(){ebook.BookData.DownloadCallBack(0,t)},1),setTimeout(function(){window.open(t,"_blank")},1),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .download_menuset .leftpage a").on("click",function(n){ebook.PageTool.closeAllSecNav();var t=getDownloadPath(!1,!0),i=getDownloadPageNum(!0);return setTimeout(function(){ebook.BookData.DownloadCallBack(i,t)},1),setTimeout(function(){window.open(t,"_blank")},1),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .download_menuset .rightpage a").on("click",function(n){ebook.PageTool.closeAllSecNav();var t=getDownloadPath(!1,!1),i=getDownloadPageNum(!0);return setTimeout(function(){ebook.BookData.DownloadCallBack(i,t)},1),setTimeout(function(){window.open(t,"_blank")},1),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .bookmark_menuset .leftpage a").on("click",function(n){return ebook.PageTool.closeAllSecNav(),set_bookmark(!0),ebook.PageTool.makePageListThumb(),ebook.PageTool.openSidePanel(!0),!1});$("#ctrl_panel .bookmark_menuset .rightpage a").on("click",function(n){return ebook.PageTool.closeAllSecNav(),set_bookmark(!1),ebook.PageTool.makePageListThumb(),ebook.PageTool.openSidePanel(!0),!1});$("#icon_thumb").click();ebook.PageTool.pageSlider();ebook.Linkmap.linkFadeProcess()}function setDisplayListMode(n){var t=$("#sub_scrwindow");$("#sub_scrwindow,#sub_scrwindow .mask_layer").show();n?($("#navi_menu_list a",t).removeClass("active"),$("#navi_menu_thumb a",t).addClass("active"),$("#contents_list",t).hide(),$("#contents_list ul").empty(),$("#contents_thumblist",t).show()):($("#navi_menu_thumb a",t).removeClass("active"),$("#navi_menu_list a",t).addClass("active"),$("#contents_thumblist",t).hide(),$("#contents_thumblist ul").empty(),$("#contents_list",t).show());IE_SelectHide()}function closeScrwindow(){$("#sub_scrwindow,#sub_scrwindow .mask_layer").hide();$("#sub_scrwindow").removeClass("disp_download_layer").removeClass("disp_optional_layer");IE_SelectShow()}function getQueryParameter(){var n=!1,i,u,r,t;if(location.search.length>1){if(i=""+location.search.split("?").join(""),u=decodeURIComponent,typeof i===_undefined)return n;for(r=i.split("&"),n={},t=0;r.length>t;t++)itm=r[t].split("="),itm[0]!=""&&(n[itm[0]]=typeof itm[1]==_undefined?!0:u(itm[1]))}return n}function getPageNum(n){return(typeof n==_undefined&&(n=ebook.PageFlipper.isNarrowMode()?ebook.PageFlipper.narrowCurrentPageNum:ebook.PageFlipper.currentPageNum_left),ebook.BookData.pageTopDirectionIsLeft)?n:ebook.PageFlipper.pageCount-n-1}function resizePageToolBar(){updatePageToolBar();updatePagerBar()}function makePagerBar(){var t,n;if(ebook.BookData.use_pageFooterToolbar){for(t=$("#pager_bar_pagelist > select").empty().bind("change",function(){var n=parseInt($(this).val());n=getPageNum(n);pageView_jumpPage(n)}),n=0;n<ebook.PageFlipper.pageCount;n++)t.append($("<option ><\/option>").attr("value",n).text(n+1));updatePagerBar()}}function updatePagerBar(){var t=$(ebook.data.ClassMainToolBar),n,i,r,u;if(!ebook.BookData.use_pageFooterToolbar){t.hide();return}n=ebook.PageFlipper.isNarrowMode()?ebook.PageFlipper.narrowCurrentPageNum:ebook.PageFlipper.currentPageNum_left;n=n<0?0:n>ebook.PageFlipper.pageCount-1?ebook.PageFlipper.pageCount:n;try{i=ebook.BookData.pageTitleText[getPageNum(n)];setPageTitleText(i)}catch(f){setPageTitleText("")}try{$("#pager_bar_pagelist > select").val(getPageNum(n))}catch(f){}r=ebook.PageFlipper.isWideMode()&&ebook.BookData.use_pageFooterToolbar;t.toggle(r);$("#menu_page_top,#menu_page_prev").toggleClass("disable",n<=0);$("#menu_page_last,#menu_page_next").toggleClass("disable",n>=ebook.PageFlipper.pageCount-1);u=function(){var n=0;$("#navi>li:visible").each(function(){n+=$(this).outerWidth()+2});n>0&&$("#navi").width(n+2)};u()}function displayFootToolbar(){var t=!0,n=$(ebook.data.ClassMainToolBar);t&&($("#navi li",n).hide(),$("#end_dummy",n).show(),ebook.Compatibility.isSmartPhone?n.find(smartPhoneMenuList).show():ebook.PageFlipper.isWideMode()?n.find(wideMenuList).show():ebook.PageFlipper.isNarrowMode()?$(narrowMenuList,n).show():ebook.PageFlipper.isZoomMode()&&(t=!1),makeMenuWidth());n.toggle(t);ebook.Compatibility.isIE6&&$("select").toggle(!ebook.PageFlipper.isZoomMode())}function setPageTitleText(n){var t=$("#pager_bar_pagetitle");t.text(n)}function pageView_jumpPage(n){var r,i,t;return stopAutoPlay(),n<0&&(n=0),n>=ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount-1),r=n,n%2==0&&n--,!ebook.BookData.singlePageMdoe&&ebook.PageFlipper.isZoomMode()?(i=ebook.PageWide.zoomPage_pageNum,ebook.PageFlipper.currentPageNum_left=n,ebook.PageWide.zoomPage_mouseEventObj=!1,ebook.PageWide.changeZoomView(r%2==0?1:0),i!=ebook.PageWide.zoomPage_pageNum&&(t=getPageNum(ebook.PageFlipper.currentPageNum_left),t=t<0?0:t,callBookchangeUserFunc(t+1))):ebook.PageFlipper.isNarrowMode()?(i=ebook.PageFlipper.narrowCurrentPageNum,ebook.PageFlipper.currentPageNum_left=n,changeNarrowView2(r),i!=ebook.PageFlipper.narrowCurrentPageNum&&(t=getPageNum(ebook.PageFlipper.narrowCurrentPageNum),t=t<0?0:t,callBookchangeUserFunc(t+1))):ebook.BookData.singlePageMdoe?(i=ebook.PageWide.zoomPage_pageNum,ebook.PageFlipper.currentPageNum_left=n,ebook.PageWide.zoomPage_pageNum=r,ebook.PageWide.zoomPage_mouseEventObj=!1,ebook.PageWide.changeZoomView(r%2==0?1:0),i!=ebook.PageWide.zoomPage_pageNum&&(t=getPageNum(r),t=t<0?0:t,callBookchangeUserFunc(t+1))):(i=ebook.PageFlipper.currentPageNum_left,ebook.PageFlipper.currentPageNum_left=n,ebook.PageFlipper.updatePageView(),i!=ebook.PageFlipper.currentPageNum_left&&(t=getPageNum(ebook.PageFlipper.currentPageNum_left),t=t<0?0:t,callBookchangeUserFunc(t+1))),!1}function callBookchangeUserFunc(n){n>ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount);setTimeout(function(){ebook.BookData.PageChangeCallBack(n);(ebook.PageFlipper.isWideMode()||ebook.PageFlipper.isZoomMode())&&n>1&&n<ebook.PageFlipper.pageCount&&(n+=ebook.BookData.pageTopDirectionIsLeft?1:-1,ebook.BookData.PageChangeCallBack(n))},0)}function zoom_fit(n){set_zoomFit();m_move_clear();ebook.PageFlipper.InitResampleBook()}function set_zoomFit(){var n=$("#canvas"),r=ebook.data.stageFootMargin,t,i;ebook.PageFlipper.canvas_offset=new Position(n.offset().left,n.offset().top);ebook.PageFlipper.canvas_size=new Size(ebook.Compatibility.viewport.width-ebook.PageFlipper.canvas_offset.left,ebook.Compatibility.viewport.height-r-ebook.PageFlipper.canvas_offset.top);ebook.PageFlipper.basePage_size.width=ebook.BookData.pageImgSize.width;ebook.PageFlipper.basePage_size.height=ebook.BookData.pageImgSize.height;t=ebook.PageFlipper.basePage_size.height/(ebook.PageFlipper.basePage_size.width*2);i=(ebook.PageFlipper.canvas_size.height-ebook.data.stageTopMargin-ebook.data.pageViewMargin)/(ebook.PageFlipper.canvas_size.width-ebook.data.pageViewMargin*2);ebook.PageFlipper.bookScale=t>=i?(ebook.PageFlipper.canvas_size.height-ebook.data.stageTopMargin-ebook.data.pageViewMargin)*100/ebook.PageFlipper.basePage_size.height:(ebook.PageFlipper.canvas_size.width-ebook.data.pageViewMargin*2)*100/(ebook.PageFlipper.basePage_size.width*2);ebook.PageFlipper.bookScale=Math.ceil(ebook.PageFlipper.bookScale);ebook.PageFlipper.bookScale<ebook.data.minScale&&(ebook.PageFlipper.bookScale=ebook.data.minScale);ebook.BookData.maxScaleX1&&ebook.PageFlipper.bookScale>100&&(ebook.PageFlipper.bookScale=100)}function set_zoom(n){ebook.PageFlipper.bookScale=n;m_move_clear();ebook.PageFlipper.InitResampleBook()}function windowMax(){t_origin=window.screenTop;l_origin=window.screenLeft;w_origin=document.body.offsetWidth;h_origin=document.body.offsetHeight;window.moveTo(0,0);window.resizeTo(window.screen.width,window.screen.height)}function removePageToolBar(){}function makePageToolBar(){ebook.BookData.use_pageSideToolbar&&updatePageToolBar()}function updatePageToolBar(){if(ebook.BookData.use_pageSideToolbar){var t=ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width,n=ebook.PageFlipper.diaplayPage_offset.top-ebook.data.stageTopMargin;n<0&&(n=0);$(ebook.data.ClassPageToolBar).css({top:n+"px",left:t-ebook.PageFlipper.diaplayPage_size.width+"px"}).width(ebook.PageFlipper.diaplayPage_size.width*2);$(ebook.data.ClassPageToolBar_right).toggle(ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount-1);$(ebook.data.ClassPageToolBar_left).toggle(ebook.PageFlipper.currentPageNum_left>=0)}}function makeToolsbars(){makePageToolBar();makePagerBar();makeBookmarkPage(!0,"LEFT");makeBookmarkPage(!1,"RIGHT")}function makeBookmarkPage(n,t){var i=$("#bookmark_base").clone();i.find("img").attr("alt",t);i.attr("id","").hide();i.appendTo("#stage").addClass(n?"__BKMK_LEFT":"__BKMK_RIGHT")}function updateBookmark(){return}function getBookmarkNum(n){return ebook.data.bookmark_buffer[n]}function isBookmarkPage(n){return n+1>ebook.PageFlipper.pageCount||n<0?!1:ebook.data.bookmark_buffer[n]==1}function tgrBookmarkPage(n){if(n+1>ebook.PageFlipper.pageCount||n<0)return!1;ebook.data.bookmark_buffer[n]=ebook.data.bookmark_buffer[n]==1?0:1;saveBookmark()}function makeBookmarkPos(n){var t=isLeftBookmark(n),i,r;n+=t?0:1;i=countBookmarks(0,n);r=countBookmarks(n+1,0)}function countBookmarks(n,t){var u,r,i;for(n>t&&(u=n,n=t,t=u),t>=ebook.PageFlipper.pageCount&&(t=ebook.PageFlipper.pageCount-1),r=0,i=n;i<=t;i++)isBookmarkPage(i)&&r++;return r}function isLeftBookmark(n){return ebook.PageFlipper.currentPageNum_left>=n}function set_bookmark(n){var t=getPageNum(ebook.PageFlipper.currentPageNum_left+(n?0:1));tgrBookmarkPage(t);ebook.PageFlipper.updatePageView();isBookmarkPage(t)&&setTimeout(function(){ebook.BookData.SetBookmarkCallBack(t+1)},0)}function clearBookmark(){ebook.data.bookmark_buffer=new Array(ebook.PageFlipper.pageCount);for(var n=0;n<ebook.PageFlipper.pageCount;n++)ebook.data.bookmark_buffer[n]=0}function loadBookmark(){var t,i,r,u,n;for(clearBookmark(),t=0;t<ebook.PageFlipper.pageCount;t++)if(i=loadCookie("bk",""),typeof i!=_undefined){r=i.split(":");for(u in r)n=parseInt(r[u]),!isNaN(n)&&n>=0&&ebook.PageFlipper.pageCount>n&&(ebook.data.bookmark_buffer[n]=1)}}function saveBookmark(){for(var t=[],n=0;n<ebook.PageFlipper.pageCount;n++)ebook.data.bookmark_buffer[n]==1&&t.push(n);saveCookie("bk",t.join(":"))}function havLinkPage(n){if(n+1>ebook.PageFlipper.pageCount||n<0)return!1;var t=ebook.BookData.pageLinkContents[n+1]||!1;return t?t.length:!1}function getMousePos(){var t=!1,n;return ebook.Compatibility.isTouchDevice?(n=window.event||null,n&&n.touches&&n.touches[0]&&(t=new Point(n.touches[0].pageX,n.touches[0].pageY))):t=ebook.PageFlipper.realMousePos.clone(),t}function getMousePosEvent(n){var i=!1,t;return ebook.Compatibility.isTouchDevice?(t=window.event||n,t&&(i=t.touches&&t.touches[0]?new Point(t.touches[0].pageX,t.touches[0].pageY):t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0]?new Point(t.originalEvent.touches[0].pageX,t.originalEvent.touches[0].pageY):t&&t.touch?new Point(t.touch.pageX,t.touch.pageY):new Point(n.pageX,n.pageY))):i=new Point(n.pageX,n.pageY),i}function getMousePosEvent2(n){return ebook.Compatibility.isTouchDevice?n.touches&&n.touches[0]?new Point(n.touches[0].pageX,n.touches[0].pageY):n.touch?new Point(n.touch.pageX,n.touch.pageY):n.originalEvent&&event.originalEvent.touches&&event.originalEvent.touches[0]?new Point(n.originalEvent.touches[0].pageX,n.originalEvent.touches[0].pageY):new Point(n.pageX,n.pageY):new Point(n.pageX,n.pageY)}function getMouseClientPosEvent(n){var t=!1,n;return ebook.Compatibility.isTouchDevice?(n=n||window.event,t=n.touches&&n.touches[0]?new Point(n.touches[0].clientX,n.touches[0].clientY):n.touch?new Point(n.touch.clientX,n.touch.clientY):n.originalEvent&&event.originalEvent.touches&&event.originalEvent.touches[0]?new Point(n.originalEvent.touches[0].clientX,n.originalEvent.touches[0].clientY):new Point(n.clientX,n.clientY)):t=new Point(n.clientX,n.clientY),t}function cnv_windowToLocal(n){return new Point(n.x-ebook.PageFlipper.canvas_offset.left,n.y-ebook.PageFlipper.canvas_offset.top)}function cnv_localToWindow(n){return new Point(n.x+ebook.PageFlipper.canvas_offset.left,n.y+ebook.PageFlipper.canvas_offset.top)}function saveCookie(n,t){setCookie("ebook5_data_"+n,t,{expires:new Date("1-Jan-2100 00:00:00"),domain:location.hostname,secure:location.protocol==="https:"})}function loadCookie(n,t){var i=getCookie("ebook5_data_"+n);return i||t}function setCookie(n,t,i){var r=i||{},u,f;t===null&&(t="",r.expires=-1);r.expires&&(typeof r.expires=="number"?(u=new Date,u.setTime(u.getTime()+r.expires*864e5),r.expires=u.toUTCString()):r.expires=r.expires.toUTCString?r.expires.toUTCString():!1);f=[n+"="+encodeURIComponent(t),r.expires?"; expires="+r.expires:"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":"",";"].join("");document.cookie=f}function getCookie(n){var u=null,i,t,r;if(document.cookie&&document.cookie!="")for(i=document.cookie.split(";"),t=0;t<i.length;t++)if(r=jQuery.trim(i[t]),r.substring(0,n.length+1)==n+"="){u=decodeURIComponent(r.substring(n.length+1));break}return u}function require(n,t){var i=document.createElement("script"),r;i.type="text/javascript";i.src=n;i.charset=t||"utf-8";i.onload=function(){};document.all&&(i.onreadystatechange=function(){switch(i.readyState){case"complete":case"loaded":i.onload();break}});r=document.getElementsByTagName("head")[0];r.appendChild(i)}function Point(n,t){return this.type="Point",this.x=n,this.y=t,this}function Position(n,t){return this.type="Position",this.left=n,this.top=t,this}function Size(n,t){return this.type="Size",this.width=n,this.height=t,this}function havPageLeft(){return ebook.PageFlipper.currentPageNum_left>-1}function havPageRight(){return ebook.PageFlipper.currentPageNum_left<=ebook.PageFlipper.pageCount-2}function hideAddress(n){var t=1e3;n&&(t=0);try{ebook.Compatibility.isIPad||ebook.Compatibility.isSmartPhone}catch(i){}}function IE_SelectHide(){ebook.Compatibility.isIE7&&$("select").hide()}function IE_SelectShow(){ebook.Compatibility.isIE7&&$("select").show()}function isRightClick(n){return getMouseButtonType(n)==MouseButtonTypeEnum.RIGHT}function getMouseButtonType(n){var i=!$.browser.msie||$.browser.version>=9,r=-1,t;return n&&(n=n.event||n,t=n.button||0,r=i&&t==0||!i&&t==1?MouseButtonTypeEnum.LEFT:i&&t==1||!i&&t==4?MouseButtonTypeEnum.MIDDLE:MouseButtonTypeEnum.RIGHT),r}function pointDist(n,t){return Math.sqrt(Math.abs(Math.pow(n.x-t.x,2))+Math.abs(Math.pow(n.y-t.y,2)))}function MathRound(n){return.5+n|0}function htmlEncode(n){return n?jQuery("<div/>").text(n).html():""}function logw(){}function logw2(){}function backgroundloading_middlePageImage(n,t){var i=ebook.data.spacegif_url;n>=0&&(i=ebook.BookData.GetPageImgPath(n));_bgLoadingImageFunc(i,function(n){t&&t(n)})}function backgroundloading_thumbPageImage(n,t){var i=ebook.data.spacegif_url;n>=0&&(i=ebook.BookData.pageImgPathList_thumb[n]);_bgLoadingImageFunc(i,function(n){t&&t(n)})}function _bgLoadingImageFunc(n,t){$("<img>").onImagesLoaded(function(n){t(n)}).attr("src",n)}function changeNarrowPage(n){return ebook.BookData.use_largeImage?(ebook.PageWide.zoomPage_mouseEventObj=n,ebook.PageFlipper.setNarrowMode(),ebook.PageFlipper.changePageMode(0),!1):!1}function setNarrowPage(n,t){function w(n,t,i){return n.attr("data-pnum",t).addClass("single"),$(".page-wrap:eq(0)",n).css({"background-image":"url("+i+")"}),$(".page-wrap:eq(1)",n).css({"background-image":"url("+ebook.data.spacegif_url+")"}),n}function it(n,t,i,r){return n.attr("data-pnum",t).removeClass("single"),$(".page-wrap:eq(0)",n).css({"background-image":"url("+i+")"}),$(".page-wrap:eq(1)",n).css({"background-image":"url("+r+")"}),n}function e(n,t){var i,r,u;return(t<0&&(t=0),i=getPageNum(t),r=ebook.BookData.GetPageImgPath(i),!y||i<=0||i>=ebook.PageFlipper.pageCount-1)?w(n,i,r):(i=getPageNum(t+1),u=ebook.BookData.GetPageImgPath(i),it(n,i,r,u))}function o(n,t){var i,r,u;return(t<0&&(t=0),i=getPageNum(t),r=ebook.BookData.pageImgPathList_thumb[i],!y||i<=0||i>=ebook.PageFlipper.pageCount-1)?w(n,i,r):(i=getPageNum(t+1),u=ebook.BookData.pageImgPathList_thumb[i],it(n,i,r,u))}function ot(n){return w(n,"",ebook.data.spacegif_url)}function v(n){return y?it(n,"",ebook.data.spacegif_url,ebook.data.spacegif_url):w(n,"",ebook.data.spacegif_url)}var y,c,g,nt;typeof t==_undefined&&(t=!1);hideAddress(!0);y=ebook.PageFlipper.isWideView();c=ebook.PageFlipper.narrowCurrentPageNum;c<0&&(c=0);c>=ebook.PageFlipper.pageCount&&(c=ebook.PageFlipper.pageCount-1);y&&c%2==0&&c--;var u=".page:eq(0)",h=".page:eq(1)",f=".page:eq(2)",r=$("#narrowContentsRow"),i=$("#narrowContents"),rt=$("#narrowPage"),p=typeof ebook.data.local.narrow_save_cur_pnum!=_undefined?ebook.data.local.narrow_save_cur_pnum:-99,ut=y?2:1,s=c,l=c-ut,a=c+ut;if(y?rt.addClass("wide").removeClass("narrow"):rt.addClass("narrow").removeClass("wide"),c<=0||c>=ebook.PageFlipper.pageCount-1){s<0&&(s=0);$(u,i).show();$(u,r).show();var st=getPageNum(c),b=c<=0?a:l,k=c<=0?f:u,d=c<=0?u:f;t?(p==a?($(r).prepend($(f,r).remove()),$(i).prepend($(f,i).remove())):p==l?($(r).append($(u,r).remove()),$(i).append($(u,i).remove())):(o($(h,r),s),o($(k,r),b)),setTimeout(function(){e($(h,i),s);e($(k,i),b)},0)):(o($(h,r),s),o($(k,r),b),setTimeout(function(){e($(h,i),s);e($(k,i),b)},0));$(d,r).hide();$(d,i).hide();v($(d,r));v($(d,i))}else if($(".page",i).show(),$(".page",r).show(),p==s)o($(h,r),s),e($(h,i),s),l>0?(o($(u,r),l),e($(u,i),l)):(v($(u,r)),v($(u,i))),l>0?(o($(f,r),a),e($(f,i),a)):(v($(f,r)),v($(f,i)));else if(p!=l&&p!=a)v($(".page",r)),v($(".page",i)),t?(e($(h,i),s),o($(h,r),s),$(f,r).show(),$(".page",i).show(),setTimeout(function(){o($(u,r),l);o($(f,r),a);e($(u,i),l);e($(f,i),a)},0)):(o($(h,r),s),o($(u,r),l),o($(f,r),a),$(f,r).show(),$(".page",i).show(),setTimeout(function(){e($(h,i),s);e($(u,i),l);e($(f,i),a)},0));else if(p==l){g=$(u,r).remove();nt=$(u,i).remove();$(r).append(g);$(i).append(nt);var ft=$(u,i).attr("data-pnum"),tt=$(h,i).attr("data-pnum"),et=$(f,i).attr("data-pnum");ft&&ft!=""||(o($(u,r),l),e($(u,i),l));tt&&tt!=""||(o($(h,r),s),e($(h,i),s));setTimeout(function(){o($(f,r),a);e($(f,i),a)},0)}else if(p==a){g=$(f,r).remove();nt=$(f,i).remove();$(r).prepend(g);$(i).prepend(nt);var ft=$(u,i).attr("data-pnum"),tt=$(h,i).attr("data-pnum"),et=$(f,i).attr("data-pnum");et&&et!=""||(o($(f,r),a),e($(f,i),a));tt&&tt!=""||(o($(h,r),s),e($(h,i),_cur));setTimeout(function(){o($(u,r),l);e($(u,i),l)},0)}ebook.PageFlipper.makeLinkMapNarrowPage(s,$(h,i));ebook.data.local.narrow_save_cur_pnum=s}function updateNarrowBTools(){var n=ebook.PageFlipper.narrowCurrentPageNum,t=n>=ebook.PageFlipper.pageCount-1,i=n<=0;$(".ebook5-ui-zoom-wrap .tool-zoom-left").toggleClass("disable",i);$(".ebook5-ui-zoom-wrap .tool-zoom-right").toggleClass("disable",t)}function updateNarrowTools(){function u(){var n=$("#narrowPage"),t=$("#narrowTools_b_bottom ul li:visible",n).size();t>0&&$("#narrowTools_b_bottom ul",n).addClass("narrowTools_h_item_"+t)}if(ebook.BookData.use_NarrowTools){var n=$("#narrowTools"),t=ebook.PageFlipper.narrowCurrentPageNum,i=t>=ebook.PageFlipper.pageCount-1,r=t<=0;$("#narrowTools_top").toggleClass("disable",r);$("#narrowTools_left").toggleClass("disable",r);$("#narrowTools_last").toggleClass("disable",i);$("#narrowTools_right").toggleClass("disable",i);n.toggleClass("narrowTools_fix",NarrowZoomPageScale<=1);n.toggleClass("narrowTools_zoom",NarrowZoomPageScale>1);u();updateNarrowBTools()}}function showNarrowZoomUI(n){typeof n=="undefind"&&(n=!0);$("body").hasClass("vmode_narrow")||(n=!1);n?$(".ebook5-ui-zoom-wrap").show():$(".ebook5-ui-zoom-wrap").css("display","none")}function narrowToolsHideDelay(){tools_hide_lock=!0;setTimeout(function(){tools_hide_lock=!1},500)}function narrowToolsHide(){narrowToolsDisplay(!1,0)}function narrowToolsDisplay(n,t){if(n&&tools_hide_lock){tools_hide_lock=!1;return}if(ebook.PageFlipper.isNarrowMode()){var i=EVENT_narrow_tools_data.view;(n!=!1||i)&&(i||$("#narrowTools").css({opacity:0,display:"block"}),EVENT_narrow_tools_data.click_state=1,typeof t==_undefined&&(t=tools_disp_delay),updateNarrowTools(),$("#narrowTools").stop(!0).animate({opacity:i?"0":"1"},t,"swing",function(n){EVENT_narrow_tools_data.view=!EVENT_narrow_tools_data.view;$("#narrowTools").toggle(EVENT_narrow_tools_data.view);EVENT_narrow_tools_data.click_state=0;EVENT_narrow_tools_data.view&&EVENT_narrow_tools_data.fout_timer==!1&&(EVENT_narrow_tools_data.fout_timer=setTimeout(function(){EVENT_narrow_tools_data.fout_timer=!1;narrowToolsDisplay(!1)},tools_hide_delay))}))}}function EVENT_narrow_tools(n){var t=".narrowtools",i="#narrowPage",r=0,f=function(){EVENT_narrow_tools_data.thred!==!1&&EVENT_narrow_tools_data.thred!==!0&&(clearTimeout(EVENT_narrow_tools_data.thred),EVENT_narrow_tools_data.thred=!1)},e=function(n){var e,h,c,u;if(!IsNarrowIndexView()&&(n.type!==leb.e.ts||!(n.originalEvent.touches.length>1))&&(n.type!=leb.e.md||!isRightClick(n))){if(EVENT_narrow_tools_data.fin_timer!=!1){clearTimeout(EVENT_narrow_tools_data.fin_timer);EVENT_narrow_tools_data.fin_timer=!1;return}if(e=new Date,h=e.getTime(),!(EVENT_narrow_tools_data.click_state>0)||!(h-EVENT_narrow_tools_data.click_state<1e4)){c=n.type===leb.e.ts?n.originalEvent.touches[0]:n;EVENT_narrow_tools_data.click_stat=h;r=e;$(i).on((ebook.Compatibility.isTouchDevice?leb.e.tm:leb.e.mm)+t,s).one((ebook.Compatibility.isTouchDevice?leb.e.te:leb.e.mu)+t,o);u=getMousePosEvent(c);u&&(EVENT_narrow_tools_data.first_mousePos=u.clone(),EVENT_narrow_tools_data.last_mousePos=u.clone());f()}}},u=function(){$(i).off(leb.e.tm+t+" "+leb.e.mm+t+" "+leb.e.te+t+" "+leb.e.mu+t)},o=function(n){var t=new Date,i=t.getTime()-r.getTime(),f=Math.abs((EVENT_narrow_tools_data.first_mousePos.x||-100)-(EVENT_narrow_tools_data.last_mousePos.x||-200)),e=Math.abs((EVENT_narrow_tools_data.first_mousePos.y||-100)-(EVENT_narrow_tools_data.last_mousePos.y||-200));f<4&&e<4&&i<400?EVENT_narrow_tools_data.fin_timer=setTimeout(function(){EVENT_narrow_tools_data.fin_timer=!1;narrowToolsDisplay(!0)},300):EVENT_narrow_tools_data.click_state=0;u()},s=function(n){if(n.type===leb.e.tm&&n.originalEvent.touches.length>1){u();return}var t=getMousePosEvent(n);EVENT_narrow_tools_data.last_mousePos=t.clone()};return e(n)}function ResizeNarrowView(){var n,t;if(setoffNarrowZoomView(),n=0,ebook.Compatibility.isSmartPhone)if($("#narrowPage").is(":visible")){$("#narrowPage").hide().height("");setTimeout(function(){ResizeNarrowView()},0);return}else $("#narrowPage").show(),t=getWindowHeight(),$("#narrowPage").height(t-n),$("#sub_scrwindow").height(t);else $("#narrowPage").height($("body").height()-n);fitNarrowImg();setNarrowPage(0)}function getWindowHeight(){var n=ebook.Compatibility.isAppFB&&ebook.Compatibility.isAppleDev?60:ebook.Compatibility.isAppTW&&ebook.Compatibility.isAppleDev?110:0;return $(window).height()-n}function changeoutNarrowView(){ebook.PageFlipper.currentPageNum_left=ebook.PageFlipper.narrowCurrentPageNum%2==0?ebook.PageFlipper.narrowCurrentPageNum-1:ebook.PageFlipper.narrowCurrentPageNum}function changeNarrowView(){var n=ebook.PageFlipper.currentPageNum_left<0?0:ebook.PageFlipper.currentPageNum_left;changeNarrowView2(n)}function changeNarrowView2(n){n!==!1&&(ebook.PageFlipper.narrowCurrentPageNum=n);_IsNarrowIndexView=!1;$("#stage").children().hide();$("#sub_scrwindow,#sub_scrwindow .mask_layer").hide();$("#narrowContentsZoom").empty();$("#narrowContentsZoom").hide();setupZoomNarrowView();setoffNarrowZoomView();showNarrowZoomUI(!0);$("#narrowPage").show();$("#narrowNotice").hide();$("#narrowContentsPageList").hide();$("#narrowContentsRow").show();NarrowZoom_Point=new Point(50,50);setNarrowZoomPageScale(1);ResizeNarrowView();updateNarrowTools()}function removeLinkMapNarrow(){removeLinkMap()}function fitNarrowImg(){var f=ebook.PageFlipper.isWideView(),r=f?2:1,e=ebook.PageFlipper.narrowCurrentPageNum,o=new Size(ebook.BookData.pageImgSize.width*r,ebook.BookData.pageImgSize.height),i,h;NarrowStageSize=new Size($("#stage").width(),$("#stage").height());var n=new Size(NarrowStageSize.width-ebook.Narrow.pageViewMargin*2,NarrowStageSize.height-ebook.Narrow.stageTopMargin-ebook.Narrow.stageFootMargin),u=o.height/o.width,s=n.height/n.width,t=NarrowImageSize.width*r;u<s?(NarrowStageFitSize=new Size(n.width/r,Math.round(n.width*u)),NarrowStageMargin=new Size(f?n.width/r/2:0,MathRound((n.height-NarrowStageFitSize.height)/2))):(NarrowStageFitSize=new Size(MathRound(n.height/u)/r,n.height),NarrowStageMargin=new Size(MathRound((n.width-NarrowStageFitSize.width)/2),0));i=3;e<=0?(i=2,NarrowImageSize=new Size((NarrowStageFitSize.width+(NarrowStageMargin.width+ebook.Narrow.pageViewMargin)*2)*i,NarrowStageSize.height),t=NarrowImageSize.width,$("#narrowContents,#narrowContentsRow").css({width:t+"px",left:"0px"}),NarrowPagePos_Old=0):e>=ebook.PageFlipper.pageCount-1?(i=2,NarrowImageSize=new Size((NarrowStageFitSize.width+(NarrowStageMargin.width+ebook.Narrow.pageViewMargin)*2)*i,NarrowStageSize.height),t=NarrowImageSize.width,$("#narrowContents,#narrowContentsRow").css({width:t+"px",left:NarrowStageSize.width*-1+"px"}),NarrowPagePos_Old=NarrowStageSize.width):(NarrowImageSize=new Size((NarrowStageFitSize.width+(NarrowStageMargin.width+ebook.Narrow.pageViewMargin)*2)*i,NarrowStageSize.height),t=NarrowImageSize.width,$("#narrowContents,#narrowContentsRow").css({width:t+"px",left:NarrowStageSize.width*-1+"px"}),NarrowPagePos_Old=NarrowStageSize.width);$("#narrowContents>div,#narrowContentsRow>div").css({"margin-top":NarrowStageMargin.height+ebook.Narrow.stageTopMargin+"px","margin-left":NarrowStageMargin.width+ebook.Narrow.pageViewMargin+"px","margin-right":NarrowStageMargin.width+ebook.Narrow.pageViewMargin+"px",width:NarrowStageFitSize.width+"px",height:NarrowStageFitSize.height+"px"});h={x:n.width/2,y:n.heigh};NarrowPagePos=new Point(NarrowPagePos_Old,0);setNarrowZoomPageScale(1);NarrowPageClickCount=0}function setNarrowIndexView(n){ebook.BookData.narrowContentsPageListBeforeCallBack();typeof n==_undefined&&(n=getPageNum(ebook.PageFlipper.narrowCurrentPageNum));_IsNarrowIndexView=!0;$("#narrowContents,#narrowContentsRow").hide();$("#narrowContentsZoom").hide();makeNarrowThumbListPager(n);$("#narrowContentsPageList").fadeIn("fast");$("#narrowContentsPageList").toggleClass("isRightDir",!ebook.BookData.pageTopDirectionIsLeft);showNarrowZoomUI(!1);$("#narrowPage").css({overflow:"hidden"});$("#narrowPage").css({height:NarrowStageSize.height+"px"});$("#narrowContentsZoom").empty();hideAddress(!0);setTimeout(function(){setNarrowIndexViewWidth();var t=$("#narrowContentsPageList ul a[data-ref="+n+"]").parent().position();t&&$("#narrowContentsPageList .wrap").animate({scrollTop:t.top},"fast")},1);ebook.BookData.narrowContentsPageListAfterCallBack()}function setNarrowIndexViewWidth(){var i=$("#narrowContentsPageList").width(),n=100,t=Math.floor(i/n),r=$("#narrowContentsPageList ul li").size(),u=Math.floor(r/t);$("#narrowContentsPageList ul").css({width:t*n+"px",height:u*106+10+"px",margin:"0 auto"})}function IsNarrowIndexView(){return _IsNarrowIndexView;return $("#narrowContentsPageList").is(":visible")}function makeNarrowThumbListPagerCurrent(){$("#narrowContentsPageList ul a").removeClass("active");var n=getPageNum(ebook.PageFlipper.narrowCurrentPageNum);$("#narrowContentsPageList ul a[data-ref="+n+"]").addClass("active")}function makeNarrowThumbListPager(n){var e,i,o,f,t,r,u,h,s;if(makeNarrowThumbListPager_maked){makeNarrowThumbListPagerCurrent();return}for(makeNarrowThumbListPager_maked=!0,e=ebook.PageFlipper.pageCount,i=[],t=0;t<e;t+=1)i.push(t);o=$('<li><a class="page_title" href="javascript:void(0);"><span class="thumb"><\/span><\/a><em class="bookmark">bookmark<\/em><\/li>');f=$("#narrowContentsPageList ul");f.empty();for(t in i)r=o.clone(!0),u=parseInt(i[t]),makeNPageListBox(r,u),h=getPageNum(u),s=ebook.BookData.pageImgPathList_thumb[u],$("span.thumb",r).css("background-image","url("+s+")"),r.appendTo(f);makeNarrowThumbListPagerCurrent();bindPinchTouchAction($("body"),function(n,t){return IsNarrowIndexView()?!0:!1},function(n,t){if(IsNarrowIndexView()&&n.scale>1)return setTimeout(function(){changeNarrowView2(ebook.PageFlipper.narrowCurrentPageNum)},10),!1})}function makeNPageListBox(n,t){var u=t+1,i,r;u<=0||(i=ebook.BookData.pageTitleText[t],i=i.replace('"',""),n.find("a").attr("title",i),n.find(".span.thumb").attr("alt",i),n.find(".bookmark").toggle(isBookmarkPage(t)),r=n.find("a").attr("data-ref",t),r.click(function(n){var t=parseInt($(this).attr("data-ref"));return closeScrwindow(),setoffNarrowZoomView(),changeNarrowView2(getPageNum(t)),!1}))}function setoffNarrowZoomViewWithLink(){setoffNarrowZoomView();ebook.PageFlipper.makeLinkMapNarrowPage(ebook.PageFlipper.narrowCurrentPageNum,$("#narrowContents>div:eq(1)"))}function setoffNarrowZoomView(){_IsNarrowIndexView=!1;toscale_pos_anim=!1;toscale_view_anim=!1;hideAddress(!0);setNarrowZoomPageScale(1);$("#narrowContents,#narrowContentsRow").show();$("#narrowContentsPageList").hide();showNarrowZoomUI(!0);$("#narrowContentsZoom").hide()}function setupZoomNarrowView(){function a(n,t){var i,u;return(t<0&&(t=0),i=ebook.BookData.GetPageImgPath(t),$(".zpage-wrap:eq(0)",n).css({"background-image":"url("+i+")"}),n.attr("ref",t),!r||t<=0||t>=ebook.PageFlipper.pageCount-1)?n:(u=ebook.BookData.GetPageImgPath(t+(ebook.BookData.pageTopDirectionIsLeft?1:-1)),$(".zpage-wrap:eq(1)",n).css({"background-image":"url("+u+")"}),n)}function v(n,t){var i,u;return(t<0&&(t=0),i=ebook.BookData.GetPageImgThumbPath(t),$(".zpage-wrap:eq(0)",n).css({"background-image":"url("+i+")"}),n.attr("ref",t),!r||t<=0||t>=ebook.PageFlipper.pageCount-1)?n:(u=ebook.BookData.GetPageImgPath(t+(ebook.BookData.pageTopDirectionIsLeft?1:-1)),$(".zpage-wrap:eq(1)",n).css({"background-image":"url("+u+")"}),n)}function l(n,t,i){setTimeout($.proxy(function(){var n=new Image;AsyncImagesLoad(n,$.proxy(function(){var n=$(this.sel,this.q);this.src==n.attr("data-src")&&n.css("background-image","url("+this.src+")")},{q:this.q,sel:this.sel,src:this.src}));n.src=this.src},{q:n,sel:t,src:i}),0)}var r,n,s,u,t,e,o,c;NarrowZoomScaleUp=0;r=ebook.PageFlipper.isWideView();n=ebook.PageFlipper.narrowCurrentPageNum;n<0&&(n=0);n>=ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount-1);r&&n%2==0&&n--;$("#narrowContentsZoom>div").length==0&&(hideAddress(!0),s=$("#narrowContentsZoom"),s.empty().append('<div class="zpagel-wrap"><div id="zd01" class="page" ><div class="zpage-wrap"><\/div><div class="zpage-wrap"><\/div><\/div><div id="zd02" class="page" ><div class="zpage-wrap"><\/div><div class="zpage-wrap"><\/div><\/div><div id="zd03" class="page"><div class="zpage-wrap"><\/div><div class="zpage-wrap"><\/div><\/div><\/div>').css({"z-index":20,"margin-top":ebook.Narrow.stageTopMargin+"px","margin-bottom":ebook.Narrow.stageFootMargin+"px","margin-left":ebook.Narrow.pageViewMargin+"px","margin-right":ebook.Narrow.pageViewMargin+"px",overflow:"hidden",position:"relative",width:NarrowStageSize.width-ebook.Narrow.pageViewMargin*2+"px",height:NarrowStageSize.height-ebook.Narrow.stageTopMargin-ebook.Narrow.stageFootMargin+"px"}),s.show(),$("#narrowContentsZoom .zpagel-wrap").css({position:"absolute",padding:0,margin:0,border:0,width:NarrowStageFitSize.width+"px",height:NarrowStageFitSize.height+"px"}),$("#narrowContentsZoom .zpagel-wrap .page").css({padding:0,margin:0,border:0,position:"absolute","-webkit-trasform":"scale(1)",trasform:"scale(1)",width:NarrowStageFitSize.width+"px",height:NarrowStageFitSize.height+"px","background-size":"100% 100%"}),$("#narrowContentsZoom *").css({"-webkit-touch-callout":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"}));u=!r||n<=0||n>=ebook.PageFlipper.pageCount-1;t=getPageNum(n);t<0&&(t=0);t>=ebook.PageFlipper.pageCount-1&&(t=ebook.PageFlipper.pageCount-1);var f=$("#narrowContentsZoom .zpagel-wrap"),h=ebook.BookData.GetPageImgLargePath(t),i=$("div#zd03",f),y=i.attr("data-src")||!1;f.toggleClass("single",u);(h!=y||narrowZoomView_PageNum!=n)&&(e=$("div#zd02",f),o=$("div#zd01",f),narrowZoomView_PageNum=n,i.css({"z-index":10}),e.css({"z-index":9}),o.css({"z-index":8}),$(".zpage-wrap:eq(0)",i).css({"background-image":"url("+ebook.data.spacegif_url+")"}).attr({"data-src":h}),u&&$(".zpage-wrap:eq(1)",i).css({"background-image":"none"}),$(".zpage-wrap",e).css({"background-image":"none"}),$(".zpage-wrap",o).css({"background-image":"none"}),a(e,t),v(o,t),l(i,".zpage-wrap:eq(0)",h),u||(c=ebook.BookData.GetPageImgLargePath(t+(ebook.BookData.pageTopDirectionIsLeft?1:-1)),$(".zpage-wrap:eq(1)",i).css({"background-image":"url("+ebook.data.spacegif_url+")"}).attr({"data-src":c}),l(i,".zpage-wrap:eq(1)",c)))}function showNarrowZoomContents(){var n=narrowZoomView_PageNum;$("#narrowContentsZoom").show().css("opacity",1);$("#narrowContentsRow,#narrowContents").hide();showNarrowZoomUI(!0);NarrowZoom_Point=new Point(50,50);setTimeout($.proxy(function(){var n=getPageNum(this.pnum);ebook.BookData.PageZoomCallBack(n+1)},{pnum:n}),10)}function narrowZoomPageAuto(n,t){if(!thred_narrowFlipAfterEasing){tonscale_anim_step=typeof t!=_undefined?t:4;n||(n=new Point(NarrowStageFitSize.width/2+NarrowStageMargin.width-ebook.Narrow.pageViewMargin,NarrowStageFitSize.height/2+NarrowStageMargin.height-ebook.Narrow.stageTopMargin));setupZoomNarrowView();toscale_pos_anim=new Point((n.x-NarrowStageMargin.width-ebook.Narrow.pageViewMargin)*100/NarrowStageFitSize.width,(n.y-NarrowStageMargin.height-ebook.Narrow.stageTopMargin)*100/NarrowStageFitSize.height);toscale_view_anim=toscale_pos_anim.clone();removeLinkMapNarrow();var i=getNZoomMaxScale();tonscale_anim=i+1;tonscale_anim_step_val=!1;showNarrowZoomContents();narrowZoomPage_anim(function(){NarrowPageClickCount=0;var n=new Size(lastSize.width,lastSize.height);ebook.PageFlipper.makeLinkMapNarrowPage2(narrowZoomView_PageNum,$("#narrowContentsZoom #zd03"),n)})}}function narrowZoomOutPageAuto(n,t){thred_narrowFlipAfterEasing||(tonscale_anim_step=typeof t!=_undefined?t:4,n||(n=new Point(NarrowStageFitSize.width/2+NarrowStageMargin.width-ebook.Narrow.pageViewMargin,NarrowStageFitSize.height/2+NarrowStageMargin.height-ebook.Narrow.stageTopMargin)),toscale_view_anim=new Point((n.x-NarrowStageMargin.width-ebook.Narrow.pageViewMargin)*100/NarrowStageFitSize.width,(n.y-NarrowStageMargin.height-ebook.Narrow.stageTopMargin)*100/NarrowStageFitSize.height),toscale_pos_anim=new Point((NarrowZoom_Point.x*NarrowZoomPageScale-50+toscale_view_anim.x)/NarrowZoomPageScale,(NarrowZoom_Point.y*NarrowZoomPageScale-50+toscale_view_anim.y)/NarrowZoomPageScale),tonscale_anim=1,removeLinkMapNarrow(),tonscale_anim_step_val=!1,narrowZoomPage_anim(function(){NarrowPageClickCount=0;setoffNarrowZoomViewWithLink()}))}function narrowZoomPage_anim(n){var t,i;if(before_nscale_anim=NarrowZoomPageScale,t=getNZoomMaxScale(),tonscale_anim_step_val==!1&&(tonscale_anim_step_val=(tonscale_anim-NarrowZoomPageScale)/tonscale_anim_step),setNarrowZoomPageScale(NarrowZoomPageScale+tonscale_anim_step_val),NarrowZoomPageScale>t&&setNarrowZoomPageScale(t),NarrowZoomPageScale<1&&setNarrowZoomPageScale(1),i=new Point((50+(NarrowZoomPageScale*toscale_pos_anim.x-toscale_view_anim.x))/NarrowZoomPageScale,(50+(NarrowZoomPageScale*toscale_pos_anim.y-toscale_view_anim.y))/NarrowZoomPageScale),NarrowZoom_Point=i,setNzoomImagePos(),before_nscale_anim==NarrowZoomPageScale){n&&n();return}before_nscale_anim!=NarrowZoomPageScale&&setTimeout(function(){narrowZoomPage_anim(n)},100)}function setNzoomImagePos(){var n=getNZoomMaxScale();(isNaN(NarrowZoomPageScale)||typeof NarrowZoomPageScale==_undefined)&&setNarrowZoomPageScale(1);NarrowZoomPageScale<1&&setNarrowZoomPageScale(1);NarrowZoomPageScale>n&&setNarrowZoomPageScale(n);setNzoomImagePosScale(NarrowZoomPageScale)}function setNzoomImagePosScale(n){var l=$("#narrowContentsZoom .zpagel-wrap"),a=l.hasClass("single"),v=getNZoomMaxScale(),t,h,r,i;(isNaN(NarrowZoomPageScale)||typeof NarrowZoomPageScale==_undefined)&&setNarrowZoomPageScale(1);n<1&&(n=1);n>v&&(n=v);t=new Size(NarrowStageFitSize.width*(a?1:2)*n,NarrowStageFitSize.height*n);lastSize=new Size(NarrowStageFitSize.width*n,NarrowStageFitSize.height*n);var u={top:ebook.Narrow.stageTopMargin,left:ebook.Narrow.pageViewMargin,right:ebook.Narrow.pageViewMargin,bottom:ebook.Narrow.stageFootMargin},y=new Size(NarrowStageFitSize.width/2,NarrowStageFitSize.height/2),e=new Size((NarrowStageSize.width-u.left-u.right)/2,(NarrowStageSize.height-u.top-u.bottom)/2),o=new Point(e.width*100/t.width,e.height*100/t.height),s=new Point((t.width-e.width)*100/t.width,(t.height-e.height)*100/t.height);o.x>NarrowZoom_Point.x&&(NarrowZoom_Point.x=o.x);s.x<NarrowZoom_Point.x&&(NarrowZoom_Point.x=s.x);o.y>NarrowZoom_Point.y&&(NarrowZoom_Point.y=o.y);s.y<NarrowZoom_Point.y&&(NarrowZoom_Point.y=s.y);var f=new Point(NarrowZoom_Point.x*t.width/100-y.width,NarrowZoom_Point.y*t.height/100-y.height),p=NarrowStageMargin.clone(),c=e.width-t.width/2;c<0&&(c=0);f.x+=c;h=e.height-t.height/2;h<0&&(h=0);f.y+=h;f.x-=p.width;f.y-=p.height;l.css({width:t.width+"px",height:t.height+"px",top:-f.y+"px",left:-f.x+"px"});$("#narrowContentsZoom .zpagel-wrap .page").css({width:t.width+"px",height:t.height+"px"});$("#narrowContentsZoom .zpage-wrap").css({width:t.width*(a?1:.5)+"px",height:t.height+"px"});$("#narrowContentsZoom").css({width:NarrowStageSize.width-u.left-u.right+"px",height:NarrowStageSize.height-u.top-u.bottom+"px","margin-top":u.top+"px","margin-bottom":u.bottom+"px","margin-left":u.left+"px","margin-right":u.right+"px"});typeof ebook.BookData.ZoomNarrowRectCallBack!=_undefined&&(r=1e5,i={x:(f.x<0?0:f.x)*r/t.width,y:(f.y<0?0:f.y)*r/t.height,w:e.width*2*r/t.width,h:e.height*2*r/t.height},i.w>r&&(i.w=r),i.h>r&&(i.h=r),i.w+i.x>r&&(i.w=r-i.x),i.h+i.y>r&&(i.h=r-i.y),ebook.BookData.ZoomNarrowRectCallBack(getPageNum(narrowZoomView_PageNum),i))}function getNZoomMaxScale(){return ebook.BookData.pageImgSize_large.width/ebook.BookData.pageImgSize.width*(ebook.Compatibility.isSmartPhone?2.5:2)}function setNarrowZoomPageScale(n){var t=getNZoomMaxScale();NarrowZoomPageScale=n;__setSlideHandlePer(100-(n-1)/(t-1)*100)}function EVENT_pinch_page_narrow(n){var t=".pinch",r="#narrowPage",u=function(){setoffNarrowZoomViewWithLink()},i=function(){$(r).off(ebook.Compatibility.isTouchDevice?leb.e.tm+t:leb.e.mm+t).off(ebook.Compatibility.isTouchDevice?leb.e.te+t:leb.e.mu+t)},e=function(n){var o,r,t,s;if(n.type===leb.e.tm&&n.originalEvent.touches.length<2){i();return}if(IsNarrowIndexView()){i();return}if(n.type===leb.e.tm){var h=n.originalEvent.touches[0],c=n.originalEvent.touches[1],u=getMousePosEvent2(h),e=getMousePosEvent2(c),r=pointDist(u,e),l=new Point((u.x+e.x)/2,(u.y+e.y)/2);pinch_info.lastDist=r;pinch_info.scale=r/pinch_info.firstDist}else if(n.type===leb.e.mm&&isRightClick(n))o=getMousePosEvent(n),r=o.y,pinch_info.lastDist=r,pinch_info.scale=1+(r-pinch_info.firstDist)/100;else return f(),!1;return t=NarrowZoomPageScale*pinch_info.scale,t>1&&(NarrowZoomScaleUp=1),s=new Point((50+(t*pinch_info.pos.x-pinch_info.view_pos.x))/t,(50+(t*pinch_info.pos.y-pinch_info.view_pos.y))/t),NarrowZoom_Point=s,setNzoomImagePosScale(t),n.preventDefault(),!1},f=function(n){var t,r,f;if(i(),t=NarrowZoomPageScale*pinch_info.scale,IsNarrowIndexView()){if(t>1)return setTimeout(u,0),!1}else{if(r=getNZoomMaxScale(),(isNaN(t)||typeof t==_undefined)&&(t=1),t>r&&(t=r),t<=1)return t=1,!1&&NarrowZoomPageScale==1&&NarrowZoomScaleUp<1?(setNarrowZoomPageScale(1),setTimeout(function(){setNarrowIndexView(getPageNum(narrowZoomView_PageNum))},0),!1):(setNarrowZoomPageScale(1),u(),!1);else f=new Size(lastSize.width,lastSize.height),ebook.PageFlipper.makeLinkMapNarrowPage2(narrowZoomView_PageNum,$("#narrowContentsZoom #zd03"),f);setNarrowZoomPageScale(t)}return n.preventDefault(),!1},o=function(n){var o,u;if((i(),n.type!=leb.e.ts||!(n.originalEvent.touches.length<2))&&(n.type!=leb.e.md||isRightClick(n))&&!$("#sub_scrwindow,#scrwindow .mask_layer,#narrowTools").is(":visible")&&!thred_narrowFlipAfterEasing){if(n.type===leb.e.ts){var l=n.originalEvent.touches[0],a=n.originalEvent.touches[1],s=getMousePosEvent2(l),h=getMousePosEvent2(a),u=pointDist(s,h),c=new Point((s.x+h.x)/2,(s.y+h.y)/2);pinch_info.firstDist=u;pinch_info.lastDist=u;pinch_info.firstPos=c;pinch_info.scale=1;narrowclick_last_mousePos=c}else if(n.type===leb.e.md&&isRightClick(n)){IsNarrowIndexView()||setNarrowIndexView(getPageNum(narrowZoomView_PageNum));return;o=getMousePosEvent(n);u=o.y;pinch_info.firstDist=u;pinch_info.lastDist=u;pinch_info.firstPos=o;pinch_info.scale=1;narrowclick_last_mousePos=o}view_pos=new Point((pinch_info.firstPos.x-NarrowStageMargin.width-ebook.Narrow.pageViewMargin)*100/NarrowStageFitSize.width,(pinch_info.firstPos.y-NarrowStageMargin.height-ebook.Narrow.stageTopMargin)*100/NarrowStageFitSize.height);NarrowZoomPageScale==1&&(NarrowZoom_Point=new Point(50,50));pinch_info.view_pos=view_pos;pinch_info.pos=new Point((NarrowZoom_Point.x*NarrowZoomPageScale-50+view_pos.x)/NarrowZoomPageScale,(NarrowZoom_Point.y*NarrowZoomPageScale-50+view_pos.y)/NarrowZoomPageScale);IsNarrowIndexView()||(setupZoomNarrowView(),showNarrowZoomContents());n.preventDefault();$(r).on(ebook.Compatibility.isTouchDevice?leb.e.tm+t:leb.e.mm+t,e).one(ebook.Compatibility.isTouchDevice?leb.e.te+t:leb.e.mu+t,f);removeLinkMapNarrow();EVENT_flick_page_narrow.clearbind()}};o(n)}function init_flick_page_narrow(){EVENT_flick_page_narrow(!1)}function xblur(n){setTimeout(function(){$(n).blur();$("body").focus()},10)}function bindPinchTouchAction(n,t,i,r){var k=window,w=ebook.Compatibility.isTouchDevice,a=ebook.Compatibility.isWinTouchDevice,u={firstPinchDist:!1,lastPinchDist:!1,firstPoint:!1,firstEvent:!1,lastEvent:!1,lastPinchCenterPos:!1,scale:1},f=function(){return s(leb.e.ts,leb.e.md,leb.e.mspd)},e=function(){return s(leb.e.tm,leb.e.mm,leb.e.mspm)},o=function(){return s(leb.e.te,leb.e.me,leb.e.mspe)},s=function(n,t,i){var r=".bindPinchTouchAction";return(a?i:w?n:t)+r},h=function(){$(n).off(e()).off(o())},v=function(n){return typeof n.originalEvent!="undefined"&&typeof n.originalEvent.touches!="undefined"&&n.originalEvent.touches.length>1||typeof n.originalEvent.changedTouches!="undefined"&&n.originalEvent.changedTouches.length>1?!0:!1},y=function(n){return typeof n.originalEvent.touches!="undefined"?n.originalEvent.touches:typeof n.changedTouches!="undefined"?n.changedTouches:null},p=function(t,i){var w=typeof t.originalEvent.pointerId!="undefined"?t.originalEvent.pointerId:typeof t.originalEvent.identifier!="undefined"?t.originalEvent.identifier:-1;if(typeof i=="string"&&i==="entry"||v(t)){typeof i=="string"&&i==="entry"&&logw2("pinch out mode");var l=y(t),a=l[0],p=l[1],f=new Point(a.pageX,a.pageY),s=new Point(p.pageX,p.pageY);u.firstPinchDist=pointDist(f,s);u.firstPoint=new Point((f.x+s.x)/2,(f.y+s.y)/2);u.scale=1;u.lastEvent=t;u.firstEvent=t;typeof r!="undefined"&&r(u,t);h();$(n).bind(e(),b).one(o(),c)}},b=function(n){if(v(n)){var f=y(n),e=f[0],o=f[1],i=getMousePosEvent2(e),r=getMousePosEvent2(o);u.lastPinchDist=pointDist(i,r);u.lastPinchCenterPos=new Point((i.x+r.x)/2,(i.y+r.y)/2);u.scale=u.lastPinchDist/u.firstPinchDist;u.lastEvent=n;typeof t=="function"&&(t(u,n)||c(n))}else c(n);return!1},c=function(n){return h(),typeof i=="function"&&i(u,n),!0},l=function(n){var t=typeof n.originalEvent!="undefined"?n.originalEvent:n;switch(n.type){case leb.e.mspd:case leb.e.mspm:case leb.e.mspe:default:break}};return h(),$(n).off(f()),!1&&a?($(n).bind(f(),l),$(n).bind(e(),l),$(n).bind(o(),l)):$(n).bind(f(),p),p}function clicks(n,t){var i=".clicks",r=n,f=-1,e={},h=!1,c=!1,s=!1,l=1,o,u;typeof t=="function"?s=t:(h=t.start_func||!1,c=t.move_func||!1,s=t.end_func||!1,l=t.timeout||0,e=t.param||{});(typeof r=="string"||typeof r=="object")&&(r=$(n));o=-1;u=function(){o!=-1&&clearTimeout(o);f=-1;o=-1;r.off(ebook.Compatibility.isTouchDevice?leb.e.te+i:leb.e.mu+i).off(ebook.Compatibility.isTouchDevice?leb.e.tm+i:leb.e.mm+i)};r.bind(ebook.Compatibility.isTouchDevice?leb.e.ts+i:leb.e.md+i,function(n){var t,a;if((ebook.Compatibility.isTouchDevice||!isRightClick(n))&&(n.type!==leb.e.ts||!(n.originalEvent.touches.length>1))&&(u(),f=0,h===!1||(t=h(n,e),t!==!1))){r.bind(ebook.Compatibility.isTouchDevice?leb.e.tm+i:leb.e.mm+i,function(n){if(n.type===leb.e.tm&&n.originalEvent.touches.length>1){u();return}return f>=0&&(f++,f>10)?(u(),!1):c!==!1?c(n,e):!0}).one(ebook.Compatibility.isTouchDevice?leb.e.te+i:leb.e.mu+i,function(n){return u(),$.proxy(s,this)(n,e)});l>0&&(a=this,o=setTimeout(function(){u();$.proxy(s,a)(n,e)},1e3*l))}})}function pageHintInit(){var t='<img id="_pageHintBase" class="_pageHintRectClass" border="0" src="'+ebook.data.img_cmn_base_path+'spacer.gif"><div id="_pageHintRect" class="_pageHintRectClass" ><div><a target="_blank" ><img border="0" src="'+ebook.data.img_cmn_base_path+'spacer.gif" alt="eBook" ><\/a><\/div><\/div><style type="text/css">._pageHintRectClass {display: none; z-index: 10; position: absolute; overflow: hidden; top: 0; left: 0; border: none; z-index: 1; width: 50%; height:100%; }._pageHintRectClass div {left: 50%; top: 50%; width: 0px; height: 0px; position: relative; margin: 0px; padding: 0px; }._pageHintRectClass a img{position: relative; left: -'+pageHintImageSize.x/2+"px; top: -"+pageHintImageSize.y/2+"px; width: "+pageHintImageSize.x+"px; height: "+pageHintImageSize.y+"px; display: block; border: none; margin: 0px; padding: 0px;z-index:120; }<\/style>";$("#stage").append(t).css({"z-index":1});var n=function(){ebook.BookData.pageHintEnable&&(ebook.PageFlipper.isWideMode()&&(ebook.PageFlipper.currentPageNum_left<=0||ebook.PageFlipper.pageCount-2<=ebook.PageFlipper.currentPageNum_left)?showPageHint(!0):showPageHint(!1))},i=ebook.PageFlipper.changePageMode,r=ebook.BookData.PageChangeCallBack;ebook.PageFlipper.changePageMode=function(t){i(t);setTimeout(n,100)};ebook.BookData.PageChangeCallBack=function(t){r(t);setTimeout(n,100)};setTimeout(n,500)}function showPageHint(n){function u(){var u=pageHintImageUrl,f=pageHintLinkUrl;if(t){var n=t==1?0:MathRound($("#stage").width()/2),e={background:"url('"+u+"') no-repeat center center",left:n+"px"},o={left:n+"px","z-index":25};r.css(e).show();$("div>a",i).attr("href",f);i.css(o).show()}}var r,i,t;(n||showPageHint_visible!=n)&&(showPageHint_visible=n,r=$("#_pageHintBase"),i=$("#_pageHintRect"),n?(t=!1,ebook.PageFlipper.currentPageNum_left<=0?t=1:ebook.PageFlipper.pageCount-2<=ebook.PageFlipper.currentPageNum_left&&(t=2),$.getJSON(pageHintInfoUrl,null,function(n,t){(t=="success"||t=="notmodified")&&(n.pageHintImageSize&&(pageHintImageSize=n.pageHintImageSize,$("._pageHintRectClass a img").css({left:"-"+pageHintImageSize.x/2+"px",top:"-"+pageHintImageSize.y/2+"px",width:pageHintImageSize.x+"px",height:pageHintImageSize.y+"px"})),pageHintLinkUrl=n.pageHintLinkUrl||pageHintLinkUrl,pageHintImageUrl=n.pageHintImageUrl||pageHintImageUrl);u()})):(r.hide(),i.hide()))}function pagePrint(n){var u,t,i,r;stopAutoPlay();u=location.href.split("?")[0].split("#")[0];t=typeof n=="undefined"?getPrintPageSelectSide():n;t>=0&&(i=1,r=getPageNum(ebook.PageFlipper.currentPageNum_left+1),t==0?i=2:t==2&&(r+=ebook.BookData.pageTopDirectionIsLeft?1:-1),window.open(u+"?print=1&page="+r+"&type="+i,"_blank"))}function printingPage(n){var u;IE_SelectHide();$("body").css("background-image","none").children().hide();$("#print_page").show();var o=parseInt(n.page),t=parseInt(n.type),i=o+(ebook.BookData.pageTopDirectionIsLeft?-1:1);i>=ebook.BookData.pageImgPathList.length&&(i=ebook.BookData.pageImgPathList.length-1);var s=o,h=ebook.BookData.pageImgSize.height/ebook.BookData.pageImgSize.width,r=t==2?ebook.data.printPageWidth:ebook.data.printPageWidth*2;$("#print_page").css({width:r*(t==2?2:1)+"px"});$("body").css({background:"none"});$("html").css({position:"static"});u=1;t==2&&u++;var c=function(){--u<=0&&(setTimeout("window.print();",500),setTimeout(function(){t==2?ebook.BookData.PrintPageCallBack(i,s):ebook.BookData.PrintPageCallBack(i,-1)},1))},f=$("<img>"),e=$("<img>");f.on("load",c);e.on("load",c);f.attr("src",ebook.BookData.GetPageImgLargePath(i)).width(r).height(r*h);f.appendTo("#print_page .page_left");t==2?(e.attr("src",ebook.BookData.GetPageImgLargePath(s)).width(r).height(r*h),e.appendTo("#print_page .page_right")):$("#print_page .page_right").hide()}function initOptinalLayer(){var n='<div id="sub_contents_block" class="clearfix" style="display:none;"><div class="close"><div class="menu_back"><a href="javascript:void(0);" title="Back"><img src="'+ebook.data.sp_icon_path+'" width="50" /><\/a><\/div><\/div><div id="sub_contents_block_area"><\/div><div id="download_frame" ><ul id="download_select_area"><li id="download_left" idx="0" class="download_select"><a href="javascript:void(0);"><img src="'+ebook.data.img_cmn_base_path+'print_area_left.gif" alt="" width="125" height="73" /><\/a><\/li><li id="download_right" idx="1" class="download_select"><a href="javascript:void(0);"><img src="'+ebook.data.img_cmn_base_path+'print_area_right.gif" alt="" width="125" height="73" /><\/a><\/li><li id="download_cur" idx="0" class="download_select2"><a href="javascript:void(0);">'+ebook.data.context_download_this_page+'<\/a><\/li><li id="download_all" idx="2" class="download_select2"><a href="javascript:void(0);">'+ebook.data.context_download_all_page+'<\/a><\/li><\/ul><ul id="download_ctrl"><li class="download_cancel menu_back"><a href="javascript:void(0);" title="'+ebook.data.context_cancel+'">'+ebook.data.context_cancel+'<\/a><\/li><li class="download_submit " ><a href="javascript:void(0);" title="'+ebook.data.context_download+'">'+ebook.data.context_download+"<\/a><\/li><\/ul><\/div><\/div>";n.replace;$("#sub_scrwindow").append(n)}function initDownloadDialog(){function n(){$("#scrwindow").removeClass("disp_download_layer");IE_SelectShow()}$("#download_select_area li").bind(leb.e.md+" "+leb.e.ts,function(){$("#download_select_area li").removeClass("select");$(this).addClass("select")});$("#download_ctrl .download_submit").click(function(){var i=$("#download_select_area li.select").attr("idx")||!1,t,r;i!==!1&&(i==2?(t=getDownloadPath(!0),setTimeout(function(){ebook.BookData.DownloadCallBack(0,t)},1),setTimeout(function(){window.open(t,"_blank")},1)):(t=getDownloadPath(!1,i==0),r=getDownloadPageNum(i==0),setTimeout(function(){ebook.BookData.DownloadCallBack(r,t)},1),setTimeout(function(){window.open(t,"_blank")},1)),n())});$("#download_ctrl .download_cancel ").click(n)}function getDownloadPath(n,t){var r,i,u;return(typeof t==_undefined&&(t=!0),n)?(r=ebook.BookData.downloadList&&ebook.BookData.downloadList.all?!0:!1,r?ebook.BookData.downloadList.all||!1:!1):(i=getDownloadPageNum(t),u=typeof ebook.BookData.downloadList[i]!=_undefined,u?ebook.BookData.downloadList[i]||!1:!1)}function getDownloadPageNum(n){var t=getPageNum();return ebook.PageFlipper.isNarrowMode()?t++:n?t++:t+=ebook.BookData.pageTopDirectionIsLeft?2:0,t<=0&&(t=1),ebook.PageFlipper.pageCount<t&&(t=ebook.PageFlipper.pageCount),t}function displayDownloadDialog(){var t,n,i;$("#download_select_area li").removeClass("select");t=ebook.PageFlipper.isWideView();n=ebook.PageFlipper.narrowCurrentPageNum;n<0&&(n=0);n>=ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount-1);t&&n%2==0&&n--;i=getDownloadPath(!0)!=!1;$("#sub_contents_block #download_all").toggle(i);i&&$("#download_all a").attr({"data-href":ebook.BookData.downloadList.all,target:"_blank"});ebook.PageFlipper.isNarrowMode()?($("#sub_contents_block .download_select").hide(),!t||n<=0||n>=ebook.PageFlipper.pageCount-1?$("#sub_contents_block #download_cur").toggle(!0).addClass("select"):($("#sub_contents_block #download_left").toggle(getDownloadPath(!1,!0)?!0:!1),$("#sub_contents_block #download_right").toggle(getDownloadPath(!1,!1)?!0:!1),$("#sub_contents_block #download_cur").toggle(!1))):($("#sub_contents_block #download_cur").hide(!1),$("#sub_contents_block #download_left").toggle(havPageLeft()&&getDownloadPath(!1,!0)?!0:!1),$("#sub_contents_block #download_right").toggle(havPageRight()&&getDownloadPath(!1,!1)?!0:!1),$(havPageLeft()?"#download_select_area #download_left":"#download_select_area #download_right").addClass("select"));ebook.Compatibility.isIE7&&EVENT_resizeContainer();IE_SelectHide();$("#sub_scrwindow").attr("class","").addClass("disp_download_layer")}function displayYoutubeLayer(n,t,i){var e=n,u=$(window).width(),r,f;u<t&&(i=i/t*u,t=u);r="";t&&(r+=' width = "'+t+'" ');i&&(r+=' height = "'+i+'" ');f='<iframe id="youtubeVideo" style="top:50%;left:50%;position:absolute;margin-top:-'+i/2+"px;margin-left:-"+t/2+'px"  '+r+' src="'+e+'" frameborder="0" allowfullscreen><\/iframe>';$(f).appendTo("#sub_contents_block_area");$("#sub_contents_block .menu_back").one("click",function(){$("#sub_contents_block_area").empty();$("#sub_scrwindow").removeClass("disp_optional_layer");IE_SelectShow()});IE_SelectHide();$("#sub_scrwindow").addClass("disp_optional_layer")}function displayGoogleMapLayer(n,t,i){var e=n,u=$(window).width(),r,f;u<t&&(i=i/t*u,t=u);r={top:"50%",left:"50%",position:"absolute","margin-top":-i/2+"px","margin-left":-t/2+"px"};t&&(r.width=t+"px");i&&(r.height=i+"px");f=$('<div id="ebookGoogleMap_canvas"><\/div>').css(r);$(f).appendTo("#sub_contents_block_area");$("#sub_contents_block .menu_back").one("click",function(){$("#sub_contents_block_area").empty();$("#sub_scrwindow").removeClass("disp_optional_layer");IE_SelectShow()});IE_SelectHide();$("#sub_scrwindow").addClass("disp_optional_layer")}function removeLinkMap(){setTimeout($.proxy(ebook.Linkmap.makeLinkMapPage_sub_delay,{removeOnly:!0}),1)}function makeLinkMap(){removeLinkMap();havPageLeft()&&ebook.Linkmap.makeLinkMapPage(getPageNum(ebook.PageFlipper.currentPageNum_left),!0);havPageRight()&&ebook.Linkmap.makeLinkMapPage(getPageNum(ebook.PageFlipper.currentPageNum_left+1),!1)}var start_time=new Date,ebook={},pagingAudioObj,loading_now,dataLoaded,autoPlayFlag,ClassPlayButton,_EVENT_resizeContainer,_EVENT_resizeContainer_lasttim,makeMenuWidth,AsyncImagesLoad,MouseButtonTypeEnum,LastmousePos,_loadPageImage,__setSlideHandlePer,EVENT_narrow_tools_data,_IsNarrowIndexView,npager_pagecnt,makeNarrowThumbListPager_maked,lastSize,EVENT_flick_page_narrow,makeLinkMapPage,makeLinkMapPage_sub;ebook.BookData={};ebook.ver="4.1.21";ebook.major_ver="4.1b";ebook.minor_ver="4.1b.808190000";ebook.data={};ebook.data.auto_move=!1;ebook.data.auto_moveToPos=!1;ebook.data.auto_pageNext=!1;ebook.data.wide_width_min=0;ebook.data.bookmark_buffer=[];ebook.data.bookmark_imgSize=null;ebook.data.bookmark_imgOffs=null;ebook.data.hitWidthPar=18;ebook.data.minScale=30;ebook.data.printPageWidth=550;ebook.data.stageTopMargin=0;ebook.data.stageFootMargin=40;ebook.data.pageViewMargin=10;ebook.data.img_cmn_base_path="contents/image/cmn/";ebook.data.bookmark_thumb_url="bookmark.png";ebook.data.link_thumb_url="link_w.png";ebook.data.spacegif_url="spacer.gif";ebook.data.sp_icon_path="sp_icon.png";ebook.data.bookmarktag_img=!1;ebook.data.spacer_img=!1;ebook.data.context={ja:{},en:{},zh:{}};ebook.data.context.ja.search_paging_text="{0}{1}{2}";ebook.data.context.ja.search_result="{1}{0}";ebook.data.context.ja.search_not_found="";ebook.data.context.ja.download_this_page="";ebook.data.context.ja.download_all_page="";ebook.data.context.ja.cancel="Cancel";ebook.data.context.ja.download="Download";ebook.data.context.en.search_paging_text="Page {1} - {2} (total:{0})";ebook.data.context.en.search_result='Search "{1}": {0}';ebook.data.context.en.search_not_found="Did not match any data.";ebook.data.context.en.download_this_page="Currnet page";ebook.data.context.en.download_all_page="All pages";ebook.data.context.en.cancel="Cancel";ebook.data.context.en.download="Download";ebook.data.context.zh.search_paging_text="{0}{1}{2}";ebook.data.context.zh.search_result="{1}{0}";ebook.data.context.zh.search_not_found="";ebook.data.context.zh.download_this_page="";ebook.data.context.zh.download_all_page="";ebook.data.context.zh.cancel="";ebook.data.context.zh.download="";ebook.data.specialNodes=/^(input|textarea|select|option|button|embed|object)$/;ebook.data.specialNodesForTouch=/^(input|textarea|select|option|button|embed|object|a)$/;ebook.pageCache={};ebook.pageCache.pages=[];ebook.pageCache.pagesl=[];ebook.pageCache.pagess=[];ebook.Compatibility={};ebook.Compatibility.isSupportCanvas=!0;ebook.Compatibility.isTouchDevice=!1;ebook.Compatibility.isAppleDev=!1;ebook.Compatibility.isIPad=!1;ebook.Compatibility.isAndroid=!1;ebook.Compatibility.isIE=!1;ebook.Compatibility.isIE6=!1;ebook.Compatibility.isWinTouchDevice=!1;ebook.Compatibility.isLandscape=0;ebook.PageFlipper={};ebook.PageFlipper.Html5={};ebook.PageFlipper.hitPageSide=!1;ebook.PageFlipper.handleStartPos=!1;ebook.PageFlipper.pageDrag_status=!1;ebook.PageFlipper.pageCount=0;ebook.PageFlipper.currentPageNum_left=-1;ebook.PageFlipper.bookScale=100;ebook.PageFlipper.basePage_size={};ebook.PageFlipper.canvas_size={};ebook.PageFlipper.diaplayPage_size={};ebook.PageFlipper.diaplayPage_offset={};ebook.PageFlipper.canvas_offset=!1;ebook.PageFlipper.canvasl_size=!1;ebook.PageFlipper.hit_startPageSide=!1;ebook.PageFlipper.hit_startMouseX=!1;ebook.PageFlipper.handlePos_old=!1;ebook.PageFlipper.moveHandlePos=!1;ebook.PageFlipper.realMousePos={};ebook.PageFlipper.realMouse={};ebook.PageFlipper.ctx1=!1;ebook.PageFlipper.ctx2=!1;ebook.data.loading_stack=0;ebook.data._viewModeWide="wide";ebook.data._viewModeNarrow="narrow";ebook.data._viewModeZoom="zoom";ebook.PageFlipper.viewMode=0;ebook.PageFlipper.old_hit_mouseOverState=!1;ebook.Narrow={};ebook.Narrow.stageTopMargin=0;ebook.Narrow.stageFootMargin=48;ebook.Narrow.pageViewMargin=0;ebook.Narrow.dblclickZoom=!0;ebook.data.local={};leb={e:{md:"mousedown",mm:"mousemove",mu:"mouseup",mv:"mouseover",mo:"mouseout",mw:"mousewheel",ts:"touchstart",tm:"touchmove",te:"touchend",tc:"touchcancel",gs:"gesturestart",gc:"gesturechange",ge:"gestureend",mspd:"MSPointerDown",mspm:"MSPointerMove",mspu:"MSPointerUp",mspc:"MSPointerCancel",d:0}};_undefined="undefined";pagingAudioObj=!1;loading_now=!1;dataLoaded=!1;ebook._event={};autoPlayFlag=!1;ClassPlayButton=" #navi> #menu_auto_play ";_EVENT_resizeContainer=0;_EVENT_resizeContainer_lasttim=0;ebook.PageTool={};ebook.PageTool.search_keyword="";ebook.PageTool.searchMode=!1;ebook.PageTool.searchResultList=[];ebook.PageTool.searchThumbList=[];ebook.PageTool.search_thumbcnt=!1;ebook.PageTool.pager_pagecnt=20;ebook.PageTool.updateMenuset=function(){ebook.PageTool.updateDlMenuset();ebook.PageTool.updatePrintMenuset();ebook.PageTool.updateBookmarkMenuset();ebook.PageTool.updatePageSlider();ebook.PageTool.updateAdjustHeight();ebook.PageTool.setCurrentHerePageList();ebook.PageTool.setCurrentHereThumbList();ebook.PageTool.openSidePanel(!0)};ebook.PageTool.openPrintMenu=function(){ebook.PageTool.openSidePanel(!1);ebook.PageTool.closeAllSecNav();ebook.PageTool.openSecnavi($("#ctrl_panel .icon_print").focus(),!1)};ebook.PageTool.openPageListMenu=function(){ebook.PageTool.openSidePanel(!1);ebook.PageTool.closeAllSecNav();$("#icon_list").click()};ebook.PageTool.openDownloadMenu=function(){ebook.PageTool.openSidePanel(!1);ebook.PageTool.closeAllSecNav();ebook.PageTool.openSecnavi($("#ctrl_panel .icon_download").focus(),!1)};ebook.PageTool.openThumbListMenu=function(){ebook.PageTool.openSidePanel(!1);ebook.PageTool.closeAllSecNav();$("#icon_thumb").click()};ebook.PageTool.updateAdjustHeight=function(){var n=$("#list_and_thumb").position(),t=$("#ctrl_nav").outerHeight();n&&n.top||(n={top:100});$("#list_and_thumb .lists ").css({height:t-n.top+"px"});$("#list_and_thumb .thumbs ").css({height:t-n.top+"px"});ebook.PageTool.setMiddleCtrlPanel()};ebook.PageTool.updateResize=function(){ebook.PageTool.updateAdjustHeight()};$(window).on("load resize",ebook.PageTool.updateResize);ebook.PageTool.calc_page_contain=function(n,t){var r=n,u=t,e=r/u,f=ebook.BookData.pageImgSize.width/ebook.BookData.pageImgSize.height,i={};return e<f?(i.width=r,i.height=r/f,i.margin_top=(u-r/f)/2,i.margin_left=0):(i.width=f*u,i.height=u,i.margin_top=0,i.margin_left=(r-u*f)/2),i};ebook.PageTool.pageSlider=function(){function k(){var n=getPageNum(ebook.PageFlipper.currentPageNum_left);ebook.BookData.pageTopDirectionIsLeft&&n++;ebook.BookData.singlePageMdoe&&(n=ebook.PageWide.zoomPage_pageNum+1);i=n;i<f&&(i=f);i>r&&(i=r);p(n)}function d(n,t){var c,r,e;if(u=ebook.PageTool.calc_page_contain(96,96),ebook.BookData.singlePageMdoe)return et(n,t);var s=typeof n!=_undefined?n:i,t=typeof t!=_undefined?t:!1,f=$("#pageslider .ps-thumb ");$(".ps-thumb-num",f).toggle(t);t&&(c=$(".ps-thumb-num",f).text(s),setTimeout(function(){var n=$(".ps-thumb-wrap",f).innerWidth(),t=$(".ps-thumb-num",f).outerWidth();$(".ps-thumb-num",f).css({left:(n-t)/2+"px"})},0));r=$(".thumbImg",f);r.css({"min-width":"initial","line-height":0,"white-space":"nowrap"});var h=s-1-s%2,o=h+(ebook.BookData.pageTopDirectionIsLeft?0:1),l={float:"initial",margin:"0 auto",display:"inline-block",width:u.width+"px",height:u.height+"px","background-color":"rgba(6,6,6,0.1)",padding:u.margin_top+"px "+u.margin_left+"px ",opacity:1,filter:"alpha(opacity = 100)","ms-filter":'"alpha(opacity=100)"'};$("img",r).css(l);$("img:first",r).css({"padding-right":0});$("img:last",r).css({"padding-left":0});o>=0&&o<ebook.PageFlipper.pageCount?$("img:first",r).attr({src:ebook.BookData.pageImgPathList_thumb[o],alt:ebook.BookData.pageTitleText[o]}):$("img:first",r).css({opacity:0,filter:"alpha(opacity = 0)","ms-filter":'"alpha(opacity=0)"'});e=h+(ebook.BookData.pageTopDirectionIsLeft?1:0);e>=0&&e<ebook.PageFlipper.pageCount?$("img:last",r).attr({alt:ebook.BookData.pageTitleText[e],src:ebook.BookData.pageImgPathList_thumb[e]}):$("img:last",r).css({opacity:0,filter:"alpha(opacity = 0)","ms-filter":'"alpha(opacity=0)"'})}function et(n,t){var o=typeof n!=_undefined?n:i,t=typeof t!=_undefined?t:!1,r=$("#pageslider .ps-thumb "),h,f,e,s;$(".ps-thumb-num",r).toggle(t);t&&(h=$(".ps-thumb-num",r).text(o),setTimeout(function(){var n=$(".ps-thumb-wrap",r).innerWidth(),t=$(".ps-thumb-num",r).outerWidth();$(".ps-thumb-num",r).css({left:(n-t)/2+"px"})},0));f=$(".thumbImg",r);f.css({"min-width":"initial","line-height":0});e=o-1;s={float:"initial",margin:"0 auto",display:"inline-block",width:u.width+"px",height:u.height+"px","background-color":"rgba(6,6,6,0.1)",padding:u.margin_top+"px "+u.margin_left+"px "};$("img",f).css(s);$("img:first",f).attr("src",ebook.BookData.pageImgPathList_thumb[e]).attr("alt",ebook.BookData.pageTitleText[e]).show();$("img:last",f).css({"padding-left":0}).hide()}function g(i){var r=$(e,n).width(),u=$(c,n).width();i<0&&(i=0);i>r&&(i=r);$("#pageslider .ps-thumb").css({left:t.lt.left+i+u/2+"px"}).show()}var n=!1,nt="#pageslider",c=".ps-handle",e=".ps-bar",l=".ps-range",o=".ps-info",t={pos:new Point(0,0),lt:new Point(0,0),size:new Size(0,0),spos:new Point(0,0),npos:new Point(0,0),viewposx:0,binded:!1,vitemCount:0},i,f=1,r=100,a=ebook.Compatibility.getMoveTarget($(e,n)),tt=function(){var i=$(e,n),r=$(c,n),u=parseInt(i.width()),f=parseInt(i.height()),o=parseInt(r.width());t.lt=i.offset();t.size=new Size(u-o,f)},p=function(n){per=(n-f+1)*100/(r-f+1);per>100&&(per=100);per<0&&(per=0);w(per)},w=function(u){u>100&&(u=100);u<0&&(u=0);t.per=u;var f=t.size.width*(100-u)/100;ebook.BookData.pageTopDirectionIsLeft?(f=t.size.width-f,$(l,n).css({width:f+"px"})):($(l,n).css({right:"0"}),$(l,n).css({width:t.size.width-f+"px"}));f=t.size.width*(100-u)/100;ebook.BookData.pageTopDirectionIsLeft&&(f=t.size.width*u/100);$(c,n).css("left",f+"px");$(o,n).text(i+"/"+r)},it=function(){return per=(i-f)*100/(r-f),per>100&&(per=100),per<0&&(per=0),per},v=function(i){var r,u;return t.lt=$(e,n).offset(),r=i.x-t.lt.left,r<0&&(r=0),r>t.size.width&&(r=t.size.width),u=Math.round(r*1e4/t.size.width)/100,ebook.BookData.pageTopDirectionIsLeft||(u=100-u),u},y=function(n){i=b(n);w(n)},b=function(n){var t=Math.round(f+(r-f)*n/100);return t>r&&(t=r),t},rt=function(n){var t=v(n);y(t)},s=!1,h=function(n,t){var i=".dragslider",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},st=!1,ut=0,ft=function(n){var t={},u,f;t.st_per=it();t.per_dist=n-t.st_per;t.per_dir=n>t.st_per?1:-1;t.to_per=n;t.idx=ut++;u=function(n){var t=n.st_per+n.per_dist*n.value;y(t)};f=function(n){var u=n.st_per+n.per_dist*n.value,t;y(u);t=ebook.BookData.pageTopDirectionIsLeft?i-1:r-i;pageView_jumpPage(t)};ebook.easing.setEasing(t,"value",6,0,1,u,f,"easeOutQuad")},u=!1,ot=function(){n=$(nt).setDisableSelection();$(e,n).setDisableSelection().off(h(leb.e.ts,leb.e.md)).on(h(leb.e.ts,leb.e.md),function(u){var l=function(){$(a).off(h(leb.e.tm,leb.e.mm));$(a).off(h(leb.e.te,leb.e.mu))},y,f,e;if(u.target.className!=o){if(y=u.type===leb.e.ts?u.originalEvent.touches[0]:u,u.type===leb.e.ts&&u.originalEvent.touches.length>1){s=!1;return}s=!0;f=getMousePosEvent(y);t.spos=f.clone();t.npos=f.clone();e=0;$(a).one(h(leb.e.te,leb.e.mu),function(n){if(s){if(s=!1,e==0){var t=v(f)||0;t>=0&&ft(t)}else $("#pageslider .ps-thumb").hide(),pageView_jumpPage(ebook.BookData.pageTopDirectionIsLeft?i-1:r-i);return e=0,n.preventDefault(),l(),!1}}).on(h(leb.e.tm,leb.e.mm),function(i){var f=i.type===leb.e.tm?i.originalEvent.touches[0]:i,r,u;if(i.type===leb.e.tm&&i.originalEvent.touches.length>1){s=!1;l();return}r=getMousePosEvent(f);t.npos=r.clone();rt(r);d();u=$(c,n).position();g(u.left);e++;i.preventDefault()});return u.preventDefault(),!1}}).on(leb.e.mv,function(i){if(!s&&i.target.className!=o){var r=".overthumb",u=function(){$("#pageslider .ps-thumb").hide();$(e,n).off(leb.e.mm+r).off(leb.e.mo+r)},f=function(i){var r=getMousePosEvent(i),f=v(r),o=b(f),u;d(o,!0);t.lt=$(e,n).offset();u=r.x-t.lt.left;g(u)};f(i);$(this).on(leb.e.mm+r,function(n){if(s){u();return}f(n)}).one(leb.e.mo+r,function(n){u()})}});$(o,n).on("click",function(){function i(){var t=$(o,n).find("input").remove().val()}function r(){var i=$("input",t),n=parseInt($(i).val())||!1;n!==!1&&(n<1?n=1:n>ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount),$(this).val(n),ebook.BookData.pageTopDirectionIsLeft||(n=ebook.PageFlipper.pageCount-n+1),pageView_jumpPage(n-1))}var t=$(o,n),u=($(o,n).width()||30)+3;$(t).append('<input type=text maxlength=4 style="width:'+u+'px;ime-mode: disabled;" formnovalidate placeholder="Page" >');$("input",t).focus().on("blur",function(){r();i()}).on("keyup keydown keypress ",function(n){var t=n||window.event;if(ebook.Compatibility.isIE6&&(t=window.event),t.type=="keypress"){if(t.which>57)return!1}else if(t.type!="keydown"&&t.type=="keyup")switch(t.keyCode){case 13:r();i();break;case 27:i();break}})})};return ot(),r=ebook.PageFlipper.pageCount,tt(),p(i),ebook.PageTool.updatePageSlider=k,k(),this};ebook.PageTool.updatePrintMenuset=function(){var n=$("#ctrl_panel .print_menuset");ebook.PageFlipper.isNarrowMode()||($(".widepage",n).toggle(havPageLeft()&&havPageRight()),$(".leftpage",n).toggle(havPageLeft()),$(".rightpage",n).toggle(havPageRight()))};ebook.PageTool.updateDlMenuset=function(){var n=$("#ctrl_panel .download_menuset");ebook.PageFlipper.isNarrowMode()||($(".allpage",n).toggle(getDownloadPath(!0)!=!1),$(".leftpage",n).toggle(havPageLeft()&&getDownloadPath(!1,!0)?!0:!1),$(".rightpage",n).toggle(havPageRight()&&getDownloadPath(!1,!1)?!0:!1))};ebook.PageTool.updateBookmarkMenuset=function(){var n=$("#ctrl_panel .bookmark_menuset");ebook.PageFlipper.isNarrowMode()||($(".leftpage",n).toggle(havPageLeft()),$(".rightpage",n).toggle(havPageRight()))};ebook.PageTool.openSidePanel=function(n){ebook.PageTool.closeAllSecNav();var i=300,t=$("#ctrl_panel"),r=typeof n!=_undefined?n:t.hasClass("open");r?t.hasClass("open")&&t.removeClass("open").animate({left:-230},i):t.hasClass("open")||t.addClass("open").animate({left:0},i);ebook.PageTool.setMiddleCtrlPanel()};ebook.PageTool.closeAllSecNav=function(){ebook.PageTool.openSecnavi($("#ctrl_panel .icon_download,#ctrl_panel .icon_print,#icon_set_wide .icon_bookmark"),!0)};ebook.PageTool.openSecnavi=function(n,t){var i=$(n).parent(),r=t||!$(".sec_nav",i).is(":hidden");r?($(".sec_nav",i).hide(),$(n).removeClass("hcolor open")):($(".sec_nav",i).slideDown(200),$(n).addClass("hcolor open"))};ebook.PageTool.setMiddleCtrlPanel=function(){var n=$("#ctrl_panel .icon_wrap").outerHeight();$("#ctrl_panel .icon_wrap").css({"margin-top":-n/2+"px"})};ebook.PageTool.makePageListThumb=function(){ebook.PageTool.makePageList();ebook.PageTool.makeThumbList();ebook.PageTool.setCurrentHereThumbList()};ebook.PageTool.setCurrentHerePageList=function(){var n=getPageNum(),t,i,r,u;n=ebook.BookData.singlePageMdoe?getPageNum(ebook.PageWide.zoomPage_pageNum||0):n+(ebook.BookData.pageTopDirectionIsLeft?n<0?1:0:n>0?-1:0);t=$("#list_and_thumb .lists ");$("ul li.here",t).removeClass("here");i=$("ul li[data-num="+n+"]",t).addClass("here").position();typeof i!=_undefined&&(r=$(t).height(),u=i.top-r/2+20,$(t).stop().animate({scrollTop:u},100))};ebook.PageTool.setCurrentHereThumbList=function(){var i=getPageNum(),n,t,r,u;i=ebook.BookData.singlePageMdoe?getPageNum(ebook.PageWide.zoomPage_pageNum||0):i+(ebook.BookData.pageTopDirectionIsLeft?i<0?1:0:i>0?-1:0);n=$("#list_and_thumb .thumbs ");$("ul li.here",n).removeClass("here");t=$("ul li[data-num="+i+"]",n).addClass("here").position();t&&t.top!=_undefined||(t=$("ul li[data-num="+(i-1)+"]",n).addClass("here").position());t&&t.top!=_undefined&&(r=$(n).height(),u=t.top-r/2+30,$(n).stop().animate({scrollTop:u},100));ebook.delayload.update(n)};ebook.PageTool.makePageList=function(){var e=function(n,t){var r=t+1,i,u,f;if(!(r<=0)){i=ebook.BookData.pageTitleText[t];ebook.PageTool.searchMode&&i==""&&(i="Page "+(t+1));u='<span class="title">'+i+"<\/span>";f="#page"+r;n.find(".page_title").html(u).attr("title",i);n.find(".bookmark").toggle(isBookmarkPage(t));n.find(".linkicon").toggle(havLinkPage(t));n.attr("data-num",t);n.find("a").attr({"data-ref":getPageNum(t),href:f}).on("click",function(){var n=parseInt($(this).attr("data-ref"));return pageView_jumpPage(n),closeScrwindow(),ebook.PageTool.openSidePanel(!0),!1})}},o=$('<li><img class="bookmark" alt="bookmark" src="'+ebook.data.bookmark_thumb_url+'" width="10" ><img class="linkicon" alt="link" src="'+ebook.data.link_thumb_url+'" width="10" ><a class="page_title" href="javascript:void(0);"><\/a><\/li>'),f=$("#list_and_thumb .lists ul"),i=ebook.PageFlipper.pageCount,n,r,u,t;for(ebook.PageTool.searchMode&&(i=ebook.PageTool.searchResultList.length||0),f.empty(),n=0;n<i;n++){if(r=o.clone(!0),u=n,ebook.PageTool.searchMode)u=parseInt(ebook.PageTool.searchResultList[n]);else if(ebook.BookData.pageListTitleBlankPackEnable&&ebook.BookData.pageTitleText[n]=="")continue;e(r,u);f.append(r)}t=!1;i==0&&(t=ebook.data.context_search_not_found);$("#list_and_thumb .nodata").toggle(t!=!1);t&&$("#list_and_thumb .nodata").text(t);ebook.PageTool.setCurrentHerePageList()};ebook.PageTool.makeThumbList=function(){var r,c,i,l,u,t,f,n,b,o;if(ebook.BookData.singlePageMdoe)return ebook.PageTool.makeThumbList_single();var d=$('<li><a  href="javascript:void(0);"><p class="page_title" ><\/p><div class="page_img"><img class="page_left pages" /><img class="page_right pages" /><img class="bookmark" alt="bookmark" src="'+ebook.data.bookmark_thumb_url+'" width="13" ><img class="bookmarkr" alt="bookmark" src="'+ebook.data.bookmark_thumb_url+'" width="13" ><\/div><\/a><\/li>'),s=ebook.PageFlipper.pageCount,h=[],p=!1,w=!1,g=s+1;if(ebook.PageTool.searchMode){ebook.PageTool.searchThumbList=[];s=ebook.PageTool.searchResultList.length;for(n in ebook.PageTool.searchResultList)n=parseInt(ebook.PageTool.searchResultList[n]),r=n+1,n%2==0&&(r=n),typeof ebook.PageTool.searchThumbList[r]=="undefined"?ebook.PageTool.searchThumbList[r]=1:ebook.PageTool.searchThumbList[r]++;ebook.PageTool.search_thumbcnt=0;for(n in ebook.PageTool.searchThumbList)ebook.PageTool.search_thumbcnt++;u=0;t=u+g/2;t>ebook.PageTool.search_thumbcnt&&(t=ebook.PageTool.search_thumbcnt);c=0;i=0;for(n in ebook.PageTool.searchThumbList){if(l=ebook.PageTool.searchThumbList[n],i+=l,c>=t)break;c>=u&&(n=parseInt(n),h.push(n-1),(p===!1||p>i-l+1)&&(p=i-l+1),(w===!1||w<i)&&(w=i));c++}}else for(u=-1,t=s,n=u;n<t;n+=2)h.push(parseInt(n));f=$("#list_and_thumb .thumbs ul");f.empty();for(n in h)b=d.clone(!0),ebook.PageTool.makeThumBox(b,parseInt(h[n])),b.appendTo(f);var a=96,v=128,nt=a/v,y=ebook.BookData.pageImgSize_thumb.width/ebook.BookData.pageImgSize_thumb.height,e={},k=0;nt<y?(e.width=a+"px",e.height=a/y+"px",k=(v-a/y)/2):(e.width=y*v+"px",e.height=v+"px",k=0);$("li a img.pages",f).css(e);$("li a img.pages",f).css("padding-top",k+"px");o=!1;s==0&&(o=ebook.data.context_search_not_found);$("#list_and_thumb .nodata").toggle(o!=!1);o&&$("#list_and_thumb .nodata").text(o);ebook.delayload.set($("#list_and_thumb .thumbs "),$("#list_and_thumb .thumbs .pages"),"data-src")};ebook.PageTool.makeThumBox=function(n,t){var r,u,e,f,o,h,s;i=t;r=i+1;r<=0&&(r=1);u=i+(ebook.BookData.pageTopDirectionIsLeft?0:1);e=0;u>=0&&u<ebook.PageFlipper.pageCount?(n.find("img.page_left").attr("data-src",ebook.BookData.pageImgPathList_thumb[u]).attr("alt",ebook.BookData.pageTitleText[u]).show(),e++):n.find("img.page_left").hide();f=i+(ebook.BookData.pageTopDirectionIsLeft?1:0);f>=0&&f<ebook.PageFlipper.pageCount?(n.find("img.page_right").attr("data-src",ebook.BookData.pageImgPathList_thumb[f]).attr("alt",ebook.BookData.pageTitleText[f]).show(),e++):n.find("img.page_right").hide();o="#page"+r;n.attr("data-num",r-1);e>1&&(r=r+"-"+(r+1));h="<span>"+r+"<\/span> ";s=i>=0?ebook.BookData.pageTitleText[i]:ebook.BookData.pageTitleText[i+1];n.find("a").attr("title",s).attr("href",o);n.find(".bookmark").toggle(isBookmarkPage(u));n.find(".bookmarkr").toggle(isBookmarkPage(f));n.find("a").attr("data-ref",getPageNum(i)).on("click",function(){var n=parseInt($(this).attr("data-ref"));return pageView_jumpPage(n),closeScrwindow(),ebook.PageTool.openSidePanel(!0),!1})};ebook.PageTool.makeThumbList_single=function(){var l=$('<li><a  href="javascript:void(0);"><p class="page_title" ><\/p><div class="page_img"><img class="page_left pages" /><img class="bookmark" alt="bookmark" src="'+ebook.data.bookmark_thumb_url+'" width="13" ><\/div><\/a><\/li>'),o=ebook.PageFlipper.pageCount,t,i,s,h,u;for(ebook.PageTool.searchMode&&(o=ebook.PageTool.searchResultList.length||0),t=$("#list_and_thumb .thumbs ul"),t.empty(),i=0;i<o;i++)s=l.clone(!0),h=i,ebook.PageTool.searchMode&&(h=parseInt(ebook.PageTool.searchResultList[i])),ebook.PageTool.makeThumBox_single(s,h),t.append(s);var r=192,f=128,a=r/f,e=ebook.BookData.pageImgSize_thumb.width/ebook.BookData.pageImgSize_thumb.height,n={},c=0;a<e?(n.width=r+"px",n.height=r/e+"px",c=(f-r/e)/2):(n.width=e*f+"px",n.height=f+"px",c=0);n["max-width"]=r+"px";$("li a img.pages",t).css(n);$("li a img.pages",t).css("padding-top",c+"px");u=!1;o==0&&(u=ebook.data.context_search_not_found);$("#list_and_thumb .nodata").toggle(u!=!1);u&&$("#list_and_thumb .nodata").text(u);ebook.delayload.set($("#list_and_thumb .thumbs "),$("#list_and_thumb .thumbs .pages"),"data-src")};ebook.PageTool.makeThumBox_single=function(n,t){var r=t+1,i,u,f,o,e;r<=0&&(r=1);i=r-1;u=0;i>=0&&i<ebook.PageFlipper.pageCount?(n.find("img.page_left").attr("data-src",ebook.BookData.pageImgPathList_thumb[i]).attr("alt",ebook.BookData.pageTitleText[i]).show(),u++):n.find("img.page_left").hide();n.find("img.page_right").hide();f="#page"+r;n.attr("data-num",r-1);o="<span>"+r+"<\/span> ";e=ebook.BookData.pageTitleText[i];n.find("a").attr("title",e).attr("href",f);n.find(".bookmark").toggle(isBookmarkPage(i));n.find("a").attr("data-ref",getPageNum(t)).on("click",function(){var n=parseInt($(this).attr("data-ref"));return pageView_jumpPage(n),closeScrwindow(),ebook.PageTool.openSidePanel(!0),!1})};ebook.PageTool.searchClear=function(){ebook.PageTool.search_keyword="";ebook.PageTool.searchMode=!1;ebook.PageTool.searchResultList=[];ebook.BookData.KeywordClearCallBack("")};ebook.PageTool.searchKeywords=function(n){function s(n){return n.replace(/([()[{*+.$^\\|?])/g,"\\$1")}var h,u,f,i,r,e,o,t;if(n&&n!=null&&jQuery.trim(n).length!=0||(n=""),n=jQuery.trim(n),typeof ebook.BookData.search_kw_ope==_undefined&&(ebook.BookData.search_kw_ope="AND"),ebook.PageTool.search_keyword=n,ebook.PageTool.searchResultList=[],ebook.PageTool.searchMode=!1,ebook.PageTool.search_kw_ope=ebook.BookData.search_kw_ope,h=[],n!=""){for(u={},ebook.PageTool.searchMode=!0,pageTextContents=ebook.BookData.pageTextContents||[],f=n.replace(/\s+/gm," ").split(" "),t=0;t<ebook.BookData.pageTextContents.length;t++)if(ebook.BookData.pageTextContents[t]){for(i=ebook.PageTool.search_kw_ope=="OR"?!1:!0,r=0;r<f.length;r++)if(e=new RegExp(s(f[r]),"mi"),o=ebook.BookData.pageTextContents[t].search(e),o>=0){if(ebook.PageTool.search_kw_ope=="OR"){i=!0;break}}else if(ebook.PageTool.search_kw_ope=="AND"){i=!1;break}i&&(u[t]=1)}for(t in u)ebook.PageTool.searchResultList.push(parseInt(t));setTimeout(function(){ebook.BookData.SearchKeywordCallBack(n)},1)}ebook.BookData.KeywordSearchCallBack(n)};var wideMenuList="#menu_list_bookmark,#menu_list_page,#menu_index_page,#menu_page_top,#menu_page_prev,#menu_page_next,#menu_page_last,#menu_page_jump,#menu_pdf_dl,#menu_search,#menu_hisback",wideZoomMenuList="#menu_list_bookmark,#menu_list_page,#menu_index_page,#menu_page_top,#menu_page_prev,#menu_page_next,#menu_page_last,#menu_page_jump,#menu_pdf_dl,#menu_search,#menu_hisback",narrowMenuList="#menu_list_bookmark,#menu_list_page,#menu_index_page,#menu_page_prev,#menu_page_next,#menu_page_jump,#menu_search,#menu_hisback",smartPhoneMenuList="#menu_list_bookmark,#menu_list_page,#menu_index_page,#menu_page_jump,#menu_hisback";makeMenuWidth=function(){var n=0;$("#navi li:visible").each(function(){n+=$(this).outerWidth()});$("#navi").width(n+4)};Point.prototype.add=function(n){var t=new Point(this.x,this.y);return t.x+=n.x,t.y+=n.y,t};Point.prototype.sub=function(n){var t=new Point(this.x,this.y);return t.x-=n.x,t.y-=n.y,t};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.print=function(){return this._print()};Point.prototype._print=function(){return this.type+"("+this.x+" , "+this.y+")"};Position.prototype.add=function(n){var t=new Position(this.left,this.top);return t.left+=n.left,t.top+=n.top,t};Position.prototype.sub=function(n){var t=new Position(this.left,this.top);return t.left-=n.left,t.top-=n.top,t};Position.prototype.clone=function(){return new Position(this.left,this.top)};Position.prototype.print=function(){return this._print()};Position.prototype._print=function(){return this.type+"("+this.left+","+this.top+")"};Size.prototype.add=function(n){var t=new Size(this.width,this.height);return t.width+=n.width,t.height+=n.height,t};Size.prototype.sub=function(n){var t=new Size(this.width,this.height);return t.width-=n.width,t.height-=n.height,t};Size.prototype.div=function(n){return this.multi(1/n)};Size.prototype.multi=function(n){var t=new Size(this.width,this.height);return t.width*=n,t.height*=n,t};Size.prototype.multir=function(n){var t=new Size(this.width,this.height);return t.width=MathRound(t.width*n),t.height=MathRound(t.height*n),t};Size.prototype.clone=function(){return new Size(this.width,this.height)};Size.prototype.print=function(){return this._print()};Size.prototype._print=function(){return this.type+"("+this.width+","+this.height+")"};ebook.Compatibility.checkViewPort=function(){var n,t;ebook.Compatibility.pixelRatio=window.devicePixelRatio||1;ebook.Compatibility.viewport=typeof window.innerWidth!=_undefined?{width:window.innerWidth,height:window.innerHeight}:{width:$("body").width(),height:$("body").height()};window.screen&&!ebook.Compatibility.isAndroid&&(ebook.Compatibility.viewport.width>window.screen.width||ebook.Compatibility.viewport.height>window.screen.height);ebook.Compatibility.screen={width:window.screen.availWidth*ebook.Compatibility.pixelRatio,height:window.screen.availHeight*ebook.Compatibility.pixelRatio};ebook.Compatibility.isLandscape=ebook.Compatibility.viewport.width>ebook.Compatibility.viewport.height;ebook.Compatibility.isKindle&&(n=ebook.Compatibility.isLandscape?ebook.Compatibility.viewport.width:ebook.Compatibility.viewport.height,n<1024?(t=n/1024,$("#sub_contents_frame").css("zoom",t)):$("body").css("zoom",""))};ebook.Compatibility.getMoveTarget=function(n){ebook.Compatibility.checkDevice();var t=ebook.Compatibility.isIE8lte?"body":window;return ebook.Compatibility.isTabletDevice||ebook.Compatibility.isSmartPhone?n:t};ebook.Compatibility.checkDevice=function(){var n=navigator.userAgent,t;ebook.Compatibility.pixelRatio=window.devicePixelRatio||1;ebook.Compatibility.isAppleDev=/iphone|ipad|ipod/i.test(n);ebook.Compatibility.isAppleMobile=/iphone|ipad|ipod/i.test(n);ebook.Compatibility.isAppleTablet=/ipad/i.test(n);ebook.Compatibility.isKindle=/kindle/i.test(n)||/\bsilk\b/i.test(n);ebook.Compatibility.isIPad=/ipad/i.test(n);ebook.Compatibility.isIPod=/ipod/i.test(n);ebook.Compatibility.isIPhone=/iPhone/i.test(n);ebook.Compatibility.isMobileChrome=/crios/i.test(n);ebook.Compatibility.isIOS4=ebook.Compatibility.isAppleDev&&/ OS 4/i.test(n);ebook.Compatibility.isIOS5=ebook.Compatibility.isAppleDev&&/ OS 5/i.test(n);ebook.Compatibility.isIOS10=ebook.Compatibility.isAppleDev&&/ OS 10_/i.test(n);ebook.Compatibility.isIOS11=ebook.Compatibility.isAppleDev&&/ OS 11_/i.test(n);ebook.Compatibility.isIOS=ebook.Compatibility.isAppleDev&&/ OS \d+/i.test(n);ebook.Compatibility.IOSVer=!1;try{ebook.Compatibility.IOSVer=ebook.Compatibility.isIOS?n.match(/ OS\s+([0-9_]+)/i)[1].replace("_","."):!1}catch(i){}ebook.Compatibility.isWinPhone=/Windows Phone/i.test(n);ebook.Compatibility.isWinPhone7=ebook.Compatibility.isWinPhone&&/ OS 7/i.test(n);ebook.Compatibility.isWinPhone8=ebook.Compatibility.isWinPhone&&/ OS 8/i.test(n);ebook.Compatibility.isWinMobile=ebook.Compatibility.isWinPhone&&/IEMobile/i.test(n);ebook.Compatibility.isAndroid=/android/i.test(n);ebook.Compatibility.isAndroidMobile=ebook.Compatibility.isAndroid&&/Mobile/i.test(n)&&!ebook.Compatibility.isKindle;ebook.Compatibility.isAndroidTablet=ebook.Compatibility.isAndroid&&(!ebook.Compatibility.isAndroidMobile||/SC-01C/i.test(n));ebook.Compatibility.isAndroid4=/Android 4.0/i.test(n);ebook.Compatibility.isBlackberry=/blackberry/i.test(n);ebook.Compatibility.isTouchDevice=ebook.Compatibility.isKindle||ebook.Compatibility.isAppleDev||ebook.Compatibility.isWinPhone||ebook.Compatibility.isAndroid||ebook.Compatibility.isBlackberry;ebook.Compatibility.isWinTouchDevice=navigator.msPointerEnabled?!0:!1;ebook.Compatibility.isIE=$.browser.msie||!1;ebook.Compatibility.isIE8lte=$.browser.msie&&$.browser.version<=8||!1;ebook.Compatibility.isIE6=$.browser.msie&&$.browser.version<=6||!1;ebook.Compatibility.isIE7=$.browser.msie&&$.browser.version<=7||!1;ebook.Compatibility.isIEver=ebook.Compatibility.isIE?parseInt($.browser.version):999;ebook.Compatibility.isChrome=/chrome/i.test(n)||ebook.Compatibility.isTouchDevice&&/crios/i.test(n);ebook.Compatibility.isMobSafari=ebook.Compatibility.isAppleDev&&/safari/i.test(n);ebook.Compatibility.isOperaMobi=/opera mobi/i.test(n);ebook.Compatibility.isFirefox=/firefox/i.test(n);ebook.Compatibility.isAppFB=/fbav/i.test(n);ebook.Compatibility.isAppTW=/twitter/i.test(n);ebook.Compatibility.checkViewPort();t=ebook.Compatibility.screen.width>ebook.Compatibility.screen.height?ebook.Compatibility.screen.width:ebook.Compatibility.screen.height;ebook.Compatibility.isTabletDevice=ebook.Compatibility.isIPad||ebook.Compatibility.isAndroidTab;ebook.Compatibility.isSmartPhone=ebook.Compatibility.isIPhone||ebook.Compatibility.isIPod||ebook.Compatibility.isWinPhone||ebook.Compatibility.isBlackberry||ebook.Compatibility.isAndroidMobile;this.checkCanvas()};ebook.Compatibility.checkCanvas=function(){try{var n=$("<canvas>")[0].getContext("2d");ebook.Compatibility.isSupportCanvas=!0}catch(t){ebook.Compatibility.isSupportCanvas=!1}};jQuery.fn.onImagesLoaded=function(n){return this.each(function(){var t=this.tagName.toLowerCase()==="img"?$(this):$("img",this),r=this,u=0,i=function(){typeof n=="function"&&n(r)};t.length?t.each(function(){var n=this,r=function(r){n.complete||n.readyState=="complete"&&r.type=="readystatechange"?++u===t.length&&i():typeof n.readyState==_undefined&&$(n).attr("src",$(n).attr("src"))};$(n).bind("load readystatechange",r);ebook.Compatibility.isIE8lte&&r({type:"readystatechange"})}):i()})};AsyncImagesLoad=function(n,t){var i=function(){typeof t=="function"&&t(n)},r=function(t){n.complete||n.readyState=="complete"&&t.type=="readystatechange"?i():_img.readyState===undefined&&ebook.Compatibility.isIE&&$(_img).attr("src",$(_img).attr("src"))};$(n).bind("load readystatechange",r)};String.prototype.trim=function(){return this.replace(/^\s+|\s+$\n/mg,"")};MouseButtonTypeEnum={LEFT:1,MIDDLE:2,RIGHT:3};$.fn.setDisableSelection=function(){return this.each(function(){$(this).attr("unselectable","on").css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).each(function(){$(this).on("selectstart.dis",function(){return!1}).on("mousedown.dis",function(n){n.preventDefault()})})})};$.fn.setDisableSelection2=function(){return this.each(function(){$(this).css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","-ms-user-select":"none"}).on("selectstart.dis",function(){return!1}).attr("unselectable","on");$(">*",this).each(function(){$(this).setDisableSelection2()})})};ebook.easing={};ebook.queues={};ebook.queues._do=function(){var n=function(){var t=80;ebook.queues.run();setTimeout(function(){n()},t)};ebook.queues.clear();n()};ebook.queues.clear=function(){ebook.queues.buff=[]};ebook.queues.addEasing=function(n){ebook.queues.buff.push({type:"easing",data:n})};ebook.queues.run=function(){for(var i,r,t=[],n=0;n<ebook.queues.buff.length;n++)i=ebook.queues.buff[n],i.type=="easing"&&(ebook.easing.easing_f(i.data)||t.push(n));if(t.length>0)for(t.reverse(),n=0;n<t.length;n++)r=t[n],ebook.queues.buff.splice(r,1)};ebook.easing.easeOutBack=function(n,t,i,r,u,f){return typeof f==_undefined&&(f=1.70158),r*((t=t/u-1)*t*((f+1)*t+f)+1)+i};ebook.easing.easeOutQuad=function(n,t,i,r,u){return-r*(t/=u)*(t-2)+i};ebook.easing.setEasing=function(n,t,i,r,u,f,e,o){var s={};s.end_func=e||0;s.move_func=f||0;s.func=o||"swing";s.duration=i;s.startdelay=r;s.todelay=u;s.current=0;s.current_time=0;s.targetname=t;n.Easing=s;ebook.queues.addEasing(n)};ebook.easing.easing_f=function(n){var t=!1,i,r;return n.Easing.current<n.Easing.duration&&(i=ebook.easing[n.Easing.func](0,n.Easing.current++,n.Easing.startdelay,n.Easing.todelay,n.Easing.duration-1),n[n.Easing.targetname]=i,n.Easing.current<n.Easing.duration?(t=!0,n.Easing.move_func&&(r=n.Easing.move_func(n),r===!1&&(t=!1))):n.Easing.end_func&&n.Easing.end_func(n)),t};ebook.queues._do();ebook.delayload={};ebook.delayload.trigger_label="update_delayloading";ebook.delayload._update=function(){var i=this,n=this.ct,r=this.jq,t=$(n).offset().top,u=t+n.outerHeight();r.each(function(){var n,r,e;if(!this.loaded&&(n=$(this),n.is(":visible"))&&(r=n.offset().top,e=r+n.outerHeight(),t<e&&u>r)){var o=new Image,f=n.attr(i.src_attr),s=this;if(!f)return;$(o).data({mtr:s,src:f}).on("load",function(){var n=$(this).data("mtr"),t=$(this).data("src");n.loaded=!0;$(n).attr("src",t).hide().fadeIn()});o.src=f}})};ebook.delayload.update=function(n){setTimeout(function(){$(n).trigger(ebook.delayload.trigger_label)},100)};ebook.delayload.set=function(n,t,i){var u=$(t),r=$(n);u.each(function(){var n=$(this);n.is("img")&&n.attr("src",ebook.data.spacegif_url);this.loaded=!1});r.on(ebook.delayload.trigger_label,$.proxy(ebook.delayload._update,{ct:r,jq:u,src_attr:i}));r.on("scroll",function(){$(this).trigger(ebook.delayload.trigger_label)});$(window).on("resize",function(){r.trigger(ebook.delayload.trigger_label)})};ebook.PageFlipper.InitResampleBook=function(){var i,n,r;loadingProgress_end();dataLoaded=!0;var t=$("#canvas"),s=$("#stage"),u=ebook.data.stageFootMargin;ebook.PageFlipper.canvas_offset=new Position(t.offset().left,t.offset().top);ebook.PageFlipper.canvas_size=new Size(ebook.Compatibility.viewport.width-ebook.PageFlipper.canvas_offset.left,ebook.Compatibility.viewport.height-u-ebook.PageFlipper.canvas_offset.top);ebook.PageFlipper.pageCount=ebook.BookData.pageImgPathList.length;ebook.PageFlipper.basePage_size.width=ebook.BookData.pageImgSize.width;ebook.PageFlipper.basePage_size.height=ebook.BookData.pageImgSize.height;set_zoomFit();i=Math.floor(ebook.PageFlipper.canvas_size.width/2);n=Math.floor(ebook.PageFlipper.bookScale*ebook.PageFlipper.basePage_size.width/100);ebook.PageFlipper.diaplayPage_offset.left=Math.floor(i-n);ebook.PageFlipper.diaplayPage_size.width=n;var f=ebook.PageFlipper.diaplayPage_size.width,e=ebook.BookData.pageImgSize.height/ebook.BookData.pageImgSize.width,o=f*e;ebook.PageFlipper.diaplayPage_size.height=Math.floor(o);r=ebook.PageFlipper.canvas_size.height/2;pageHeight=ebook.PageFlipper.diaplayPage_size.height/2;ebook.PageFlipper.diaplayPage_offset.top=Math.floor(r-pageHeight);ebook.PageFlipper.diaplayPage_offset.top<ebook.data.stageTopMargin&&(ebook.PageFlipper.diaplayPage_offset.top=ebook.data.stageTopMargin);ebook.PageFlipper.realMouse.handlePos=!1;ebook.PageFlipper.realMouse.isMouseDown=!1;ebook.data.auto_move=!1;ebook.PageFlipper.updatePageView();resizePageToolBar();updateBookmark();ebook.Compatibility.isTouchDevice&&hideAddress()};ebook.PageFlipper.EVENT_page_mouseover_canvas=function(n){var t,f,i,u,r;if(!dataLoaded||ebook.data.auto_move)return!1;if(ebook.PageFlipper.isWideMode()&&!$("#sub_scrwindow,#scrwindow .mask_layer").is(":visible")){if(t=!1,!ebook.PageFlipper.pageDrag_status)if(f=n?getMousePosEvent(n):getMousePos(),i=cnv_windowToLocal(f),t=ebook.PageFlipper.n_pageHitSide(i),u=!1,t==2&&ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount-1?u=!0:t==1&&ebook.PageFlipper.currentPageNum_left>0&&(u=!0),u){var h=ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width,e=ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height/2,o=h+ebook.PageFlipper.diaplayPage_size.width*(t==1?-1:1),s=new Point(o+(t==1?40:-40),i.y<e?ebook.PageFlipper.diaplayPage_offset.top+20:ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height-20),i=s.clone();ebook.PageFlipper.handleStartPos=new Point(o,i.y<e?ebook.PageFlipper.diaplayPage_offset.top:ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height);ebook.PageFlipper.d.dragStartHeight=s.y-ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height;r=ebook.PageFlipper.Html5.getCtx(1);ebook.PageFlipper.Html5.update_pageLayerTop(r);ebook.PageFlipper.d.handlePos=i.clone();ebook.PageFlipper.d.handleStartPos=ebook.PageFlipper.handleStartPos.clone();ebook.PageFlipper.Html5.pageMove(r,i,!0,t==1)}else ebook.PageFlipper.old_hit_mouseOverState&&(r=ebook.PageFlipper.Html5.getCtx(1),r.clearRect(0,0,ebook.PageFlipper.canvas_size.width,ebook.PageFlipper.canvas_size.height),ebook.PageFlipper.Html5.update_pageLayerTop(r));ebook.PageFlipper.old_hit_mouseOverState=t}};ebook.PageFlipper.EVENT_page_mousedown_canvas_Check_func=!1;ebook.PageFlipper.EVENT_page_mousedown_canvas=function(n){var i=ebook.Compatibility.getMoveTarget($("#canvas_base")),t=function(){$(i).off(ebook.Compatibility.isTouchDevice?leb.e.tm+".pagemove "+leb.e.te+".pagemove":leb.e.mm+".pagemove "+leb.e.mu+".pagemove")},r=function(n){if(t(),!dataLoaded)return!1;if(!ebook.Compatibility.isTouchDevice&&isRightClick(n),ebook.PageFlipper.hit_startMouseX){var i=cnv_windowToLocal(LastmousePos);ebook.PageFlipper.hit_startPageSide==2?i.x>ebook.PageFlipper.hit_startMouseX+20&&(ebook.PageFlipper.pageDrag_status=!1):i.x<ebook.PageFlipper.hit_startMouseX-20&&(ebook.PageFlipper.pageDrag_status=!1)}return ebook.PageFlipper.pageDrag_status?ebook.PageFlipper.Html5.makeAutoPageMoveByMouse():(m_move_clear(),ebook.PageFlipper.updatePageView()),!1},f=function(n){var f,e,u;if(!dataLoaded)return!1;if(ebook.PageFlipper.isWideMode()&&(n.type!==leb.e.ts||!(n.originalEvent.touches.length>1))&&(isRightClick(n)||!/^(a|video)$/.test(n.target.nodeName.toLowerCase()))&&!$("#sub_scrwindow,#scrwindow .mask_layer").is(":visible")){if(LastmousePos=getMousePosEvent(n),f=cnv_windowToLocal(LastmousePos),n.type==leb.e.md&&isRightClick(n)&&ebook.BookData.use_largeImage)return m_move_clear(),ebook.PageFlipper.pageNumAdd(),ebook.PageFlipper.changeZoomPage(n),!1;if(ebook.PageFlipper.EVENT_page_mousedown_canvas_Check_func&&(e=ebook.PageFlipper.EVENT_page_mousedown_canvas_Check_func(n,this),e!==!0))return e;if(u=ebook.PageFlipper.n_pageHit(f),u>0&&(u=ebook.PageFlipper.n_pageHitSide(f)),u<=0)return/^select$/.test(n.target.nodeName.toLowerCase())?void 0:(n.preventDefault(),!1);ebook.PageFlipper.pageDrag_status=1;ebook.PageFlipper.pageNumAdd();removeLinkMap();ebook.PageFlipper.mouseMove(n,!0);ebook.PageFlipper.page_animation();t();$(i).on(ebook.Compatibility.isTouchDevice?leb.e.tm+".pagemove":leb.e.mm+".pagemove",function(n){if(n.type===leb.e.tm&&n.originalEvent.touches.length>1){t();return}return dataLoaded?!ebook.Compatibility.isTouchDevice&&isRightClick(n)?(r(n),!1):(LastmousePos=getMousePosEvent(n),ebook.PageFlipper.mouseMove(n,!1),!1):!1}).one(ebook.Compatibility.isTouchDevice?leb.e.te+".pagemove":leb.e.mu+".pagemove",function(n){return r(n)});return n.preventDefault(),!1}},u=f(n);if(typeof u!=_undefined)return u};LastmousePos=!1;ebook.PageFlipper.mouseMove=function(n,t){now=new Date;datet=parseInt((now.getTime()-start_time.getTime())/10);var i=getMousePosEvent(n);ebook.PageFlipper.realMouse.handlePos=cnv_windowToLocal(i);ebook.PageFlipper.realMouse.isMouseDown=t;ebook.PageFlipper.pageDrag_status&&(t||ebook.PageFlipper.handleStartPos==!1)&&(ebook.PageFlipper.moveHandlePos=new Point(ebook.PageFlipper.realMouse.handlePos.x,ebook.PageFlipper.realMouse.handlePos.y))};ebook.PageFlipper.sync_cnt=0;ebook.PageFlipper.page_animation=function(){if(ebook.PageFlipper.d.canvas_offset=ebook.PageFlipper.canvas_offset.clone(),ebook.PageFlipper.pageDrag_status!=!1){if(!ebook.PageFlipper.m_move()){m_move_clear();return}setTimeout(function(){ebook.PageFlipper.page_animation()},80);ebook.PageFlipper.sync_cnt++}};ebook.PageFlipper.m_move=function(){var t=ebook.PageFlipper.realMouse.isMouseDown,n,i,u,r;if(t&&(ebook.PageFlipper.realMouse.isMouseDown=!1),now=new Date,datet=parseInt((now.getTime()-start_time.getTime())/10),n=new Point(ebook.PageFlipper.moveHandlePos.x,ebook.PageFlipper.moveHandlePos.y),ebook.PageFlipper.hitPageSide=ebook.PageFlipper.pageHit(n),!ebook.PageFlipper.hitPageSide)return m_move_clear(),!1;if(t&&(ebook.PageFlipper.hit_startMouseX=n.x,ebook.PageFlipper.hit_startPageSide=ebook.PageFlipper.hitPageSide,ebook.data.auto_move=!1),ebook.PageFlipper.hitPageSide&&ebook.PageFlipper.pageDrag_status!=!1){if(i=!1,ebook.PageFlipper.hit_startPageSide==2&&ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount-1?i=!0:ebook.PageFlipper.hit_startPageSide==1&&ebook.PageFlipper.currentPageNum_left>0&&(i=!0),i){if(t)ebook.Compatibility.isSupportCanvas&&pagingAudioObj&&pagingAudioObj.play(),ebook.PageFlipper.handleStartPos=ebook.PageFlipper.Html5.makeStartPos(n),ebook.PageFlipper.d.handleStartPos=ebook.PageFlipper.handleStartPos.clone(),n=ebook.PageFlipper.handleStartPos.clone(),n.x+=ebook.PageFlipper.hit_startPageSide==1?1:-1,ebook.PageFlipper.d.handlePos=n.clone(),ebook.PageFlipper.d.dragStartHeight=n.y-ebook.PageFlipper.diaplayPage_offset.top;else if(u=ebook.PageFlipper.Html5.makeMoveDist(n),ebook.data.auto_move&&!u)return ebook.PageFlipper.pageNumAdd(),m_move_clear(),!1;ebook.PageFlipper.moveHandlePos=new Point(n.x,n.y);r=ebook.PageFlipper.Html5.getCtx(1);r.clearRect(0,0,ebook.PageFlipper.canvas_size.width,ebook.PageFlipper.canvas_size.height);ebook.PageFlipper.Html5.update_pageLayerTop(r);ebook.PageFlipper.Html5.pageMove(r,n,t,ebook.PageFlipper.hit_startPageSide==1)}else return!1;(ebook.PageFlipper.handlePos_old==!1||ebook.PageFlipper.handlePos_old.x!=n.x||ebook.PageFlipper.handlePos_old.y!=n.y)&&(ebook.PageFlipper.handlePos_old=new Point(n.x,n.y))}else return!1;return!0};ebook.PageFlipper.hitFlipOutWidth=60;ebook.PageFlipper.n_pageHit=function(n){var i=-1,t=ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width,r=ebook.PageFlipper.hitFlipOutWidth;return n.y>=ebook.PageFlipper.diaplayPage_offset.top&&n.y<=ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height&&(n.x>=t-ebook.PageFlipper.diaplayPage_size.width-r&&n.x<=t?i=1:n.x>=t&&n.x<=t+ebook.PageFlipper.diaplayPage_size.width+r&&(i=2)),i};ebook.PageFlipper.n_pageHitSide=function(n){var i=-1,t=ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width,r=(100-ebook.data.hitWidthPar)*ebook.PageFlipper.diaplayPage_size.width/100,u=ebook.PageFlipper.hitFlipOutWidth;return n.y>=ebook.PageFlipper.diaplayPage_offset.top&&n.y<=ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height&&(n.x>=t-ebook.PageFlipper.diaplayPage_size.width-u&&n.x<=t-r?i=1:n.x>=t+r&&n.x<=t+ebook.PageFlipper.diaplayPage_size.width+u&&(i=2)),i};ebook.PageFlipper.pageHit=function(n){var t=ebook.PageFlipper.n_pageHit(n);return t<0&&(t=ebook.PageFlipper.pageDrag_status&&ebook.PageFlipper.hitPageSide?ebook.PageFlipper.hitPageSide:!1),t};ebook.PageFlipper.pageHitSide=function(n){var t=ebook.PageFlipper.n_pageHitSide(n);return t<0&&(t=ebook.PageFlipper.pageDrag_status&&ebook.PageFlipper.hitPageSide?ebook.PageFlipper.hitPageSide:!1),t};ebook.PageFlipper.getPageMouseRelativePos=function(n){var t=ebook.PageFlipper.n_pageHit(n);if(t==1)return new Size((n.x-ebook.PageFlipper.diaplayPage_offset.left)/ebook.PageFlipper.diaplayPage_size.width,(n.y-ebook.PageFlipper.diaplayPage_offset.top)/ebook.PageFlipper.diaplayPage_size.height);else if(t==2)return new Size((n.x-ebook.PageFlipper.diaplayPage_offset.left-ebook.PageFlipper.diaplayPage_size.width)/ebook.PageFlipper.diaplayPage_size.width,(n.y-ebook.PageFlipper.diaplayPage_offset.top)/ebook.PageFlipper.diaplayPage_size.height);return!1};ebook.PageFlipper.getPageMouseRelativeWidePos=function(n){return new Size((n.x-ebook.PageFlipper.diaplayPage_offset.left)/(ebook.PageFlipper.diaplayPage_size.width*2),(n.y-ebook.PageFlipper.diaplayPage_offset.top)/ebook.PageFlipper.diaplayPage_size.height)};ebook.PageFlipper.pageNumAdd=function(){if(ebook.data.auto_pageNext!=!1){if(ebook.PageFlipper.currentPageNum_left+ebook.data.auto_pageNext<ebook.PageFlipper.pageCount+1&&ebook.PageFlipper.currentPageNum_left+ebook.data.auto_pageNext>=-1){ebook.PageFlipper.currentPageNum_left+=ebook.data.auto_pageNext;m_move_clear();ebook.PageFlipper.updatePageView();var n=getPageNum(ebook.PageFlipper.currentPageNum_left);if(n=n<0?0:n,callBookchangeUserFunc(n+1),!(ebook.PageFlipper.currentPageNum_left+ebook.data.auto_pageNext<ebook.PageFlipper.pageCount+1)||!(ebook.PageFlipper.currentPageNum_left+ebook.data.auto_pageNext>=-1))return m_move_clear(),stopAutoPlay(),ebook.data.auto_pageNext=!1,!1}else return m_move_clear(),stopAutoPlay(),ebook.data.auto_pageNext=!1,!1;ebook.data.auto_pageNext=!1}return!0};ebook.PageFlipper.update_now=!1;ebook.PageFlipper.update_counter=0;ebook.PageFlipper.update_stack_count=0;ebook.PageFlipper.updateWidePageImg=function(){var n,t;ebook.PageFlipper.isWideMode()&&(ebook.Compatibility.isSupportCanvas?(n=ebook.PageFlipper.Html5.getCtx(0),n.clearRect(-1,-1,ebook.PageFlipper.canvas_size.width+2,ebook.PageFlipper.canvas_size.height+2),ebook.PageFlipper.Html5.update_page(n),t=ebook.PageFlipper.Html5.getCtx(1),t.clearRect(-1,-1,ebook.PageFlipper.canvas_size.width+2,ebook.PageFlipper.canvas_size.height+2),ebook.PageFlipper.Html5.update_pageLayerTop(t)):ebook.PageFlipper.update_page_row())};ebook.PageFlipper.updatePageView=function(){ebook.PageFlipper.updateWidePageImg();ebook.PageFlipper.isWideMode()&&(updatePagerBar(),updatePageToolBar(),updateBookmark(),makeLinkMap());ebook.PageTool.updateMenuset();ebook.PageFlipper.update_now=!1};ebook.PageFlipper.check_updatelock=function(n){ebook.PageFlipper.update_now&&n==ebook.PageFlipper.update_counter&&(ebook.PageFlipper.update_now=!1)};ebook.PageFlipper.update_page_row=function(){$("#row_page img,#row_page >div").width(ebook.PageFlipper.diaplayPage_size.width).height(ebook.PageFlipper.diaplayPage_size.height);$("#row_page .hit_area").height(ebook.PageFlipper.diaplayPage_size.height).width(ebook.PageFlipper.diaplayPage_size.width*ebook.data.hitWidthPar/100);$("#row_page").width(ebook.PageFlipper.diaplayPage_size.width*2).css({"padding-top":ebook.PageFlipper.diaplayPage_offset.top+"px ","padding-bottom":ebook.PageFlipper.diaplayPage_offset.top+"px ","padding-left":(ebook.PageFlipper.diaplayPage_offset.left>=0?ebook.PageFlipper.diaplayPage_offset.left:0)+"px","padding-right":(ebook.PageFlipper.diaplayPage_offset.left>=0?ebook.PageFlipper.diaplayPage_offset.left:0)+"px"});var n=getPageNum(ebook.PageFlipper.currentPageNum_left+0),t=getPageNum(ebook.PageFlipper.currentPageNum_left+1);n>=0&&n<ebook.PageFlipper.pageCount?($("#row_page >.page_left>img").attr("src",ebook.BookData.GetPageImgPath(n)),$("#row_page >.page_left").show()):$("#row_page >.page_left").hide();t>=0&&t<ebook.PageFlipper.pageCount?($("#row_page >.page_right>img").attr("src",ebook.BookData.GetPageImgPath(t)),$("#row_page >.page_right").show()):$("#row_page >.page_right").hide();$("#row_page >.page_left>.bookmark").toggle(isBookmarkPage(n));$("#row_page >.page_right>.bookmark").toggle(isBookmarkPage(t))};ebook.PageFlipper.loadThumbImage=function(n){try{n<ebook.PageFlipper.pageCount&&(typeof ebook.pageCache.pagess[n]==_undefined||ebook.pageCache.pagess[n]===!1)&&(ebook.pageCache.pagess[n]=!0,backgroundloading_thumbPageImage(n,$.proxy(function(n){ebook.pageCache.pagess[this.page_num]=n},{page_num:n})))}catch(t){ebook.pageCache.pagess[this.page_num]=!1}};_loadPageImage=0;ebook.PageFlipper.PageUpdate=function(){ebook.PageFlipper.isWideMode()&&(ebook.PageFlipper.pageDrag_status||(ebook.PageFlipper.old_hit_mouseOverState>0?setTimeout(function(){ebook.PageFlipper.updateWidePageImg();ebook.PageFlipper.EVENT_page_mouseover_canvas(!1);ebook.PageFlipper.old_hit_mouseOverState=!1},100):setTimeout(function(){ebook.PageFlipper.updateWidePageImg()},100)))};ebook.PageFlipper.loadPageImage_loaded=function(n){ebook.pageCache.pages[this.page_num]=n;ebook.PageFlipper.PageUpdate()};ebook.PageFlipper.loadPageImage=function(n){logw("loadPageImage");var t=_loadPageImage++;try{n<ebook.PageFlipper.pageCount&&(typeof ebook.pageCache.pages[n]==_undefined||ebook.pageCache.pages[n]===!1)&&(ebook.pageCache.pages[n]=!0,backgroundloading_middlePageImage(n,$.proxy(ebook.PageFlipper.loadPageImage_loaded,{page_num:n})))}catch(i){ebook.pageCache.pages[this.page_num]=!1}};ebook.PageFlipper.cacheControl=function(n,t){};ebook.PageFlipper.changePageMode=function(n){if(ebook.data.changePageMode_cnt=ebook.data.changePageMode_cnt?ebook.data.changePageMode_cnt+1:1,stopAutoPlay(),ebook.PageFlipper.isZoomMode())$("body").addClass("vmode_zoom").removeClass("vmode_wide").removeClass("vmode_narrow"),ebook.PageWide.changeZoomView(n);else if(ebook.PageFlipper.isWideMode())$("body").addClass("vmode_wide").removeClass("vmode_zoom").removeClass("vmode_narrow"),ebook.PageFlipper.setWideView();else if(ebook.PageFlipper.isNarrowMode())if($("body").addClass("vmode_narrow").removeClass("vmode_wide").removeClass("vmode_zoom"),ebook.data.changePageMode_cnt==1&&ebook.data.firstPageRequest){var n=getPageNum(ebook.data.firstPageRequest);changeNarrowView2(n);ebook.data.firstPageRequest=!1}else changeNarrowView();EVENT_resizeContainer();zoom_fit()};ebook.PageFlipper.chengePageMode_before=function(){ebook.PageFlipper.isZoomMode()||ebook.PageFlipper.isWideMode()||ebook.PageFlipper.isNarrowMode()&&changeoutNarrowView()};ebook.PageFlipper.setWideView=function(){$("#stage").children().hide();$(ebook.PageWide.zoomSliderInsertTargetTag).hide();ebook.PageTool.setMiddleCtrlPanel();$("#canvas").show();ebook.Compatibility.isIE6&&$("#page").css("overflow","");ebook.BookData.use_pageFooterToolbar&&$(ebook.data.ClassMainToolBar).show();$(ebook.data.ClassPageToolBar).toggle(ebook.BookData.use_pageSideToolbar&&ebook.PageFlipper.isWideMode());updatePagerBar();IE_SelectShow()};ebook.PageFlipper.changeZoomPage=function(n){return ebook.BookData.use_largeImage?(ebook.PageWide.zoomPage_mouseEventObj=n,ebook.PageFlipper.setZoomMode(),ebook.PageFlipper.changePageMode(0),!1):!1};ebook.PageFlipper.changeWidePage=function(){return ebook.PageFlipper.setWideMode(),ebook.PageFlipper.changePageMode(0),!1};ebook.PageFlipper.Slice={};ebook.PageFlipper.Slice._cache={};ebook.PageFlipper.Slice._cache.info={};ebook.PageFlipper.Slice._cache.info.medium=!1;ebook.PageFlipper.Slice._cache.page={};ebook.PageFlipper.Slice._cache.list={};ebook.PageFlipper.Slice._cache.count=0;ebook.PageFlipper.Slice._cache.maxload=10;ebook.PageFlipper.Slice._cache.proc_delay=100;ebook.PageFlipper.Slice.init=function(){var n;if(isEnableSlicePageM()){n=ebook.BookData.pageImgCell.medium;ebook.PageFlipper.Slice._cache.info.medium=n;var u=ebook.BookData.pageImgSize.width,f=ebook.BookData.pageImgSize.height,e=ebook.BookData.pageImgCell.basePath+n.folder,t=n.cellSize,i=Math.ceil(u/t),r=Math.ceil(f/t),o=i*r;n.basePath=e;n.page_size=ebook.BookData.pageImgSize;n.slice={count:o,x:i,y:r}}if(isEnableSlicePageL()){n=ebook.BookData.pageImgCell.large;ebook.PageFlipper.Slice._cache.info.large=n;var u=ebook.BookData.pageImgSize_large.width,f=ebook.BookData.pageImgSize_large.height,e=ebook.BookData.pageImgCell.basePath+n.folder,t=n.cellSize,i=Math.ceil(u/t),r=Math.ceil(f/t),o=i*r;n.basePath=e;n.page_size=ebook.BookData.pageImgSize_large;n.slice={count:o,x:i,y:r}}};ebook.PageFlipper.Slice.tools={};ebook.PageFlipper.Slice.tools.makeSliceFiles=function(n,t,i,r){var p=i.basePath,w=i.slice.count,o=t,s,f,c,e,h,y,u;/\//.test(o)&&(s=t.split("/"),o=s[s.length-1]);f=o;c="png";/\./.test(f)&&(e=f.split("."),c=e[e.length-1],f=e[0]);var l=i.numberFormat,a=/\[\d+\]/,v=l.match(a);if(v)for(h=v[0].replace(/\[|\]/g,""),y=h.length,u=0;u<w;u++){var b=(h+u).slice(-y),k=p+f+l.replace(a,b),d="p_"+n+"_"+("000"+u).slice(-4);r({page:n,num:u,src:k,key:d})}};ebook.PageFlipper.Slice.pagePush=function(n){if(typeof ebook.PageFlipper.Slice._cache.list[n.key]==_undefined)n.sts=0,ebook.PageFlipper.Slice._cache.list[n.key]=n;else{var t=ebook.PageFlipper.Slice._cache.list[n.key];t.func=n.func;t.sts==-1&&typeof t.img!=_undefined&&t.func&&t.func(t)}};ebook.PageFlipper.Slice.delayloading_proc=function(){var n=ebook.PageFlipper.Slice._cache.list||{},t,r,i,u;for(t in n)n[t].sts==0&&(n[t].entry_time=(new Date).getTime(),n[t].sts=1,_bgLoadingImageFunc(n[t].src,$.proxy(function(n){this.loaded_time=(new Date).getTime();this.img=n;this.sts=9;this.func&&this.func(this)},n[t])),ebook.PageFlipper.Slice._cache.count++);r=!1;for(i in n)n[i].sts==9&&(u=n[i].loaded_time-n[i].entry_time,n[i].sts=-1,ebook.PageFlipper.Slice._cache.count--,r=!0);r&&ebook.PageFlipper.isWideMode()&&ebook.PageFlipper.PageUpdate();setTimeout(ebook.PageFlipper.Slice.delayloading_proc,ebook.PageFlipper.Slice._cache.proc_delay)};setTimeout(ebook.PageFlipper.Slice.delayloading_proc,1);ebook.PageFlipper.isWideMode=function(){return ebook.PageFlipper.viewMode==ebook.data._viewModeWide};ebook.PageFlipper.isZoomMode=function(){return ebook.PageFlipper.viewMode==ebook.data._viewModeZoom};ebook.PageFlipper.isNarrowMode=function(){return ebook.PageFlipper.viewMode==ebook.data._viewModeNarrow};ebook.PageFlipper.setWideMode=function(){ebook.PageFlipper.chengePageMode_before();ebook.PageFlipper.viewMode=ebook.data._viewModeWide};ebook.PageFlipper.setZoomMode=function(){ebook.PageFlipper.chengePageMode_before();ebook.PageFlipper.viewMode=ebook.data._viewModeZoom};ebook.PageFlipper.setNarrowMode=function(){ebook.PageFlipper.chengePageMode_before();ebook.PageFlipper.viewMode=ebook.data._viewModeNarrow};ebook.PageFlipper.Html5.makeAutoPageMove=function(n,t){return t!==!0&&(t=!1),ebook.PageFlipper.hit_startPageSide=n?2:1,ebook.PageFlipper.realMouse.isMouseDown=!1,ebook.PageFlipper.pageDrag_status=1,ebook.PageFlipper.handleStartPos=new Point(ebook.PageFlipper.diaplayPage_offset.left+(n?ebook.PageFlipper.diaplayPage_size.width*2-10:10),ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height*.6),ebook.PageFlipper.d.handleStartPos=ebook.PageFlipper.handleStartPos.clone(),handlePos=ebook.PageFlipper.handleStartPos.clone(),handlePos.x+=ebook.PageFlipper.hit_startPageSide==1?4:-4,ebook.PageFlipper.d.handlePos=handlePos.clone(),ebook.PageFlipper.d.dragStartHeight=handlePos.y-ebook.PageFlipper.diaplayPage_offset.top,ebook.PageFlipper.moveHandlePos=cnv_windowToLocal(handlePos),ebook.PageFlipper.Html5.makeAutoPageMoveByMouse(),t||removeLinkMap(),ebook.PageFlipper.page_animation(),!0};ebook.PageFlipper.Html5.makeAutoPageMoveByMouse=function(){ebook.data.auto_pageNext=ebook.PageFlipper.hit_startPageSide==2?2:-2;ebook.data.auto_move=!0;ebook.data.auto_moveToPos=ebook.PageFlipper.hit_startPageSide==2?new Point(ebook.PageFlipper.diaplayPage_offset.left,ebook.PageFlipper.handleStartPos.y):new Point(ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width*2,ebook.PageFlipper.handleStartPos.y)};ebook.PageFlipper.Html5.makeStartPos=function(n){var t,r,i;return t=ebook.PageFlipper.hit_startPageSide==2?new Point(ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width*2,n.y):new Point(ebook.PageFlipper.diaplayPage_offset.left,n.y),r=ebook.PageFlipper.diaplayPage_size.height/2,i=ebook.PageFlipper.diaplayPage_offset.top+r,i<t.y?(t.y-=(i-t.y)*1.05,t.y>ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height&&(t.y=ebook.PageFlipper.diaplayPage_offset.top+ebook.PageFlipper.diaplayPage_size.height)):(t.y-=(i-t.y)*1.05,t.y<ebook.PageFlipper.diaplayPage_offset.top&&(t.y=ebook.PageFlipper.diaplayPage_offset.top)),t};ebook.PageFlipper.Html5.makeMoveDist=function(n){var u,t,f=2,e=!0,i,r;return ebook.data.auto_move?(u=new Point(ebook.data.auto_moveToPos.x,ebook.data.auto_moveToPos.y),f=1.5):u=new Point(ebook.PageFlipper.realMouse.handlePos.x,ebook.PageFlipper.realMouse.handlePos.y),i=new Size(f,f),r=new Size(u.x-n.x,u.y-n.y),Math.abs(r.width)<100&&(i.width=1),Math.abs(r.height)<100&&(i.height=1),t=new Point(r.width/i.width,r.height/i.height),Math.abs(t.x)<4&&(t.x=0),Math.abs(t.y)<4&&(t.y=0),t.y==0&&t.x==0&&(e=!1),n.x+=parseInt(t.x),n.y+=parseInt(t.y),ebook.PageFlipper.hit_startPageSide==2?n.x-ebook.PageFlipper.diaplayPage_offset.left-ebook.PageFlipper.diaplayPage_size.width*2>=0&&(n.x=ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width*2-5):n.x-ebook.PageFlipper.diaplayPage_offset.left<=0&&(n.x=ebook.PageFlipper.diaplayPage_offset.left+5),e};ebook.PageFlipper.d={};ebook.PageFlipper.Html5.pageMove=function(n,t,i,r){var u=!r;ebook.PageFlipper.d.handlePos=new Point(t.x,t.y);ebook.PageFlipper.d.ctx=n;ebook.PageFlipper.handleStartPos!=!1&&(ebook.PageFlipper.d.widthOffset=0,u&&(ebook.PageFlipper.d.widthOffset=ebook.PageFlipper.diaplayPage_size.width),ebook.PageFlipper.d=ebook.PageFlipper.Html5.optimizeDragVector(ebook.PageFlipper.d,r),ebook.PageFlipper.d.drawOffset=new Point(ebook.PageFlipper.d.ori_pos.x+ebook.PageFlipper.d.widthOffset,ebook.PageFlipper.d.ori_pos.y),ebook.PageFlipper.Html5.drawMovePage(n,ebook.PageFlipper.d,r))};ebook.PageFlipper.Html5.drawMovePage=function(n,t,i){var e=!i,r,f,u,o;e&&(t.radi_b*=-1);r=(100-parseInt(t.pageProgress))/100;n.translate(ebook.PageFlipper.diaplayPage_offset.left+t.widthOffset,ebook.PageFlipper.diaplayPage_offset.top);n.clearRect(0,0,ebook.PageFlipper.diaplayPage_size.width,ebook.PageFlipper.diaplayPage_size.height);n.save();i||(n.translate(ebook.PageFlipper.diaplayPage_size.width,0),n.scale(-1,1));ebook.PageFlipper.Html5.makePageMask(n,t.radi,t.ori_top_l,t.ori_top_lb);n.clip();i||(n.scale(-1,1),n.translate(ebook.PageFlipper.diaplayPage_size.width*-1,0));ebook.PageFlipper.Html5.draw_page(n,getPageNum(i?ebook.PageFlipper.currentPageNum_left:ebook.PageFlipper.currentPageNum_left+1));n.restore();n.save();i&&(n.translate(ebook.PageFlipper.diaplayPage_size.width,0),n.scale(-1,1));ebook.PageFlipper.Html5.makeBaseMask(n,t.radi,t.ori_top_l,t.ori_top_lb);n.clip();(i&&ebook.PageFlipper.currentPageNum_left>2||e&&ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount-3)&&(i&&(n.scale(-1,1),n.translate(ebook.PageFlipper.diaplayPage_size.width*-1,0)),ebook.PageFlipper.Html5.draw_page(n,getPageNum(i?ebook.PageFlipper.currentPageNum_left-2:ebook.PageFlipper.currentPageNum_left+3)));n.restore();f=r<.8?.3*r/.8:.3;f>0&&ebook.BookData.pageShadow&&(n.save(),n.translate(t.drawOffset.x-t.widthOffset,t.drawOffset.y),n.rotate(t.radi_b),i&&n.scale(-1,1),ebook.PageFlipper.Html5.makeMask(n,t.radi,t.ori_top_l,t.ori_top_lb),ebook.PageFlipper.Html5.page_shadow2(n,f),n.fill(),n.restore());n.save();n.translate(t.drawOffset.x-t.widthOffset,t.drawOffset.y);n.rotate(t.radi_b);i&&n.scale(-1,1);ebook.PageFlipper.Html5.makeMask(n,t.radi,t.ori_top_l,t.ori_top_lb);n.clip();i&&(n.translate(ebook.PageFlipper.diaplayPage_size.width,0),n.scale(-1,1));ebook.PageFlipper.Html5.draw_page(n,getPageNum(i?ebook.PageFlipper.currentPageNum_left-1:ebook.PageFlipper.currentPageNum_left+2));i&&(n.scale(-1,1),n.translate(ebook.PageFlipper.diaplayPage_size.width*-1,0));ebook.BookData.pageRollShadow&&(u=ebook.PageFlipper.Html5.makeMask(n,t.radi,t.ori_top_l,t.ori_top_lb),i&&n.scale(-1,1),n.rotate(t.radi_b*-1),n.translate((t.drawOffset.x+ebook.PageFlipper.diaplayPage_offset.left)*-1,(t.drawOffset.y+ebook.PageFlipper.diaplayPage_offset.top)*-1),n.translate(t.cv_pos.x,t.cv_pos.y),i?(n.rotate(t.radi),n.translate(u,0),n.scale(-1,1)):(n.rotate(t.radi*-1),n.translate(u*-1,0)),o=r<.2?r/.2:1,ebook.PageFlipper.Html5.rollShadow(n,u,t.radi,o),n.fill());n.restore();n.translate(-1*(ebook.PageFlipper.diaplayPage_offset.left+t.widthOffset),ebook.PageFlipper.diaplayPage_offset.top*-1)};ebook.PageFlipper.Html5.optimizeDragVector=function(n,t){var e,o,i,r,u,s,f;return n.v_size=t?new Size(n.handlePos.x-n.handleStartPos.x,n.handlePos.y-n.handleStartPos.y):new Size(n.handleStartPos.x-n.handlePos.x,n.handlePos.y-n.handleStartPos.y),n.radi=Math.atan(n.v_size.height/n.v_size.width),n.radi_b=n.radi*2,n.cv_pos=t?new Point(n.handlePos.x-n.v_size.width/2,n.handlePos.y-n.v_size.height/2):new Point(n.handlePos.x+n.v_size.width/2,n.handlePos.y-n.v_size.height/2),e=(n.cv_pos.y-ebook.PageFlipper.diaplayPage_offset.top)/Math.cos(n.radi),o=t?n.cv_pos.x+Math.cos(n.radi-Math.PI/2)*e:n.cv_pos.x-Math.cos(n.radi-Math.PI/2)*e,i=0,r=0,i=t?o-ebook.PageFlipper.diaplayPage_offset.left:n.widthOffset*2+ebook.PageFlipper.diaplayPage_offset.left-o,r=i+Math.tan(n.radi*-1)*ebook.PageFlipper.diaplayPage_size.height,u=!1,i>ebook.PageFlipper.diaplayPage_size.width&&(i=ebook.PageFlipper.diaplayPage_size.width,u=!0),r>ebook.PageFlipper.diaplayPage_size.width&&(r=ebook.PageFlipper.diaplayPage_size.width,u=!0),n.ori_top_l=i,n.ori_top_lb=r,u&&(n.radi=Math.atan((i-r)/ebook.PageFlipper.diaplayPage_size.height),n.radi_b=n.radi*2,pos_lt=new Point(Math.cos(n.radi_b)*i,Math.sin(n.radi_b)*i),pos_lt.x=t?i+pos_lt.x:ebook.PageFlipper.diaplayPage_size.width-pos_lt.x,pos2=new Point(Math.sin(n.radi_b)*n.dragStartHeight,pos_lt.y+Math.cos(n.radi_b)*n.dragStartHeight),pos2.x=t?pos_lt.x-pos2.x:pos_lt.x+(ebook.PageFlipper.diaplayPage_size.width-i)+pos2.x,n.handlePos=new Point(pos2.x+ebook.PageFlipper.diaplayPage_offset.left,pos2.y+ebook.PageFlipper.diaplayPage_offset.top),n.v_size=new Size(n.handlePos.x-n.handleStartPos.x,n.handlePos.y-n.handleStartPos.y),n.cv_pos=new Point(n.handleStartPos.x+n.v_size.width/2,n.handlePos.y-n.v_size.height/2)),s=new Size(Math.cos(n.radi_b)*n.ori_top_l,Math.sin(n.radi_b)*n.ori_top_l),f=new Point(n.ori_top_l+s.width,s.height),t||(f.x=ebook.PageFlipper.diaplayPage_size.width-f.x),n.ori_pos=f,n.pageProgress=Math.abs(n.v_size.width)*50/ebook.PageFlipper.diaplayPage_size.width,n};ebook.PageFlipper.Html5.makeBaseMask=function(n,t,i,r){var e=i,u=ebook.PageFlipper.diaplayPage_size.width,f=ebook.PageFlipper.diaplayPage_size.height;return n.beginPath(),n.moveTo(u-i,0),n.lineTo(u,0),n.lineTo(u,f),n.lineTo(u-r,f),n.lineTo(u-i,0),n.closePath(),e};ebook.PageFlipper.Html5.makePageMask=function(n,t,i,r){var u=i;return t>0||(u=r),n.beginPath(),n.moveTo(ebook.PageFlipper.diaplayPage_size.width,0),i>0?n.lineTo(i,0):(n.lineTo(0,0),n.lineTo(0,ebook.PageFlipper.diaplayPage_size.height+r/Math.tan(t))),r<=0?(n.lineTo(0,i/Math.tan(t)),n.lineTo(0,ebook.PageFlipper.diaplayPage_size.height)):n.lineTo(r,ebook.PageFlipper.diaplayPage_size.height),n.lineTo(ebook.PageFlipper.diaplayPage_size.width,ebook.PageFlipper.diaplayPage_size.height),n.closePath(),u};ebook.PageFlipper.Html5.makeMask=function(n,t,i,r){var u=i;return t>0||(u=r),n.beginPath(),i>0?(n.moveTo(0,0),n.lineTo(i,0)):n.moveTo(0,ebook.PageFlipper.diaplayPage_size.height+r/Math.tan(t)),r<=0?n.lineTo(0,i/Math.tan(t)):(n.lineTo(r,ebook.PageFlipper.diaplayPage_size.height),n.lineTo(0,ebook.PageFlipper.diaplayPage_size.height)),i<=0?n.lineTo(0,ebook.PageFlipper.diaplayPage_size.height+r/Math.tan(t)):n.lineTo(0,0),n.closePath(),u};ebook.PageFlipper.Html5.getCtx=function(n){return ebook.Compatibility.isSupportCanvas?n==0?(ebook.PageFlipper.ctx1==!1&&$("#canvas1").length>0&&(ebook.PageFlipper.ctx1=$("#canvas1")[0].getContext("2d")),ebook.PageFlipper.ctx1):(ebook.PageFlipper.ctx2==!1&&$("#canvas2").length>0&&(ebook.PageFlipper.ctx2=$("#canvas2")[0].getContext("2d")),ebook.PageFlipper.ctx2):!1};ebook.PageFlipper.Html5.update_pageLayerTop=function(n){ebook.PageFlipper.currentPageNum_left<=1&&(n.save(),n.translate(ebook.PageFlipper.diaplayPage_offset.left,ebook.PageFlipper.diaplayPage_offset.top),ebook.PageFlipper.Html5.draw_page(n,getPageNum(ebook.PageFlipper.currentPageNum_left)),n.restore());ebook.PageFlipper.currentPageNum_left==ebook.PageFlipper.pageCount-3&&(n.save(),n.translate(ebook.PageFlipper.diaplayPage_offset.left+ebook.PageFlipper.diaplayPage_size.width,ebook.PageFlipper.diaplayPage_offset.top),ebook.PageFlipper.Html5.draw_page(n,getPageNum(ebook.PageFlipper.currentPageNum_left+1)),n.restore())};ebook.PageFlipper.Html5.rollShadow=function(n,t,i,r){var u=n.createLinearGradient(t,0,0,0);u.addColorStop(0,"rgba(255,255,255, "+.1*r+")");u.addColorStop(.05,"rgba(255,255,255, "+.3*r+")");u.addColorStop(.15,"rgba(0,0,0, "+.25*r+")");u.addColorStop(.25,"rgba(0,0,0, "+.3*r+")");u.addColorStop(1,"rgba(0,0,0, "+.05*r+")");ebook.PageFlipper.Html5._rollShadow=u;n.fillStyle=ebook.PageFlipper.Html5._rollShadow};ebook.PageFlipper.Html5.pageOutLine=function(n,t,i){n.save();n.beginPath();n.fillStyle="#fff";n.shadowBlur=5;n.shadowColor="#888";n.shadowOffsetX=5;n.shadowOffsetY=5;n.fillRect(0,0,t,i);n.restore()};ebook.PageFlipper.Html5.page_shadow1=function(n,t){n.save();var i=n.createLinearGradient(0,0,ebook.PageFlipper.diaplayPage_size.width,0);t||(i.addColorStop(0,"rgba(127,127,127, 0.2)"),i.addColorStop(.05,"rgba(127,127,127, 0.0)"));i.addColorStop(.5,"rgba(255,255,255, 0.1)");t&&(i.addColorStop(.95,"rgba(127,127,127, 0.0)"),i.addColorStop(1,"rgba(127,127,127, 0.2)"));n.fillStyle=i;n.fillRect(0,0,ebook.PageFlipper.diaplayPage_size.width,ebook.PageFlipper.diaplayPage_size.height);n.restore()};ebook.PageFlipper.Html5.page_shadow2=function(n,t){n.shadowBlur=30;n.shadowColor="rgba(0,0,0,"+t+")";n.shadowOffsetX=0;n.shadowOffsetY=0;n.fillStyle="rgba(127,127,127,0.1)"};ebook.PageFlipper.Html5.draw_page=function(n,t){ebook.PageFlipper.Html5.draw_pageRow(n,t,!0)};ebook.PageFlipper.Html5.draw_pageRow=function(n,t,i){var r,u;if(!(t+1>ebook.PageFlipper.pageCount)&&!(t<0)){if(r=!1,typeof ebook.pageCache.pagess[t]!=_undefined&&ebook.pageCache.pagess[t]!==!1&&ebook.pageCache.pagess[t]!==!0&&(r=ebook.pageCache.pagess[t]),!r)try{ebook.PageFlipper.loadThumbImage(t);ebook.PageFlipper.loadThumbImage(t+1);ebook.PageFlipper.loadThumbImage(t+2);t-1>0&&ebook.PageFlipper.loadThumbImage(t-1);t-2>0&&ebook.PageFlipper.loadThumbImage(t-2)}catch(f){}!isEnableSlicePageM()&&i&&(typeof ebook.pageCache.pages[t]!=_undefined&&ebook.pageCache.pages[t]!==!1&&ebook.pageCache.pages[t]!==!0?(u=ebook.pageCache.pages[t],ebook.pageCache.pages[t].complete&&(r=ebook.pageCache.pages[t])):ebook.PageFlipper.loadPageImage(t));r||(r=ebook.data.spacer_img?ebook.data.spacer_img:!1);r&&ebook.PageFlipper.Html5.pageImg(n,r);r=null;isEnableSlicePageM()&&i&&(ebook.PageFlipper.Html5.Slice.pageImgLoad(t),ebook.PageFlipper.Html5.pageImg_slice(n,t));ebook.BookData.pageShadow&&ebook.PageFlipper.Html5.page_shadow1(n,t%2==(ebook.BookData.pageTopDirectionIsLeft==!0?1:0));isBookmarkPage(t)&&ebook.PageFlipper.Html5.drawBk(n,t%2!=0)}};ebook.PageFlipper.Html5.drawBk=function(n,t){if(ebook.data.bookmarktag_img&&typeof ebook.data.bookmarktag_img!=_undefined){var i=ebook.data.bookmark_imgSize,r=ebook.data.bookmark_imgOffs;ebook.BookData.pageTopDirectionIsLeft||(t=!t);try{n.drawImage(ebook.data.bookmarktag_img,0,0,i.width,i.height,t?r.left:ebook.PageFlipper.diaplayPage_size.width-i.width-r.left,r.top,i.width,i.height)}catch(u){}}};ebook.PageFlipper.Html5.update_page=function(n){n.save();n.translate(ebook.PageFlipper.diaplayPage_offset.left,ebook.PageFlipper.diaplayPage_offset.top);ebook.PageFlipper.currentPageNum_left<=1||ebook.PageFlipper.Html5.draw_page(n,getPageNum(ebook.PageFlipper.currentPageNum_left));ebook.PageFlipper.currentPageNum_left<ebook.PageFlipper.pageCount-3&&(n.translate(ebook.PageFlipper.diaplayPage_size.width,0),ebook.PageFlipper.Html5.draw_page(n,getPageNum(ebook.PageFlipper.currentPageNum_left+1)),n.translate(ebook.PageFlipper.diaplayPage_size.width*-1,0));ebook.BookData.use_bookReflection&&(n.translate(0,ebook.PageFlipper.diaplayPage_size.height*2),n.scale(1,-1),n.globalAlpha=.3,ebook.PageFlipper.Html5.draw_pageRow(n,getPageNum(ebook.PageFlipper.currentPageNum_left),!1),n.translate(ebook.PageFlipper.diaplayPage_size.width,0),ebook.PageFlipper.Html5.draw_pageRow(n,getPageNum(ebook.PageFlipper.currentPageNum_left+1),!1),n.globalAlpha=1);n.restore()};ebook.PageFlipper.Html5.Slice={};isEnableSlicePage=function(){return ebook.BookData.pageImgCell&&ebook.BookData.pageImgCell.enable};isEnableSlicePageM=function(){return isEnableSlicePage()&&ebook.BookData.pageImgCell.medium&&ebook.BookData.pageImgCell.medium.enable};isEnableSlicePageL=function(){return isEnableSlicePage()&&ebook.BookData.pageImgCell.large&&ebook.BookData.pageImgCell.large.enable};ebook.PageFlipper.Html5.Slice.pageImgLoad=function(n){var t,i;isEnableSlicePageM()&&((ebook.PageFlipper.Slice._cache.info.medium||ebook.PageFlipper.Slice.init(),t=ebook.PageFlipper.Slice._cache.info.medium,n<0)||(i=ebook.BookData.GetPageImgPath(n),ebook.PageFlipper.Slice.tools.makeSliceFiles(n,i,t,function(n){n.func=function(n){ebook.PageFlipper.Slice._cache.page[n.page]||!1||(ebook.PageFlipper.Slice._cache.page[n.page]={});ebook.PageFlipper.Slice._cache.page[n.page][n.num]=n.img};n.key="m"+n.key;ebook.PageFlipper.Slice.pagePush(n)})))};ebook.PageFlipper.Html5.pageImg_slice=function(n,t){var s=ebook.PageFlipper.Slice._cache.page[t]||!1,u,o,f,i;if(s){var r=ebook.BookData.pageImgCell.medium,e=r.cellSize,h=0,v=ebook.PageFlipper.diaplayPage_size.width,y=ebook.PageFlipper.diaplayPage_size.height,p=r.page_size.width,w=r.page_size.height,c=v/p,l=y/w;for(u=0;u<r.slice.y;u++)for(o=MathRound(l*e*u),f=0;f<r.slice.x;f++){if(i=s[h]||!1,typeof i!=_undefined&&i!=!1){var b=i.width,k=i.height,a=MathRound(c*e*f),d=MathRound(c*(e*f+b))-a,g=MathRound(l*(e*u+k))-o;n.drawImage(i,a,o,d,g)}h++}}};ebook.PageFlipper.Html5.pageImg=function(n,t){var i=ebook.PageFlipper.diaplayPage_size.width,r=ebook.PageFlipper.diaplayPage_size.height,u,f;if(typeof t==_undefined||t==!1)n.fillStyle="#a0a0a0",n.fillRect(0,0,i,r);else{u=t.width;f=t.height;try{n.drawImage(t,0,0,u,f,0,0,i,r)}catch(e){}}};ebook.PageFlipper.mousePos2PagePos=function(n,t){var i=new Point((n-NarrowStageMargin.width-ebook.Narrow.pageViewMargin)*100/NarrowStageFitSize.width,(t-NarrowStageMargin.height-ebook.Narrow.stageTopMargin)*100/NarrowStageFitSize.height);return new Point((NarrowZoom_Point.x*NarrowZoomPageScale-50+i.x)/NarrowZoomPageScale,(NarrowZoom_Point.y*NarrowZoomPageScale-50+i.y)/NarrowZoomPageScale)};ebook.PageFlipper.isWideView=function(){return getWindowHeight()<$(window).width()};ebook.PageFlipper.initNarrowPage=function(){var t='<div id="narrowTools" class="narrowTools_fix"><div id="narrowTools_b_top"><ul><li id="narrowTools_zoomin"><\/li><li id="narrowTools_zoomout"><\/li><\/ul><\/div><div id="narrowTools_b_left"><ul><li id="narrowTools_top"><\/li><li id="narrowTools_left"><\/li><\/ul><\/div><div id="narrowTools_b_right"><ul><li id="narrowTools_last"><\/li><li id="narrowTools_right"><\/li><\/ul><\/div><div id="narrowTools_b_bottom"><ul><li id="narrowTools_list"><\/li><li id="narrowTools_download"><\/li><li id="narrowTools_help"><\/li><\/ul><\/div><\/div>',i=$('<div id="narrowPage" >'+(ebook.BookData.use_NarrowTools?t:"")+'<div id="narrowContents"     ><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><\/div><div id="narrowContentsRow"  ><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><div class="page" ><div class="page-wrap"><\/div><div class="page-wrap"><\/div><\/div><\/div><div id="narrowContentsZoom" ><\/div><div id="narrowContentsPageList" class="clearfix" style="height:100%;padding:0;"><a class="listclose icon_close"><img src="'+ebook.data.sp_icon_path+'" width="50" ><\/a><div class="wrap"><ul class="cf enable_move"><\/ul><\/div><\/div><\/div><table class="ebook5-ui-zoom-wrap" style="display:none;"><tr>\t<td><div class="scale-wrap"><span class="scale-gage"><\/span><\/div><\/td>\t<td class="icon tool-zoom-left" ><img src="'+ebook.data.img_cmn_base_path+'icon-left.png" width="40" height="40"><\/td>\t<td class="icon tool-zoom-right" ><img src="'+ebook.data.img_cmn_base_path+'icon-right.png" width="40" height="40"><\/td><\/tr><\/table>'),n,r;i.appendTo("#stage");ebook.BookData.pageHintEnable||$("#narrowTools_help").remove();n=$("#narrowPage");$("#narrowTools").setDisableSelection().on("mousedown touchstart",function(n){return narrowToolsHide(),n.preventDefault(),!1});n.css({top:"0px",left:"0px",overflow:"hidden",width:"100%","background-repeat":"no-repeat","background-position":"center center",display:"none"});$("#narrowContents,#narrowContentsRow",n).attr("style","z-index:2;top:0px;overflow:hidden;display:block;position:absolute;float:left;");$("#narrowTools").hide();$("*",n).css({"-webkit-touch-callout":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"});$("#narrowContents",n).css({"z-index":"4"});$("#narrowContents>div,#narrowContentsRow>div",n).css({display:"block",float:"left",position:"relative",padding:"0px",margin:"0px",border:"0px"});setNarrowZoomPageScale(1);ResizeNarrowView();n.on("selectstart",function(){return!1});n.off(leb.e.ts+".narrow "+leb.e.md+".narrow");r=ebook.Compatibility.isIOS?"#narrowContentsZoom":window;n.on(ebook.Compatibility.isTouchDevice?leb.e.ts+".zoommovenarrow":leb.e.md+".zoommovenarrow",EVENT_drag_zoomnarrow);n.on(ebook.Compatibility.isTouchDevice?leb.e.ts+".flickPagemove":leb.e.md+".flickPagemove",EVENT_flick_page_narrow);n.on(ebook.Compatibility.isTouchDevice?leb.e.ts+".zoomnarrow":leb.e.md+".zoomnarrow",EVENT_pinch_page_narrow);if(ebook.BookData.use_NarrowTools){n.on(ebook.Compatibility.isTouchDevice?leb.e.ts+".tools":leb.e.md+".tools",EVENT_narrow_tools);$("#narrowTools_download",n).toggle(ebook.BookData.use_Download);clicks($("#narrowTools_zoomin",n),function(n){return n.preventDefault(),narrowToolsHide(),narrowZoomPageAuto(),!1});clicks($("#narrowTools_zoomout",n),function(n){return narrowToolsHide(),narrowZoomOutPageAuto(),!1});clicks($("#narrowTools_list",n),function(){return setTimeout(function(){narrowToolsHide();setNarrowIndexView()},200),!1});clicks($("#narrowTools_download",n),function(){return narrowToolsHide(),displayDownloadDialog(),!1});clicks($("#narrowTools_top",n),function(){return narrowToolsHide(),pageView_jumpPage(0),!1});clicks($("#narrowTools_left",n),function(){return narrowToolsHide(),pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum-1),!1});clicks($("#narrowTools_right",n),function(){return narrowToolsHide(),pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum+1),!1});clicks($("#narrowTools_last",n),function(){return narrowToolsHide(),pageView_jumpPage(ebook.PageFlipper.pageCount-1),!1});clicks($(".listclose",n),function(){return $("#narrowContentsPageList").fadeOut("fast",function(){closeScrwindow();setoffNarrowZoomView()}),!1});clicks($("#narrowTools_help",n),function(){return narrowToolsHide(),window.open(pageHintLinkUrlSp,"_target"),!1})}clicks($(".ebook5-ui-zoom-wrap .tool-zoom-left"),function(){return $(this).hasClass("disable")?!1:($(this).addClass("active"),setTimeout(function(){$(".ebook5-ui-zoom-wrap .tool-zoom-left").removeClass("active")},100),NarrowZoomPageScale>1&&(NarrowPageClickCount=0,setoffNarrowZoomView()),narrowPageEasing(1),!1)});clicks($(".ebook5-ui-zoom-wrap .tool-zoom-right"),function(){return $(this).hasClass("disable")?!1:($(this).addClass("active"),setTimeout(function(){$(".ebook5-ui-zoom-wrap .tool-zoom-right").removeClass("active")},100),NarrowZoomPageScale>1&&(NarrowPageClickCount=0,setoffNarrowZoomView()),narrowPageEasing(0),!1)});ebook.PageFlipper.zoomSlider();init_flick_page_narrow();n.setDisableSelection2()};ebook.PageFlipper.zoomSlider_isSliderDrag=!1;ebook.PageFlipper.zoomSlider=function(){function ut(){NarrowZoomPageScale==1&&(setupZoomNarrowView(),showNarrowZoomContents());removeLinkMapNarrow();k(NarrowZoomPageScale)}function b(){v(100-c());NarrowPageClickCount=0;ebook.PageFlipper.makeLinkMapNarrowPageCmn()}function v(n){var t=getNZoomMaxScale();toscale=(t-1)*n/100+1;t<t&&(toscale=t);k(toscale)}function k(n){var i=getNZoomMaxScale(),t,r;setNarrowZoomPageScale(n);NarrowZoomPageScale>i?setNarrowZoomPageScale(i):NarrowZoomPageScale<1&&setNarrowZoomPageScale(1);t=new Point(NarrowStageFitSize.width/2+NarrowStageMargin.width-ebook.Narrow.pageViewMargin,NarrowStageFitSize.height/2+NarrowStageMargin.height-ebook.Narrow.stageTopMargin);toscale_view_anim=new Point((t.x-NarrowStageMargin.width-ebook.Narrow.pageViewMargin)*100/NarrowStageFitSize.width,(t.y-NarrowStageMargin.height-ebook.Narrow.stageTopMargin)*100/NarrowStageFitSize.height);toscale_pos_anim=new Point((NarrowZoom_Point.x*NarrowZoomPageScale-50+toscale_view_anim.x)/NarrowZoomPageScale,(NarrowZoom_Point.y*NarrowZoomPageScale-50+toscale_view_anim.y)/NarrowZoomPageScale);r=new Point((50+(NarrowZoomPageScale*toscale_pos_anim.x-toscale_view_anim.x))/NarrowZoomPageScale,(50+(NarrowZoomPageScale*toscale_pos_anim.y-toscale_view_anim.y))/NarrowZoomPageScale);NarrowZoom_Point=r;setNzoomImagePos()}var t=!1,d=".ebook5-ui-zoom-wrap ",e=".scale-gage",o=".scale-wrap",n={pos:new Point(0,0),lt:new Point(0,0),size:new Size(0,0),spos:new Point(0,0),npos:new Point(0,0),viewposx:0,binded:!1,vitemCount:0},s=100,i=1,r=100,a=ebook.Compatibility.getMoveTarget($(o,t)),h=function(){var i=$(o,t),u=parseInt(i.innerWidth()),f=parseInt(i.height()),r=parseInt($(e,t).width());n.lt=i.offset();n.lt.left+=r;n.size=new Size(u-r,f)},y=function(n){per=(n-i+1)*100/(r-i+1);per>100&&(per=100);per<0&&(per=0);p(per)},p=function(i){i>100&&(i=100);i<0&&(i=0);n.per=i;var r=parseInt($(e,t).width());pos=n.size.width*(100-i)/100;$(e,t).css("left",pos+r/2+"px")},c=function(){return per=(s-i)*100/(r-i),per>100&&(per=100),per<0&&(per=0),per},w=function(i){var u,r,f;return n.lt=$(o,t).offset(),u=parseInt($(e,t).width()),n.lt.left+=u/2,r=i.x-n.lt.left,r<0&&(r=0),r>n.size.width&&(r=n.size.width),f=Math.round(r*1e4/n.size.width)/100,100-f},l=function(n){s=g(n);p(n)},g=function(n){var t=Math.round(i+(r-i)*n/100);return t>r&&(t=r),t},nt=function(n){var t=w(n);l(t)},f=!1,u=function(n,t){var i=".dragslider",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},ft=!1,tt=0,it=function(n,t,i){var r={},u,f;r.st_per=c();r.per_dist=n-r.st_per;r.per_dir=n>r.st_per?1:-1;r.to_per=n;r.idx=tt++;u=function(n){var i=n.st_per+n.per_dist*n.value;l(i);t&&t(n)};f=function(n){var t=n.st_per+n.per_dist*n.value;l(t);i&&i(n)};ebook.easing.setEasing(r,"value",3,0,1,u,f,"easeOutQuad")},rt=function(){t=$(d).setDisableSelection2();$(o,t).setDisableSelection().off(u(leb.e.ts,leb.e.md)).on(u(leb.e.ts,leb.e.md),function(t){var e=function(){$(a).off(u(leb.e.tm,leb.e.mm));$(a).off(u(leb.e.te,leb.e.mu))},o=t.type===leb.e.ts?t.originalEvent.touches[0]:t,r,i;if(t.type===leb.e.ts&&t.originalEvent.touches.length>1)return f=!1,!1;if(!thred_narrowFlipAfterEasing){f=!0;r=getMousePosEvent(o);n.spos=r.clone();n.npos=r.clone();i=0;$(a).one(u(leb.e.te,leb.e.mu),function(n){if(f){if(f=!1,i==0){var t=w(r)||0;if(t>=0)return it(t,function(){v(100-c())},function(){i=0;e();b();ebook.PageFlipper.zoomSlider_isSliderDrag=!1}),!1}return n.preventDefault(),i=0,e(),b(),ebook.PageFlipper.zoomSlider_isSliderDrag=!1,!1}}).on(u(leb.e.tm,leb.e.mm),function(t){var u=t.type===leb.e.tm?t.originalEvent.touches[0]:t,r;if(t.type===leb.e.tm&&t.originalEvent.touches.length>1){f=!1;e();return}return r=getMousePosEvent(u),n.npos=r.clone(),nt(r),v(100-c()),i++,t.preventDefault(),!1});return h(),ebook.PageFlipper.zoomSlider_isSliderDrag=!0,ut(),t.preventDefault(),!1}})};$(window).on("resize_page",function(n){h();y(s)});return rt(),r=100,h(),y(s),__setSlideHandlePer=function(n){ebook.PageFlipper.zoomSlider_isSliderDrag||(h(),l(n))},this};ebook.PageFlipper.makeLinkMapNarrowPageCmn=function(){var n=getNZoomMaxScale();scale_l=NarrowZoomPageScale;(isNaN(scale_l)||typeof scale_l==_undefined)&&(scale_l=1);scale_l>n&&(scale_l=n);scale_l<=1?(scale_l=1,setNarrowZoomPageScale(1),setoffNarrowZoomViewWithLink()):(ebook.PageFlipper.makeLinkMapNarrowPage2(narrowZoomView_PageNum,$("#narrowContentsZoom #zd03"),new Size(lastSize.width,lastSize.height)),setNarrowZoomPageScale(scale_l))};__setSlideHandlePer=function(n){};var tools_disp_delay=200,tools_hide_delay=3e3,tools_hide_lock=!1;EVENT_narrow_tools_data={click_state:0,thred:!1,view:!1,fout_timer:!1,fin_timer:!1};ebook.PageFlipper.isTopOrLast=function(){return ebook.PageFlipper.narrowCurrentPageNum<=0?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.top:enum_isTopOrLast.last:ebook.PageFlipper.narrowCurrentPageNum>=ebook.PageFlipper.pageCount-1?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.last:enum_isTopOrLast.top:enum_isTopOrLast.other};ebook.PageFlipper.makeLinkMapNarrowPage=function(n,t){var i=new Size(NarrowStageFitSize.width,NarrowStageFitSize.height);ebook.PageFlipper.makeLinkMapNarrowPage2(n,t,i,1)};ebook.PageFlipper.makeLinkMapNarrowPage2=function(n,t,i,r){var u,o,f,e;(typeof r==_undefined&&(r=0),u=ebook.PageFlipper.isTopOrLast(),o=ebook.PageFlipper.isWideView(),n<0&&n++,f=!0,e=new Position(o&&u==enum_isTopOrLast.other?i.width*r/-2:0,0),(u==enum_isTopOrLast.other||u==enum_isTopOrLast.top)&&(pagenum=getPageNum(n),makeLinkMapPage_sub(t,pagenum,e,i,f),f=!1),u==enum_isTopOrLast.last&&(pagenum=getPageNum(n),makeLinkMapPage_sub(t,pagenum,e,i,f)),o)&&u==enum_isTopOrLast.other&&(pagenum=getPageNum(n+1),e=new Position(i.width/(r?2:1),0),makeLinkMapPage_sub(t,pagenum,e,i,f),f=!1)};var Narrow={},NarrowPagePos=new Point(0,0),NarrowPageMousePos=!1,NarrowStageFitSize=new Size(0,0),NarrowStageMargin=new Size(0,0),NarrowZoomPageScale=1,NarrowImageSize={},NarrowStageSize={},NarrowPagePos_Old,NarrowZoomPageMousePos=!1,NarrowPageClickCount=0;var narrowclick_dbc_first_mousePos={},narrowclick_first_mousePos={},narrowclick_last_mousePos={},pinch_info={},dbclick_ntime=0,normalNum=function(n){return isNaN(n)||n==Number.POSITIVE_INFINITY||n==Number.NEGATIVE_INFINITY?0:n};$(window).bind("resize_page",function(n){IsNarrowIndexView()&&setNarrowIndexViewWidth()});_IsNarrowIndexView=!1;npager_pagecnt=8;makeNarrowThumbListPager_maked=!1;var narrowZoomView_PageNum=-99,NarrowZoomScaleUp=0,NarrowZoom_Point=new Point;tonscale_anim=0;before_nscale_anim=0;tonscale_anim_step=10;tonscale_anim_step_val=!1;toscale_pos_anim=!1;toscale_view_anim=!1;var EVENT_drag_zoomnarrow_mousedownCheck_func=!1,EVENT_drag_zoomnarrow=function(n){var r=ebook.Compatibility.getMoveTarget("#narrowPage"),u=!1,t=".nzoomPagemove",f=ebook.Compatibility.isTouchDevice?leb.e.tm+t:leb.e.mm+t,e=ebook.Compatibility.isTouchDevice?leb.e.te+t:leb.e.mu+t,c={capture:!1,passive:!1},l=$(r),i=function(){$(r).off(f).off(e)},o=function(n){var r=typeof n.originalEvent!==_undefined?n.originalEvent:n,u=n.type===leb.e.tm?r.touches[0]:n,t;if(n.type===leb.e.tm&&r.touches.length>1||IsNarrowIndexView())return i(),n.preventDefault(),!1;t=getMousePosEvent(u);t&&(narrowclick_last_mousePos=t.clone(),move_nzoomPageMove(t));n.preventDefault()},s=function(n){var f,e,o;n.preventDefault();i();var s=typeof n.originalEvent!==_undefined?n.originalEvent:n,l=n.type===leb.e.te?s.touches[0]:n,t=new Date,r=t.getTime()-ntime.getTime(),h=Math.abs((narrowclick_first_mousePos.x||-100)-(narrowclick_last_mousePos.x||-200)),c=Math.abs((narrowclick_first_mousePos.y||-100)-(narrowclick_last_mousePos.y||-200));if(narrowclick_first_mousePos&&narrowclick_last_mousePos&&h<60&&c<60&&r<600){if(!ebook.Narrow.dblclickZoom)return;if(NarrowPageClickCount++,NarrowPageClickCount>1){if(NarrowPageClickCount=0,f=t.getTime()-dbclick_ntime.getTime(),f<600)return n.preventDefault(),n.stopPropagation(),narrowZoomOutPageAuto(narrowclick_last_mousePos.clone()),!1}else dbclick_ntime=new Date,setTimeout(function(){NarrowPageClickCount=0},1e3)}else NarrowPageClickCount=0;typeof ebook.BookData.PageDragInfoCallback!=_undefined&&(e=ebook.PageFlipper.mousePos2PagePos(narrowclick_last_mousePos.x,narrowclick_last_mousePos.y),o=getPageNum(ebook.PageFlipper.narrowCurrentPageNum),setTimeout(function(){ebook.BookData.PageDragInfoCallback(o,"false",u,e,r,"narrow")},1))},h=function(){var h,c,l,t;if(!(NarrowZoomPageScale<=1)&&!IsNarrowIndexView()){if(h=typeof n.originalEvent!==_undefined?n.originalEvent:n,c=n.type===leb.e.ts?h.touches[0]:n,n.type===leb.e.ts&&h.touches.length>1){NarrowPageClickCount=0;return}if(!EVENT_drag_zoomnarrow_mousedownCheck_func||(l=EVENT_drag_zoomnarrow_mousedownCheck_func(n,this),l)){NarrowZoomPageMousePos=!1;t=getMousePosEvent(c);t&&(narrowclick_first_mousePos=t.clone(),narrowclick_last_mousePos=t.clone(),u=ebook.PageFlipper.mousePos2PagePos(narrowclick_first_mousePos.x,narrowclick_first_mousePos.y));ntime=new Date;i();$(r).on(f,o).one(e,function(n){return s(n),!1})}}};h()},move_nzoomPageMove=function(n){var i,r,t;NarrowZoomPageMousePos==!1&&(NarrowZoomPageMousePos=n.clone());i=NarrowZoomPageMousePos.x-n.x;NarrowZoomPageMousePos.x=n.x;r=NarrowZoomPageMousePos.y-n.y;NarrowZoomPageMousePos.y=n.y;t=new Size(NarrowStageFitSize.width*NarrowZoomPageScale,NarrowStageFitSize.height*NarrowZoomPageScale);NarrowZoom_Point.x+=i*100/t.width;NarrowZoom_Point.y+=r*100/t.height;setNzoomImagePos()},EVENT_flick_page_narrow_mousedownCheck_func=!1,thred_narrowFlipAfterEasing=!1,narrowPageEasing=function(){};EVENT_flick_page_narrow=function(n){var t=".flickPagemove",s="body",h=function(){$(s).off(leb.e.tm+t+" "+leb.e.mm+t+" "+leb.e.te+t+" "+leb.e.mu+t)},u=function(n){var s,c,l;h();r();var u=new Date,e=u.getTime()-o.getTime(),s=Math.abs((narrowclick_first_mousePos.x||-100)-(narrowclick_last_mousePos.x||-200)),c=Math.abs((narrowclick_first_mousePos.y||-100)-(narrowclick_last_mousePos.y||-200));if(s<10&&c<10&&e<400){if(!ebook.Narrow.dblclickZoom)return;if(NarrowPageClickCount++,NarrowPageClickCount>1)if(NarrowPageClickCount=0,s=Math.abs((narrowclick_dbc_first_mousePos.x||-100)-(narrowclick_last_mousePos.x||-200)),c=Math.abs((narrowclick_dbc_first_mousePos.y||-100)-(narrowclick_last_mousePos.y||-200)),s<30&&c<30){if(l=u.getTime()-dbclick_ntime.getTime(),l<800)return n.preventDefault(),narrowZoomPageAuto(narrowclick_first_mousePos.clone()),!1}else narrowclick_dbc_first_mousePos=narrowclick_last_mousePos.clone(),dbclick_ntime=u;else narrowclick_dbc_first_mousePos=narrowclick_last_mousePos.clone(),dbclick_ntime=u,setTimeout(function(){NarrowPageClickCount=0},1e3);(n.type===leb.e.te?ebook.data.specialNodesForTouch:ebook.data.specialNodes).test(n.target.nodeName.toLowerCase())||n.preventDefault();return}NarrowPageClickCount=0;n.preventDefault();var t=new Size(narrowclick_last_mousePos.x-narrowclick_first_mousePos.x,narrowclick_last_mousePos.y-narrowclick_first_mousePos.y),a=Math.atan(t.width/t.height),v=t.height/Math.sin(a),p=normalNum(v*100/e),y=new Size(normalNum(t.width*100/e),normalNum(t.height*100/e));return i=y.width*-1,f(),NarrowPageMousePos=!1,!1},l=function(n){var t,i,f;if(n.type===leb.e.tm&&n.originalEvent.touches.length>1){u(n);return}r();thred_narrowFlipAfterEasing=!0;t=getMousePosEvent(n);narrowclick_last_mousePos=t.clone();i=Math.abs((narrowclick_first_mousePos.x||-100)-(narrowclick_last_mousePos.x||-200));f=Math.abs((narrowclick_first_mousePos.y||-100)-(narrowclick_last_mousePos.y||-200));(i>10||f>10)&&(NarrowPageClickCount=0,y(t),n.preventDefault())},a=function(n){i=n?-900:900;f()},f=function(){var n=i;n>900&&(n=900);n<-900&&(n=-900);i=n;r();Math.abs(n)>20?(NarrowPagePos.x+=Math.round(n/3),e(),i-=n/2,thred_narrowFlipAfterEasing=setTimeout(function(){f()},50)):(i=0,thred_narrowFlipAfterEasing=setTimeout(function(){c()},50))},c=function(){var h=20,i=NarrowStageSize.width,t=NarrowPagePos.x%i,f=h*i/100,o=ebook.PageFlipper.isWideView(),a=ebook.PageFlipper.isTopOrLast(),n,l,u,s;if(Math.abs(t)<=20||Math.abs(t)>=i-20){if(NarrowPagePos_Old-NarrowPagePos.x>f?NarrowPagePos.x-=t:NarrowPagePos.x-NarrowPagePos_Old>f?NarrowPagePos.x+=t:NarrowPagePos.x=NarrowPagePos_Old,NarrowPagePos_Old!=NarrowPagePos.x){n=ebook.PageFlipper.narrowCurrentPageNum;n<0&&(n=0);n>=ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount-1);o&&n%2==0&&n--;NarrowPagePos_Old<NarrowPagePos.x?n+=o?2:1:NarrowPagePos_Old>NarrowPagePos.x&&(n-=o?2:1);n<0&&(n=0);n>=ebook.PageFlipper.pageCount&&(n=ebook.PageFlipper.pageCount-1);l=n;o&&n%2==0&&n--;ebook.PageFlipper.narrowCurrentPageNum=n;thred_narrowFlipAfterEasing=!1;updateNarrowBTools();fitNarrowImg();setNarrowPage(0,!0);u=getPageNum(ebook.PageFlipper.narrowCurrentPageNum);u=u<0?0:u;callBookchangeUserFunc(u+1);setupZoomNarrowView();setoffNarrowZoomView();setNarrowZoomPageScale(1);return}}else s=0,s=NarrowPagePos_Old-NarrowPagePos.x>f?-1*Math.round(t/2):NarrowPagePos.x-NarrowPagePos_Old>f?Math.round((i-t)/2):NarrowPagePos_Old<NarrowPagePos.x?-1*Math.round(t/2):Math.round((i-t)/2),NarrowPagePos.x+=s,r(),thred_narrowFlipAfterEasing=setTimeout(function(){c()},50);e()},r=function(){thred_narrowFlipAfterEasing!==!1&&thred_narrowFlipAfterEasing!==!0&&clearTimeout(thred_narrowFlipAfterEasing);thred_narrowFlipAfterEasing=!1},v=function(n){var e=n.type===leb.e.ts?n.originalEvent.touches[0]:n,f,i;if(!(NarrowZoomPageScale>1)&&!IsNarrowIndexView()&&(n.type!==leb.e.ts||!(n.originalEvent.touches.length>1))&&(n.type!=leb.e.md||!isRightClick(n))&&!$("#sub_scrwindow,#scrwindow .mask_layer,#narrowTools").is(":visible")){if(EVENT_flick_page_narrow_mousedownCheck_func&&(f=EVENT_flick_page_narrow_mousedownCheck_func(n,this),!f))return!1;NarrowPageMousePos=!1;i=getMousePosEvent(e);i&&(narrowclick_first_mousePos=i.clone(),narrowclick_last_mousePos=i.clone());o=new Date;r();$(s).on((ebook.Compatibility.isTouchDevice?leb.e.tm:leb.e.mm)+t,l).one((ebook.Compatibility.isTouchDevice?leb.e.te:leb.e.mu)+t,u);n.preventDefault()}},y=function(n){var t=new Date;o=t;NarrowPageMousePos==!1&&(NarrowPageMousePos=n.clone());NarrowPagePos.x+=NarrowPageMousePos.x-n.x;NarrowPageMousePos.x=n.x;e()},e=function(){var n=new Size($("#stage").width(),$("#stage").height());NarrowPagePos.x<0?NarrowPagePos.x=0:NarrowPagePos.x>NarrowImageSize.width-n.width&&(NarrowPagePos.x=NarrowImageSize.width-n.width);NarrowPagePos.y<0?NarrowPagePos.y=0:NarrowPagePos.y>NarrowImageSize.height-n.height&&(NarrowPagePos.y=NarrowImageSize.height-n.height);NarrowPagePos.x=NarrowPagePos.x>0?NarrowPagePos.x:0;NarrowPagePos.y=NarrowPagePos.y>0?NarrowPagePos.y:0;$("#narrowContents,#narrowContentsRow").css("left",-1*NarrowPagePos.x+"px ").css("top",-1*NarrowPagePos.y+"px")},o=0,i=0;n!=!1?v(n):(EVENT_flick_page_narrow.clearbind=h,EVENT_flick_page_narrow.end_event=u,narrowPageEasing=a)};ebook.PageWide={};ebook.PageWide.Zoom={};ZoomSlide={};ebook.PageWide.zoomPage_pos=new Point(0,0);ebook.PageWide.zoomPage_lt=new Point(0,0);ebook.PageWide.zoomPage_Margin=new Point(0,0);ebook.PageWide.zoomPage_scale=1;ebook.PageWide.zoomPage_scale_min=1;ebook.PageWide.zoomPage_scale_max=2;ebook.PageWide.zoomPage_mouse_pos=!1;ebook.PageWide.zoomScreenSize=new Size;ebook.PageWide.zoomPageMinSize=new Size;ebook.PageWide.l_img_size;ebook.PageWide.zoomPage_mouseEventObj=!1;ebook.PageWide.zoomPage_pageNum=!1;ebook.PageWide.zoomPage_initPos=!1;ebook.PageWide.ZoomPageMouseMoved=0;ebook.PageWide.zoomDragTarget="#l_canvas";ebook.PageWide.zoomSliderInsertTargetTag="#ctrl_panel .zoom_gage";ebook.PageWide.marginBottom=0;ebook.PageWide.mousePos2PagePos=function(n,t){var i=ebook.PageWide.getZoomPageAbsolutePosByPos(new Point(n,t));return{x:i.width*100,y:i.height*100}};ebook.PageWide.initZoomView=function(){$("#l_canvasbase").empty();ebook.PageWide.zoomDragTarget="#l_canvasbase";ebook.PageWide.zoomPage_scale=1.25};ebook.PageWide.set_slice_size=function(){var u=ebook.PageWide.zoomPageMinSize.multir(ebook.PageWide.zoomPage_scale),t,i;if(isEnableSlicePageM()){var r=ebook.BookData.pageImgCell.medium,n=r.cellSize,f=r.page_size.width,e=r.page_size.height,o=0;for(t=0;t<r.slice.y;t++){var c=n+t*n<=e?n:e%n,s=MathRound(u.height*n*t/e),l=MathRound(u.height*(n*t+c)/e),a=l-s;for(i=0;i<r.slice.x;i++){var v=n+i*n<=f?n:f%n,h=MathRound(u.width*n*i/f),y=MathRound(u.width*(n*i+v)/f),p=y-h;$(".mcell-"+o).css({left:h+"px",top:s+"px",width:p+"px",height:a+"px",position:"absolute"});o++}}}if(isEnableSlicePageL()){var r=ebook.BookData.pageImgCell.large,n=r.cellSize,f=r.page_size.width,e=r.page_size.height,o=0;for(t=0;t<r.slice.y;t++){var c=n+t*n<=e?n:e%n,s=MathRound(u.height*n*t/e),l=MathRound(u.height*(n*t+c)/e),a=l-s;for(i=0;i<r.slice.x;i++){var v=n+i*n<=f?n:f%n,h=MathRound(u.width*n*i/f),y=MathRound(u.width*(n*i+v)/f),p=y-h;$(".lcell-"+o).css({left:h+"px",top:s+"px",width:p+"px",height:a+"px",position:"absolute"});o++}}}};ebook.PageWide.set_slice_page=function(n,t){var i;if(n=getPageNum(ebook.PageWide.zoomPage_pageNum),i=ebook.PageWide.isTopOrLast(),t&&n--,ebook.BookData.pageTopDirectionIsLeft?n++:i==enum_isTopOrLast.other&&(t=!t),n<0&&(n=0),isEnableSlicePageM()){var r=$(t?"#zoomMImg_left":"#zoomMImg_right"),u=ebook.BookData.pageImgCell.medium,f=ebook.BookData.GetPageImgPath(n),e=function(t){t.page==n&&$(".mcell-"+t.num,r).attr("src",t.src).css({"background-color":"rgba(255,255,255,0.3)"})};ebook.PageFlipper.Slice.tools.makeSliceFiles(n,f,u,function(n){n.func=e;n.key="m"+n.key;ebook.PageFlipper.Slice.pagePush(n)})}if(isEnableSlicePageL()){var r=$(t?"#zoomImg_left":"#zoomImg_right"),u=ebook.BookData.pageImgCell.large,f=ebook.BookData.GetPageImgLargePath(n),o=function(t){t.page==n&&$(".lcell-"+t.num,r).attr("src",t.src)};ebook.PageFlipper.Slice.tools.makeSliceFiles(n,f,u,function(n){n.func=o;n.key="l"+n.key;ebook.PageFlipper.Slice.pagePush(n)})}};ebook.PageWide.init_slice_tag=function(){var f='<div id="l_SImgwrap" class="l_pageframe"><img id="zoomSImg_left" class="z-page" /><img id="zoomSImg_right" class="z-page" /><\/div>',r='<div id="l_LImgwrap" class="l_pageframe"><img id="zoomImg_left" class="z-page" /><img id="zoomImg_right" class="z-page" /><\/div>',u='<div id="l_MImgwrap" class="l_pageframe"><img id="zoomMImg_left" class="z-page" /><img id="zoomMImg_right" class="z-page" /><\/div>',n,i,t;if(!isEnableSlicePage())return r+u;if(isEnableSlicePageM()){for(n="",i=ebook.BookData.pageImgCell.medium,t=0;t<i.slice.count;t++)n=n+'<img class="mcell-'+t+'">';u='<div id="l_MImgwrap" class="l_pageframe">\t<div id="zoomMImg_left" class="z-page" >'+n+'<\/div>\t<div id="zoomMImg_right" class="z-page" >'+n+"<\/div><\/div>"}if(isEnableSlicePageL()){for(n="",i=ebook.BookData.pageImgCell.large,t=0;t<i.slice.count;t++)n=n+'<img class="lcell-'+t+'">';r='<div id="l_LImgwrap" class="l_pageframe">\t<div id="zoomImg_left" class="z-page" >'+n+'<\/div>\t<div id="zoomImg_right" class="z-page" >'+n+"<\/div><\/div>"}return f+r+u};ebook.PageWide.changeZoomView=function(n){var t,c,l,e,r,v,a,y,f,u,i;$("#stage").children().hide();t=ebook.PageFlipper.currentPageNum_left;c=-1;ebook.PageWide.zoomPage_mouseEventObj!==!1?(l=ebook.PageWide.zoomPage_mouseEventObj,f=new Point(l.pageX-ebook.PageFlipper.canvas_offset.left,l.pageY-ebook.PageFlipper.canvas_offset.top),c=ebook.PageFlipper.n_pageHit(f),c==2&&t++):n==1&&t++;t<0&&(t=0);t>=ebook.PageFlipper.pageCount&&(t=ebook.PageFlipper.pageCount-1);e=t;ebook.PageFlipper.narrowCurrentPageNum=e;ebook.PageWide.zoomPage_pageNum=ebook.PageFlipper.currentPageNum_left;t=getPageNum(ebook.PageWide.zoomPage_pageNum);ebook.BookData.pageTopDirectionIsLeft&&t++;r=$("#l_canvas");$("#l_canvasimg").get(0)?($(ebook.PageWide.zoomSliderInsertTargetTag).show(),ebook.PageTool.setMiddleCtrlPanel()):(v=ebook.PageWide.init_slice_tag(),$('<div id="l_canvasimg"><div id="l_img">'+v+'<\/div><\/div><div id="z_prev_btn" class="zoom_prev_next" title=""><\/div><div id="z_next_btn" class="zoom_prev_next" title=""><\/div><div class="z_close"><img src="'+ebook.data.sp_icon_path+'" width="50" /><\/div>').appendTo("#l_canvasbase"),$("#l_canvasimg").css({width:"100%"}),$("#l_canvasbase").css({position:"relative",width:"100%",margin:"0px auto"}),$(".l_pageframe",r).css({position:"absolute",clear:"both",top:0}),$("#l_img .z-page",r).css({display:"block",top:0,position:"absolute"}),$(".l_pageframe .z-page",r).css({width:MathRound(ebook.BookData.pageImgSize_large.width),height:MathRound(ebook.BookData.pageImgSize_large.height)}),$("#l_canvasbase #z_prev_btn",r).hide().clicks({start_func:function(n){n.preventDefault();n.stopPropagation()},end_func:function(){return pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum-2),ebook.PageWide.setZoomPageAbsolutePos({height:0,width:ebook.BookData.pageTopDirectionIsLeft?0:1}),ebook.PageWide.setLargeImagePos(),!1}}),$("#l_canvasbase #z_next_btn",r).hide().clicks({start_func:function(n){n.preventDefault();n.stopPropagation()},end_func:function(){return pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum+2),ebook.PageWide.setZoomPageAbsolutePos({height:0,width:ebook.BookData.pageTopDirectionIsLeft?0:1}),ebook.PageWide.setLargeImagePos(),!1}}),ebook.PageWide.bindZoomPageDragAction(ebook.PageWide.zoomDragTarget),ebook.PageWide.pinchFunc=bindPinchTouchAction(ebook.PageWide.zoomDragTarget,function(n,t){var i=n.savePage_scale*n.scale;return i>ebook.PageWide.zoomPage_scale_max&&(i=ebook.PageWide.zoomPage_scale_max),i<ebook.PageWide.zoomPage_scale_min&&(i=ebook.PageWide.zoomPage_scale_min),ebook.PageWide.zoomPage_scale=i,ZoomSlide.setSlideHandlePosByScale(i),ebook.PageWide.calcZoomPageSize(),ebook.PageWide.setZoomPageAbsolutePosCenter(n.savePage_absPos,n.saveScreen_absPos),ebook.PageWide.setLargeImagePos(),!0},function(n,t){ebook.PageWide.makeLinkMapZoomPage(ebook.PageWide.zoomPage_pageNum);n.savePage_scale==1&&n.scale<1&&ebook.PageFlipper.changeWidePage()},function(n,t){n.savePage_absPos=ebook.PageWide.getZoomPageAbsolutePosByPos(n.firstPoint);n.saveScreen_absPos=ebook.PageWide.getZoomScreenAbsolutePosByPos(n.firstPoint);n.savePage_scale=ebook.PageWide.zoomPage_scale;ebook.PageWide.removeLinkMapZoomPage()}),$(ebook.PageWide.zoomDragTarget).off(leb.e.mw).bind(leb.e.mw,ebook.PageWide.EVENT_wheel_move),ebook.PageWide.makeZoomSlide());$("#l_canvasbase #z_prev_btn",r).hide().toggle(e>=1);$("#l_canvasbase #z_next_btn",r).hide().toggle(e<ebook.PageFlipper.pageCount-1);$("#l_canvasbase").hide();$("#l_canvas,#zoommap_wind").show();ebook.Compatibility.isIE6&&$("#page").css("overflow","hidden");a=ebook.PageWide.isTopOrLast();ebook.PageWide.zoomPage_mouseEventObj?(y=getMousePosEvent(ebook.PageWide.zoomPage_mouseEventObj),f=cnv_windowToLocal(y),ebook.PageWide.zoomPage_initPos=a==enum_isTopOrLast.other?ebook.PageFlipper.getPageMouseRelativeWidePos(f):ebook.PageFlipper.getPageMouseRelativePos(f)):ebook.PageWide.zoomPage_initPos=new Size(.5,.5);$("#l_LImgwrap").css({"z-index":9});$("#l_MImgwrap").css({"z-index":8});$("#l_img img").attr("src",ebook.data.spacegif_url);u=!1;i=!1;switch(a){case enum_isTopOrLast.top:i=t;break;case enum_isTopOrLast.last:i=t-1;break;case enum_isTopOrLast.other:i=t;u=t;ebook.BookData.pageTopDirectionIsLeft?i--:u--;break}var o=$("#l_LImgwrap"),s=$("#l_MImgwrap"),h=$("#l_SImgwrap");u===!1?($("#zoomSImg_right",h).attr("src","").hide(),$("#zoomMImg_right",s).attr("src","").hide(),$("#zoomImg_right",o).attr("src","").hide()):($("#zoomSImg_right",h).attr("src",ebook.BookData.pageImgPathList_thumb[u]).show(),$("#zoomMImg_right",s).attr("src",ebook.BookData.pageImgPathList[u]).show(),$("#zoomImg_right",o).attr("src",ebook.BookData.pageImgPathList_large[u]).show(),ebook.PageWide.set_slice_page(u,!1));i===!1?($("#zoomSImg_left",h).attr("src","").hide(),$("#zoomMImg_left",s).attr("src","").hide(),$("#zoomImg_left",o).attr("src","").hide()):($("#zoomSImg_left",h).attr("src",ebook.BookData.pageImgPathList_thumb[i]).show(),$("#zoomMImg_left",s).attr("src",ebook.BookData.pageImgPathList[i]).show(),$("#zoomImg_left",o).attr("src",ebook.BookData.pageImgPathList_large[i]).show(),ebook.PageWide.set_slice_page(i,!0));ebook.PageWide.setupZoomPageSize();ebook.PageWide.setZoomPageAbsolutePos(ebook.PageWide.zoomPage_initPos);ebook.PageWide.setLargeImagePos();$("#l_canvasbase").show(10);ebook.PageWide.zoomUserCallback();ebook.PageWide.zoomPage_mouseEventObj?ebook.PageWide.zoomPage_mouseEventObj.originalEvent&&ebook.PageWide.zoomPage_mouseEventObj.originalEvent.touches&&ebook.PageWide.zoomPage_mouseEventObj.originalEvent.touches.length>1?ebook.PageWide.pinchFunc(ebook.PageWide.zoomPage_mouseEventObj,"entry"):ebook.PageWide.EVENT_zoomPage_mousedown(ebook.PageWide.zoomPage_mouseEventObj,!0):ebook.PageWide.move_zoomPageMove(new Point(0,0));ebook.PageWide.zoomPage_mouseEventObj=!1};ebook.PageWide.zoomUserCallback=function(){var t=ebook.PageWide.isTopOrLast(),n=getPageNum(ebook.PageFlipper.currentPageNum_left+(ebook.BookData.pageTopDirectionIsLeft?1:0));t==enum_isTopOrLast.last?setTimeout(function(){ebook.BookData.PageZoomCallBack(n)},0):t==enum_isTopOrLast.top?setTimeout(function(){ebook.BookData.PageZoomCallBack(n+1)},0):setTimeout(function(){ebook.BookData.PageZoomCallBack(n);ebook.BookData.PageZoomCallBack(n+1)},0)};ebook.PageWide.setZoomPageLeft=function(){if(!ebook.BookData.use_largeImage)return!1;ebook.PageWide.zoomPage_mouseEventObj=!1;ebook.PageFlipper.setZoomMode();ebook.PageFlipper.changePageMode(0)};ebook.PageWide.setZoomPageRight=function(){if(!ebook.BookData.use_largeImage)return!1;ebook.PageWide.zoomPage_mouseEventObj=!1;ebook.PageFlipper.setZoomMode();ebook.PageFlipper.changePageMode(1)};ebook.PageWide.EVENT_wheel_move=function(n,t){var s=t>0?"Up":"Down",h=Math.abs(t),i=getMousePosEvent(n),u=ebook.PageWide.getZoomScreenAbsolutePosByPos(i),f=ebook.PageWide.getZoomPageAbsolutePosByPos(i),e=ebook.PageWide.zoomPage_scale,o=(ebook.PageWide.zoomPage_scale_max-ebook.PageWide.zoomPage_scale_min)/10,r=ebook.PageWide.setZoomPageScale(ebook.PageWide.zoomPage_scale+o*t/2);if(e!=r)return ZoomSlide.setSlideHandlePosByScale(r),ebook.PageWide.calcZoomPageSize(),ebook.PageWide.setZoomPageAbsolutePosCenter(f,u),ebook.PageWide.setLargeImagePos(),ebook.PageWide.makeLinkMapZoomPage(ebook.PageWide.zoomPage_pageNum),!1};enum_isTopOrLast={top:1,last:2,other:3};ebook.PageWide.isTopOrLast=function(){return ebook.PageWide.zoomPage_pageNum<=0?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.top:enum_isTopOrLast.last:ebook.PageWide.zoomPage_pageNum>=ebook.PageFlipper.pageCount-1?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.last:enum_isTopOrLast.top:enum_isTopOrLast.other};ebook.PageWide.setupZoomPageSize=function(){ebook.PageWide.calcZoomPageSize();var n=$("#l_canvas").innerHeight(),i=$("#l_canvas").width(),t=ebook.PageWide.marginBottom;$("#l_canvasimg, #l_canvasbase, #l_canvasbase .zoom_prev_next").css({height:n-t+"px"});$("#zoommap_wind > img").attr("src",ebook.BookData.pageImgPathList_thumb[ebook.PageWide.zoomPage_pageNum]).hide();ebook.PageWide.setZoomMapPos();ebook.PageWide.makeLinkMapZoomPage(ebook.PageWide.zoomPage_pageNum)};ebook.PageWide.EVENT_zoomPage_mousedown=function(){};ebook.PageWide.move_zoomPageMove=function(){};ebook.PageWide.bindZoomPageDragAction=function(n){var r=ebook.Compatibility.isIE?n:window,t=function(n,t){var i=".EVENT_zoomPage",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},i=function(){$(r).off(t(leb.e.tm,leb.e.mm));$(r).off(t(leb.e.te,leb.e.mu))},u=function(n,u){var o,h,f;if(!ebook.PageFlipper.isWideMode()){if(o=n.type===leb.e.ts?n.originalEvent.touches[0]:n,n.type===leb.e.ts&&n.originalEvent.touches.length>1)return i(),!0;if(typeof u=="undefined"&&(u=!1),h=$("#l_canvas").css("display"),h!="none"){if(!u&&isRightClick(o))return ebook.PageFlipper.changeWidePage(),!1;var l=new Date,c=!1,s=getMousePosEvent(o),e=s;ebook.PageWide.zoomPage_mouse_pos=!1;ebook.PageWide.ZoomPageMouseMoved=0;f=$("#stage").offset()||{top:0,left:0};c=ebook.PageWide.mousePos2PagePos(s.x-f.left,s.y-f.top);$(r).bind(t(leb.e.tm,leb.e.mm),function(n){return n.type===leb.e.ts&&n.originalEvent.touches.length>1?(i(),!0):(e=getMousePosEvent(n),ebook.PageWide.move_zoomPageMove(e),ebook.PageWide.ZoomPageMouseMoved++,!1)}).one(t(leb.e.te,leb.e.mu),function(n){var s=new Date,h=s.getTime()-l.getTime();if(i(),typeof ebook.BookData.PageDragInfoCallback!=_undefined){var a=ebook.PageWide.mousePos2PagePos(e.x-f.left,e.y-f.top),u=ebook.PageWide.zoomPage_pageNum,t=!1,r=!1,o=ebook.PageWide.isTopOrLast();(o==enum_isTopOrLast.other||o==enum_isTopOrLast.top)&&(t=getPageNum(u));o==enum_isTopOrLast.other?r=getPageNum(u+1):o==enum_isTopOrLast.last&&(ebook.BookData.pageTopDirectionIsLeft&&u--,r=getPageNum(u+1));t==-1&&(t=0);r==-1&&(r=0);t===!1&&r>t&&(t=[r,r=t][0]);ebook.BookData.PageDragInfoCallback(t,r,c,a,h,"wide")}return!0});return!0}}},f=function(n){ebook.PageWide.zoomPage_mouse_pos==!1&&(ebook.PageWide.zoomPage_mouse_pos=n.clone());ebook.PageWide.zoomPage_pos.x+=ebook.PageWide.zoomPage_mouse_pos.x-n.x;ebook.PageWide.zoomPage_mouse_pos.x=n.x;ebook.PageWide.zoomPage_pos.y+=ebook.PageWide.zoomPage_mouse_pos.y-n.y;ebook.PageWide.zoomPage_mouse_pos.y=n.y;ebook.PageWide.setLargeImagePos()};ebook.PageWide.EVENT_zoomPage_mousedown=u;ebook.PageWide.move_zoomPageMove=f;i();$(n).off(t(leb.e.ts,leb.e.md));$(n).bind(t(leb.e.ts,leb.e.md),u)};ebook.PageWide.setZoomPageAbsolutePos=function(n){var t=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale),i=ebook.PageWide.getScreenAjustPageSize(),r=ebook.PageWide.isTopOrLast();ebook.PageWide.zoomPage_pos.x=t.width*(r==enum_isTopOrLast.other?2:1)*n.width-i.width/2;ebook.PageWide.zoomPage_pos.y=t.height*n.height-i.height/2};ebook.PageWide.setZoomPageAbsolutePosCenter=function(n,t){var i=ebook.PageWide.zoomScreenSize.clone(),r=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale);ebook.PageWide.zoomPage_pos.x=r.width*n.width-i.width*t.width;ebook.PageWide.zoomPage_pos.y=r.height*n.height-i.height*t.height};ebook.PageWide.getScreenAjustPageSize=function(){var n=ebook.PageWide.getZoomPageSize();return ebook.PageWide.zoomScreenSize.width<n.width&&(n.width=ebook.PageWide.zoomScreenSize.width),ebook.PageWide.zoomScreenSize.height<n.height&&(n.height=ebook.PageWide.zoomScreenSize.height),n};ebook.PageWide.getZoomPageSize=function(){var n=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale).clone(),t=ebook.PageWide.isTopOrLast();return n.width*=t==enum_isTopOrLast.other?2:1,n};ebook.PageWide.getZoomPageAbsolutePos=function(){var t=ebook.PageWide.getZoomPageSize(),i=ebook.PageWide.getScreenAjustPageSize(),n=new Size;return n.width=(ebook.PageWide.zoomPage_pos.x+i.width/2)/t.width,n.height=(ebook.PageWide.zoomPage_pos.y+i.height/2)/t.height,n};ebook.PageWide.setZoomPageScale=function(n){return n>ebook.PageWide.zoomPage_scale_max&&(n=ebook.PageWide.zoomPage_scale_max),n<ebook.PageWide.zoomPage_scale_min&&(n=ebook.PageWide.zoomPage_scale_min),ebook.PageWide.zoomPage_scale=n,n};ebook.PageWide.getZoomScreenAbsolutePosByPos=function(n){var i=new Point(n.x-ebook.PageWide.zoomPage_lt.x,n.y-ebook.PageWide.zoomPage_lt.y),r=ebook.PageWide.zoomScreenSize.clone(),t=new Size;return t.width=i.x/r.width,t.height=i.y/r.height,t};ebook.PageWide.getZoomPageAbsolutePosByPos=function(n){var i=new Point(n.x-ebook.PageWide.zoomPage_lt.x-ebook.PageWide.zoomPage_Margin.width,n.y-ebook.PageWide.zoomPage_lt.y-ebook.PageWide.zoomPage_Margin.height),r=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale),t=new Size;return t.width=(ebook.PageWide.zoomPage_pos.x+i.x)/r.width,t.height=(ebook.PageWide.zoomPage_pos.y+i.y)/r.height,t};ebook.PageWide.setLargeImagePos=function(){var n=ebook.PageWide.zoomPageMinSize.multir(ebook.PageWide.zoomPage_scale),e=ebook.PageWide.isTopOrLast(),r;if(e==enum_isTopOrLast.other&&(n.width*=2),ebook.PageWide.zoomPage_Margin=new Size(0,0),ebook.PageWide.zoomScreenSize.width>n.width&&(ebook.PageWide.zoomPage_Margin.width=(ebook.PageWide.zoomScreenSize.width-n.width)/2),ebook.PageWide.zoomScreenSize.height>n.height&&(ebook.PageWide.zoomPage_Margin.height=(ebook.PageWide.zoomScreenSize.height-n.height)/2),ebook.PageWide.zoomPage_pos.x<0?ebook.PageWide.zoomPage_pos.x=0:ebook.PageWide.zoomPage_pos.x>n.width-ebook.PageWide.zoomScreenSize.width&&(ebook.PageWide.zoomPage_pos.x=n.width-ebook.PageWide.zoomScreenSize.width),ebook.PageWide.zoomPage_pos.y<0?ebook.PageWide.zoomPage_pos.y=0:ebook.PageWide.zoomPage_pos.y>n.height-ebook.PageWide.zoomScreenSize.height&&(ebook.PageWide.zoomPage_pos.y=n.height-ebook.PageWide.zoomScreenSize.height),ebook.PageWide.zoomPage_pos.x=ebook.PageWide.zoomPage_pos.x>0?ebook.PageWide.zoomPage_pos.x:0,ebook.PageWide.zoomPage_pos.y=ebook.PageWide.zoomPage_pos.y>0?ebook.PageWide.zoomPage_pos.y:0,r=$("#l_canvas"),$("#l_img",r).css({left:MathRound(ebook.PageWide.zoomPage_Margin.width-ebook.PageWide.zoomPage_pos.x)+"px ",top:MathRound(ebook.PageWide.zoomPage_Margin.height-ebook.PageWide.zoomPage_pos.y)+"px"}),e==enum_isTopOrLast.other?($("#l_img",r).css({width:n.width}),$(".l_pageframe .z-page",r).css({width:MathRound(n.width/2),height:n.height}),$("#zoomImg_right,#zoomMImg_right,#zoomSImg_right",r).css({left:MathRound(n.width/2)})):($("#l_img",r).css({width:n.width}),$(".l_pageframe .z-page",r).css({width:n.width,height:n.height}),$("#zoomImg_right,#zoomMImg_right,#zoomSImg_right",r).css({left:n.width})),ebook.PageWide.setZoomMapPos(),ebook.PageWide.set_slice_size(),typeof ebook.BookData.ZoomWideRectCallBack!=_undefined){var i=1e5,o=ebook.PageWide.zoomPage_pageNum,u=!1,f=!1,s={x:-ebook.PageWide.zoomPage_Margin.width+ebook.PageWide.zoomPage_pos.x,y:-ebook.PageWide.zoomPage_Margin.height+ebook.PageWide.zoomPage_pos.y},t={x:(s.x<0?0:s.x)*i/n.width,y:(s.y<0?0:s.y)*i/n.height,w:ebook.PageWide.zoomScreenSize.width*i/n.width,h:ebook.PageWide.zoomScreenSize.height*i/n.height};t.w>i&&(t.w=i);t.h>i&&(t.h=i);t.w+t.x>i&&(t.w=i-t.x);t.h+t.y>i&&(t.h=i-t.y);(e==enum_isTopOrLast.other||e==enum_isTopOrLast.top)&&(u=getPageNum(o));e==enum_isTopOrLast.other?f=getPageNum(o+1):e==enum_isTopOrLast.last&&(ebook.BookData.pageTopDirectionIsLeft&&o--,f=getPageNum(o+1));u==-1&&(u=0);f==-1&&(f=0);u===!1&&f>u&&(u=[f,f=u][0]);ebook.BookData.ZoomWideRectCallBack(u,f,t)}};ebook.PageWide.calcZoomPageSize=function(){ebook.PageWide.l_img_size=new Size(ebook.BookData.pageImgSize_large.width,ebook.BookData.pageImgSize_large.height);ebook.PageWide.zoomScreenSize=new Size($("#l_canvas").width(),$("#l_canvas").outerHeight()-ebook.PageWide.marginBottom);var n=ebook.PageWide.l_img_size.width*2/ebook.PageWide.l_img_size.height,t=ebook.PageWide.zoomScreenSize.width/ebook.PageWide.zoomScreenSize.height;n<=t?(ebook.PageWide.zoomPageMinSize=new Size(ebook.PageWide.zoomScreenSize.height*n/2,ebook.PageWide.zoomScreenSize.height),ebook.PageWide.zoomPage_scale_max=ebook.BookData.pageImgSize_large.height*2/ebook.PageWide.zoomScreenSize.height):(ebook.PageWide.zoomPageMinSize=new Size(ebook.PageWide.zoomScreenSize.width/2,ebook.PageWide.zoomScreenSize.width/n),ebook.PageWide.zoomPage_scale_max=ebook.BookData.pageImgSize_large.width*4/ebook.PageWide.zoomScreenSize.width);ebook.PageWide.zoomPage_scale_max<1&&(ebook.PageWide.l_img_size=ebook.PageWide.zoomPageMinSize.clone(),ebook.PageWide.zoomPage_scale_max=1);ebook.PageWide.zoomPage_lt=new Point(0,0)};ebook.PageWide.setZoomMapPos=function(){var r=ebook.PageWide.zoomScreenSize.width/8,n;r<100&&(r=100);n=new Size(MathRound(r),MathRound(r*ebook.PageWide.zoomPageMinSize.height/ebook.PageWide.zoomPageMinSize.width));$("#zoommap_wind, #zoommap_wind>img").css({width:n.width+"px",height:n.height+"px",zoom:1});var e=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale),u=n.width/e.width,f=new Size(ebook.PageWide.zoomScreenSize.width-ebook.PageWide.zoomPage_Margin.width*2,ebook.PageWide.zoomScreenSize.height-ebook.PageWide.zoomPage_Margin.height*2),t=new Size(MathRound(f.width*u),MathRound(f.height*u));n.width<t.width&&(t.width=n.width);n.height<t.height&&(t.height=n.height);var o=new Size(MathRound(ebook.PageWide.zoomPage_pos.x*u),MathRound(ebook.PageWide.zoomPage_pos.y*u)),s={left:o.width+"px",top:o.height+"px",width:t.width+"px",height:t.height+1+"px"},h=!0,i={};e.height/4>ebook.PageWide.zoomPage_pos.y+f.height/2?(i.bottom=0,i.top="initial"):(i.top=h?0:ebook.PageWide.zoomPage_lt.y,i.bottom="initial");try{$("#zoommap_wind").css(i).hide();$("#zoom_targetgrid").css(s)}catch(c){}};ebook.PageWide.makeLinkMapZoomPage=function(n){var t;ebook.PageWide.removeLinkMapZoomPage();var i=ebook.PageWide.zoomPageMinSize.multi(ebook.PageWide.zoomPage_scale),u=new Size(ebook.BookData.pageImgSize_large.width,ebook.BookData.pageImgSize_large.height),r=ebook.PageWide.isTopOrLast();n<0&&n++;(r==enum_isTopOrLast.other||r==enum_isTopOrLast.top)&&(pagenum=getPageNum(n),t=new Position(0,0),makeLinkMapPage_sub($("#l_canvasimg>div#l_img"),pagenum,t,i));r==enum_isTopOrLast.other&&(pagenum=getPageNum(n+1),t=new Position(i.width,0),makeLinkMapPage_sub($("#l_canvasimg>div#l_img"),pagenum,t,i));r==enum_isTopOrLast.last&&(pagenum=getPageNum(n),t=new Position(0,0),makeLinkMapPage_sub($("#l_canvasimg>div#l_img"),pagenum,t,i))};ebook.PageWide.removeLinkMapZoomPage=function(){ebook.Linkmap.makeLinkMapPage_bparam=!1;$("#l_canvasimg>div#l_img a[data-rel=_linkmap_base]").remove()};ebook.PageWide.makeZoomSlide=function(){var n={handleH:0,pos:new Point(0,0),lt:new Point(0,0),size:new Size(0,0),spos:new Point(0,0),npos:new Point(0,0),viewposx:0,binded:!1,vitemCount:0},c=function(){var t=$("#zoom_slider .slider_wrap"),i=parseInt(t.width()),r=parseInt(t.height());n.handleH=$("#zoom_slider .slider_handle").outerHeight();n.lt=t.offset();n.size=new Size(i,r-n.handleH)},s=function(n){per=(n-ebook.PageWide.zoomPage_scale_min)*100/(ebook.PageWide.zoomPage_scale_max-ebook.PageWide.zoomPage_scale_min);per>100&&(per=100);per<0&&(per=0);u(per)},u=function(t){t>100&&(t=100);t<0&&(t=0);n.per=t;var i=n.size.height*(100-t)/100;$("#zoom_slider .slider_handle").css("top",i+"px");$("#zoom_slider .slider_range").css("height",i+"px")},f=function(){return per=(ebook.PageWide.zoomPage_scale-ebook.PageWide.zoomPage_scale_min)*100/(ebook.PageWide.zoomPage_scale_max-ebook.PageWide.zoomPage_scale_min),per>100&&(per=100),per<0&&(per=0),per},h=function(t){var i,r;return n.lt=$("#zoom_slider .slider_wrap").offset(),i=t.y-n.lt.top-n.handleH/2,i<0&&(i=0),i>n.size.height&&(i=n.size.height),r=Math.round(i*1e4/n.size.height)/100,100-r},e=function(n){u(n);ebook.PageWide.zoomPage_scale=ebook.PageWide.zoomPage_scale_min+(ebook.PageWide.zoomPage_scale_max-ebook.PageWide.zoomPage_scale_min)*n/100},l=function(n){var t=h(n);e(t)},i=!1,t=function(n,t){var i=".dragslider",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},v=!1,a=0,o=function(n){var i=ebook.PageWide.getZoomPageAbsolutePos(),t,r,u;ebook.PageWide.zoomPage_scale==1&&(i=new Size(.5,.5));t={};t.st_per=f();t.per_dist=n-t.st_per;t.per_dir=n>t.st_per?1:-1;t.to_per=n;t.absPos=i;t.idx=a++;ebook.PageWide.removeLinkMapZoomPage();r=function(n){var t=n.st_per+n.per_dist*n.value;e(t);ebook.PageWide.setZoomPageAbsolutePos(n.absPos);ebook.PageWide.setLargeImagePos()};u=function(n){var t=n.st_per+n.per_dist*n.value;e(t);ebook.PageWide.setZoomPageAbsolutePos(n.absPos);ebook.PageWide.setLargeImagePos();ebook.PageWide.makeLinkMapZoomPage(ebook.PageWide.zoomPage_pageNum)};ebook.easing.setEasing(t,"value",6,0,1,r,u,"easeOutQuad")},r;return $("#zoom_slider").get(0)||($('<div id="zoom_slider" ><div class="slider_wrap"><span class="slider_range"><\/span><span class="slider_handle"><\/span><\/div><\/div>').appendTo(ebook.PageWide.zoomSliderInsertTargetTag),$(ebook.PageWide.zoomSliderInsertTargetTag).addClass("cf"),ebook.PageTool.setMiddleCtrlPanel(),$("#l_canvas,#l_canvas .close").setDisableSelection(),$("#zoom_slider .slider_wrap").setDisableSelection().clicks({start_func:function(n,t){return t.mousePos=getMouseClientPosEvent(n),!0},end_func:function(n,t){var r=ebook.PageWide.getZoomPageAbsolutePos(),i;ebook.PageWide.zoomPage_scale==1&&(r=new Size(.5,.5));i=h(t.mousePos);o(i)}}),$("#icon_set_zoom .zoomin_icon").setDisableSelection().clicks(function(n){var i=ebook.PageWide.getZoomPageAbsolutePos(),t;if(ebook.PageWide.zoomPage_scale==1)return!1;t=f();t-=25;t<0&&(t=0);o(t)}),$("#icon_set_zoom .zoomout_icon").setDisableSelection().clicks(function(n){var i=ebook.PageWide.getZoomPageAbsolutePos(),t;if(ebook.PageWide.zoomPage_scale==1&&(i=new Size(.5,.5)),t=f(),t>=100)return!1;t+=25;t>100&&(t=100);o(t)}),r=ebook.Compatibility.getMoveTarget($("#stage")),$("#zoom_slider .slider_handle").setDisableSelection().off(t(leb.e.ts,leb.e.md)).bind(t(leb.e.ts,leb.e.md),function(u){var o=function(){$(r).off(t(leb.e.tm,leb.e.mm));$(r).off(t(leb.e.te,leb.e.mu))},s=u.type===leb.e.ts?u.originalEvent.touches[0]:u,f,e;if(u.type===leb.e.ts&&u.originalEvent.touches.length>1){i=!1;return}return i=!0,f=getMousePosEvent(s),n.spos=f.clone(),n.npos=f.clone(),e=ebook.PageWide.getZoomPageAbsolutePos(),ebook.PageWide.zoomPage_scale==1&&(e=new Size(.5,.5)),ebook.PageWide.removeLinkMapZoomPage(),$(r).one(t(leb.e.te,leb.e.mu),function(n){if(i)return o(),n.preventDefault(),ebook.PageWide.makeLinkMapZoomPage(ebook.PageWide.zoomPage_pageNum),i=!1,!1}).bind(t(leb.e.tm,leb.e.mm),function(t){var u=t.type===leb.e.tm?t.originalEvent.touches[0]:t,r;if(t.type===leb.e.tm&&t.originalEvent.touches.length>1){i=!1;o();return}r=getMousePosEvent(u);n.npos=r.clone();l(r);ebook.PageWide.setZoomPageAbsolutePos(e);ebook.PageWide.setLargeImagePos();t.preventDefault()}),u.preventDefault(),!1})),ZoomSlide.setSlideHandlePosByPer=u,ZoomSlide.setSlideHandlePosByScale=s,c(),s(ebook.PageWide.zoomPage_scale),this};ebook.SingleView={};ebook.SingleView.Zoom={};ebook.SingleView.ZoomSlide={};ebook.SingleView.zoomPage_pos=new Point(0,0);ebook.SingleView.zoomPage_lt=new Point(0,0);ebook.SingleView.zoomPage_Margin=new Point(0,0);ebook.SingleView.zoomPage_scale=1;ebook.SingleView.zoomPage_scale_min=1;ebook.SingleView.zoomPage_scale_max=2;ebook.SingleView.zoomPage_mouse_pos=!1;ebook.SingleView.zoomScreenSize=new Size;ebook.SingleView.zoomPageMinSize=new Size;ebook.SingleView.l_img_size;ebook.SingleView.zoomPage_mouseEventObj=!1;ebook.SingleView.zoomPage_pageNum=!1;ebook.SingleView.zoomPage_initPos=!1;ebook.SingleView.ZoomPageMouseMoved=0;ebook.SingleView.zoomDragTarget="#l_canvas";ebook.SingleView.zoomSliderInsertTargetTag="#ctrl_panel .zoom_gage";ebook.SingleView.marginTop=20;ebook.SingleView.marginBottom=20;ebook.SingleView.marginLeft=20;ebook.SingleView.marginRight=20;ebook.SingleView.initZoomView=function(){$("#l_canvasbase").empty();ebook.SingleView.zoomDragTarget="#l_canvasbase";ebook.SingleView.zoomPage_scale=1};ebook.SingleView.set_slice_size=function(){var u=ebook.SingleView.zoomPageMinSize.multir(ebook.SingleView.zoomPage_scale),t,i;if(isEnableSlicePageM()){var r=ebook.BookData.pageImgCell.medium,n=r.cellSize,f=r.page_size.width,e=r.page_size.height,o=0;for(t=0;t<r.slice.y;t++){var c=n+t*n<=e?n:e%n,s=MathRound(u.height*n*t/e),l=MathRound(u.height*(n*t+c)/e),a=l-s;for(i=0;i<r.slice.x;i++){var v=n+i*n<=f?n:f%n,h=MathRound(u.width*n*i/f),y=MathRound(u.width*(n*i+v)/f),p=y-h;$(".mcell-"+o).css({left:h+"px",top:s+"px",width:p+"px",height:a+"px",position:"absolute"});o++}}}if(isEnableSlicePageL()){var r=ebook.BookData.pageImgCell.large,n=r.cellSize,f=r.page_size.width,e=r.page_size.height,o=0;for(t=0;t<r.slice.y;t++){var c=n+t*n<=e?n:e%n,s=MathRound(u.height*n*t/e),l=MathRound(u.height*(n*t+c)/e),a=l-s;for(i=0;i<r.slice.x;i++){var v=n+i*n<=f?n:f%n,h=MathRound(u.width*n*i/f),y=MathRound(u.width*(n*i+v)/f),p=y-h;$(".lcell-"+o).css({left:h+"px",top:s+"px",width:p+"px",height:a+"px",position:"absolute"});o++}}}};ebook.SingleView.set_slice_page=function(n,t){var i;if(n=getPageNum(ebook.SingleView.zoomPage_pageNum),i=ebook.SingleView.isTopOrLast(),t&&n--,ebook.BookData.pageTopDirectionIsLeft?n++:i==enum_isTopOrLast.other&&(t=!t),n<0&&(n=0),isEnableSlicePageM()){var r=$(t?"#zoomMImg_left":"#zoomMImg_right"),u=ebook.BookData.pageImgCell.medium,f=ebook.BookData.GetPageImgPath(n),e=function(t){t.page==n&&$(".mcell-"+t.num,r).attr("src",t.src).css({"background-color":"rgba(255,255,255,0.3)"})};ebook.PageFlipper.Slice.tools.makeSliceFiles(n,f,u,function(n){n.func=e;n.key="m"+n.key;ebook.PageFlipper.Slice.pagePush(n)})}if(isEnableSlicePageL()){var r=$(t?"#zoomImg_left":"#zoomImg_right"),u=ebook.BookData.pageImgCell.large,f=ebook.BookData.GetPageImgLargePath(n),o=function(t){t.page==n&&$(".lcell-"+t.num,r).attr("src",t.src)};ebook.PageFlipper.Slice.tools.makeSliceFiles(n,f,u,function(n){n.func=o;n.key="l"+n.key;ebook.PageFlipper.Slice.pagePush(n)})}};ebook.SingleView.init_slice_tag=function(){var f='<div id="l_SImgwrap" class="l_pageframe"><img id="zoomSImg_left" class="z-page" /><\/div>',r='<div id="l_LImgwrap" class="l_pageframe"><img id="zoomImg_left" class="z-page" /><\/div>',u='<div id="l_MImgwrap" class="l_pageframe"><img id="zoomMImg_left" class="z-page" /><\/div>',n,i,t;if(!isEnableSlicePage())return r+u;if(isEnableSlicePageM()){for(n="",i=ebook.BookData.pageImgCell.medium,t=0;t<i.slice.count;t++)n=n+'<img class="mcell-'+t+'">';u='<div id="l_MImgwrap" class="l_pageframe">\t<div id="zoomMImg_left" class="z-page" >'+n+"<\/div><\/div>"}if(isEnableSlicePageL()){for(n="",i=ebook.BookData.pageImgCell.large,t=0;t<i.slice.count;t++)n=n+'<img class="lcell-'+t+'">';r='<div id="l_LImgwrap" class="l_pageframe">\t<div id="zoomImg_left" class="z-page" >'+n+"<\/div><\/div>"}return f+r+u};ebook.SingleView.changeZoomView=function(n){var t,l,a,v,i,u,o,y,e,f,r;$("#stage").children().hide();t=ebook.PageWide.zoomPage_pageNum||0;l=-1;ebook.SingleView.zoomPage_mouseEventObj=!1;ebook.SingleView.zoomPage_mouseEventObj!==!1&&(a=ebook.SingleView.zoomPage_mouseEventObj,e=new Point(a.pageX-ebook.PageFlipper.canvas_offset.left,a.pageY-ebook.PageFlipper.canvas_offset.top),l=ebook.PageFlipper.n_pageHit(e),l==2&&t++);t<0&&(t=0);t>=ebook.PageFlipper.pageCount&&(t=ebook.PageFlipper.pageCount-1);v=t;ebook.PageFlipper.narrowCurrentPageNum=v;i=$("#l_canvas");$("#l_canvasimg").get(0)?($(ebook.SingleView.zoomSliderInsertTargetTag).show(),ebook.PageTool.setMiddleCtrlPanel()):(u=ebook.SingleView.init_slice_tag(),u=u+'<div id="l_AImgwrap" class="l_pageframe"><img id="zoomAImg_left" class="z-page" style="display:none;"/><\/div>',u=u+'<div id="l_page_wrap" class="l_pageframe"><span class="z_page_prev_area" ><\/span><span class="z_page_next_area" ><\/span><\/div>',$('<div id="l_canvasimg"><div id="l_img">'+u+'<\/div><\/div><div id="z_prev_btn" class="zoom_prev_next" title=""><\/div><div id="z_next_btn" class="zoom_prev_next" title=""><\/div><div class="z_close"><img src="'+ebook.data.sp_icon_path+'" width="50" /><\/div>').appendTo("#l_canvasbase"),$("#l_canvasimg").css({width:"100%"}),$("#l_canvasbase").css({position:"relative",width:"100%",margin:"0px auto"}),$(".l_pageframe",i).css({position:"absolute",clear:"both",top:0}),$("#l_img .z-page",i).css({display:"block",top:0,position:"absolute"}),$(".l_pageframe .z-page",i).css({width:MathRound(ebook.BookData.pageImgSize_large.width),height:MathRound(ebook.BookData.pageImgSize_large.height)}),$("#l_canvasbase #z_prev_btn",i).hide().clicks({start_func:function(n){n.preventDefault();n.stopPropagation()},end_func:function(){return pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum-1),!1}}),$("#l_canvasbase #z_next_btn",i).hide().clicks({start_func:function(n){n.preventDefault();n.stopPropagation()},end_func:function(){return pageView_jumpPage(ebook.PageFlipper.narrowCurrentPageNum+1),!1}}),ebook.SingleView.bindZoomPageDragAction(ebook.SingleView.zoomDragTarget),ebook.SingleView.pinchFunc=bindPinchTouchAction(ebook.SingleView.zoomDragTarget,function(n,t){var i=n.savePage_scale*n.scale;return i>ebook.SingleView.zoomPage_scale_max&&(i=ebook.SingleView.zoomPage_scale_max),i<ebook.SingleView.zoomPage_scale_min&&(i=ebook.SingleView.zoomPage_scale_min),ebook.SingleView.zoomPage_scale=i,ebook.SingleView.ZoomSlide.setSlideHandlePosByScale(i),ebook.SingleView.calcZoomPageSize(),ebook.SingleView.setZoomPageAbsolutePosCenter(n.savePage_absPos,n.saveScreen_absPos),ebook.SingleView.setLargeImagePos(),!0},function(n,t){ebook.SingleView.makeLinkMapZoomPage(ebook.SingleView.zoomPage_pageNum);n.savePage_scale==1&&n.scale<1},function(n,t){n.savePage_absPos=ebook.SingleView.getZoomPageAbsolutePosByPos(n.firstPoint);n.saveScreen_absPos=ebook.SingleView.getZoomScreenAbsolutePosByPos(n.firstPoint);n.savePage_scale=ebook.SingleView.zoomPage_scale;ebook.SingleView.removeLinkMapZoomPage()}),$(ebook.SingleView.zoomDragTarget).off(leb.e.mw).bind(leb.e.mw,ebook.SingleView.EVENT_wheel_move),ebook.SingleView.makeZoomSlide());$("#icon_set_zoom .icon_close").hide();$("#l_canvasbase .z_close").hide();$("#l_canvasbase").hide();$("#l_canvas,#zoommap_wind").show();$("#pageslider").show();ebook.PageTool.updateMenuset();ebook.Compatibility.isIE6&&$("#page").css("overflow","hidden");o=ebook.SingleView.isTopOrLast();$("#l_canvasbase #z_prev_btn",i).toggle(o!=enum_isTopOrLast.top);$("#l_canvasbase #z_next_btn",i).toggle(o!=enum_isTopOrLast.last);ebook.SingleView.zoomPage_mouseEventObj?(y=getMousePosEvent(ebook.SingleView.zoomPage_mouseEventObj),e=cnv_windowToLocal(y),ebook.SingleView.zoomPage_initPos=o==enum_isTopOrLast.other?ebook.PageFlipper.getPageMouseRelativeWidePos(e):ebook.PageFlipper.getPageMouseRelativePos(e)):ebook.SingleView.zoomPage_initPos=new Size(.5,.5);$("#l_LImgwrap").css({"z-index":9});$("#l_MImgwrap").css({"z-index":8});$("#l_img img").attr("src",ebook.data.spacegif_url);f=!1;r=!1;r=t;var s=$("#l_LImgwrap"),h=$("#l_MImgwrap"),c=$("#l_SImgwrap");f===!1?($("#zoomSImg_right",c).attr("src","").hide(),$("#zoomMImg_right",h).attr("src","").hide(),$("#zoomImg_right",s).attr("src","").hide()):($("#zoomSImg_right",c).attr("src",ebook.BookData.pageImgPathList_thumb[f]).show(),$("#zoomMImg_right",h).attr("src",ebook.BookData.pageImgPathList[f]).show(),$("#zoomImg_right",s).attr("src",ebook.BookData.pageImgPathList_large[f]).show(),ebook.SingleView.set_slice_page(f,!1));r===!1?($("#zoomSImg_left",c).attr("src","").hide(),$("#zoomMImg_left",h).attr("src","").hide(),$("#zoomImg_left",s).attr("src","").hide()):($("#zoomSImg_left",c).attr("src",ebook.BookData.pageImgPathList_thumb[r]).show(),$("#zoomMImg_left",h).attr("src",ebook.BookData.pageImgPathList[r]).show(),$("#zoomImg_left",s).attr("src",ebook.BookData.pageImgPathList_large[r]).show(),ebook.SingleView.set_slice_page(r,!0));ebook.SingleView.setupZoomPageSize();ebook.SingleView.setZoomPageAbsolutePos(ebook.SingleView.zoomPage_initPos);ebook.SingleView.setLargeImagePos();$("#l_canvasbase").show(10);ebook.SingleView.zoomPage_mouseEventObj?ebook.SingleView.zoomPage_mouseEventObj.originalEvent&&ebook.SingleView.zoomPage_mouseEventObj.originalEvent.touches&&ebook.SingleView.zoomPage_mouseEventObj.originalEvent.touches.length>1?ebook.SingleView.pinchFunc(ebook.SingleView.zoomPage_mouseEventObj,"entry"):ebook.SingleView.EVENT_zoomPage_mousedown(ebook.SingleView.zoomPage_mouseEventObj,!0):ebook.SingleView.move_zoomPageMove(new Point(0,0));ebook.SingleView.zoomPage_mouseEventObj=!1};ebook.SingleView.setZoomPageLeft=function(){if(!ebook.BookData.use_largeImage)return!1;ebook.SingleView.zoomPage_mouseEventObj=!1;ebook.PageFlipper.setZoomMode();ebook.PageFlipper.changePageMode(0)};ebook.SingleView.setZoomPageRight=function(){if(!ebook.BookData.use_largeImage)return!1;ebook.SingleView.zoomPage_mouseEventObj=!1;ebook.PageFlipper.setZoomMode();ebook.PageFlipper.changePageMode(1)};ebook.SingleView.EVENT_wheel_move=function(n,t){typeof n.pageX==_undefined&&(n=n.originalEvent);var s=t>0?"Up":"Down",h=Math.abs(t),i=getMousePosEvent(n),u=ebook.SingleView.getZoomScreenAbsolutePosByPos(i),f=ebook.SingleView.getZoomPageAbsolutePosByPos(i),e=ebook.SingleView.zoomPage_scale,o=(ebook.SingleView.zoomPage_scale_max-ebook.SingleView.zoomPage_scale_min)/10,r=ebook.SingleView.setZoomPageScale(ebook.SingleView.zoomPage_scale+o*t/2);if(e!=r)return ebook.SingleView.ZoomSlide.setSlideHandlePosByScale(r),ebook.SingleView.calcZoomPageSize(),ebook.SingleView.setZoomPageAbsolutePosCenter(f,u),ebook.SingleView.setLargeImagePos(),ebook.SingleView.makeLinkMapZoomPage(ebook.SingleView.zoomPage_pageNum),!1};enum_isTopOrLast={top:1,last:2,other:3};ebook.SingleView.isTopOrLast=function(){return ebook.SingleView.zoomPage_pageNum<=0?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.top:enum_isTopOrLast.last:ebook.SingleView.zoomPage_pageNum>=ebook.PageFlipper.pageCount-1?ebook.BookData.pageTopDirectionIsLeft?enum_isTopOrLast.last:enum_isTopOrLast.top:enum_isTopOrLast.other};ebook.SingleView.setupZoomPageSize=function(){ebook.SingleView.calcZoomPageSize();var n=$("#l_canvas").innerHeight(),t=$("#l_canvas").width();$("#l_canvasimg, #l_canvasbase, #l_canvasbase .zoom_prev_next").css({height:n+"px"});$("#zoommap_wind > img").attr("src",ebook.BookData.pageImgPathList_thumb[ebook.SingleView.zoomPage_pageNum]).hide();ebook.SingleView.setZoomMapPos();ebook.SingleView.makeLinkMapZoomPage(ebook.SingleView.zoomPage_pageNum)};ebook.SingleView.EVENT_zoomPage_mousedown=function(){};ebook.SingleView.move_zoomPageMove=function(){};ebook.SingleView.bindZoomPageDragAction=function(n){var r=ebook.Compatibility.isIE?n:window,t=function(n,t){var i=".EVENT_zoomPage",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},i=function(){$(r).off(t(leb.e.tm,leb.e.mm));$(r).off(t(leb.e.te,leb.e.mu))},u=function(n,u){var f,e;if(!ebook.PageFlipper.isWideMode()){if(f=n.type===leb.e.ts?n.originalEvent.touches[0]:n,n.type===leb.e.ts&&n.originalEvent.touches.length>1)return i(),!0;if(typeof u=="undefined"&&(u=!1),e=$("#l_canvas").css("display"),e!="none"){if(!u&&isRightClick(f))return!1;ebook.SingleView.zoomPage_mouse_pos=!1;ebook.SingleView.ZoomPageMouseMoved=0;$(r).bind(t(leb.e.tm,leb.e.mm),function(n){return n.type===leb.e.ts&&n.originalEvent.touches.length>1?(i(),!0):(lastMousePos=getMousePosEvent(n),ebook.SingleView.move_zoomPageMove(lastMousePos),ebook.SingleView.ZoomPageMouseMoved++,!1)}).one(t(leb.e.te,leb.e.mu),function(n){return i(),!0});return!0}}},f=function(n){ebook.SingleView.zoomPage_mouse_pos==!1&&(ebook.SingleView.zoomPage_mouse_pos=n.clone());ebook.SingleView.zoomPage_pos.x+=ebook.SingleView.zoomPage_mouse_pos.x-n.x;ebook.SingleView.zoomPage_mouse_pos.x=n.x;ebook.SingleView.zoomPage_pos.y+=ebook.SingleView.zoomPage_mouse_pos.y-n.y;ebook.SingleView.zoomPage_mouse_pos.y=n.y;ebook.SingleView.setLargeImagePos()};ebook.SingleView.EVENT_zoomPage_mousedown=u;ebook.SingleView.move_zoomPageMove=f;i();$(n).off(t(leb.e.ts,leb.e.md));$(n).bind(t(leb.e.ts,leb.e.md),u)};ebook.SingleView.setZoomPageAbsolutePos=function(n){var t=ebook.SingleView.zoomPageMinSize.multi(ebook.SingleView.zoomPage_scale),i=ebook.SingleView.getScreenAjustPageSize(),r=ebook.SingleView.isTopOrLast();ebook.SingleView.zoomPage_pos.x=t.width*(r==enum_isTopOrLast.other?1:1)*n.width-i.width/2;ebook.SingleView.zoomPage_pos.y=t.height*n.height-i.height/2};ebook.SingleView.setZoomPageAbsolutePosCenter=function(n,t){var i=ebook.SingleView.zoomScreenSize.clone(),r=ebook.SingleView.zoomPageMinSize.multi(ebook.SingleView.zoomPage_scale);ebook.SingleView.zoomPage_pos.x=r.width*n.width-i.width*t.width;ebook.SingleView.zoomPage_pos.y=r.height*n.height-i.height*t.height};ebook.SingleView.getScreenAjustPageSize=function(){var n=ebook.SingleView.getZoomPageSize();return ebook.SingleView.zoomScreenSize.width<n.width&&(n.width=ebook.SingleView.zoomScreenSize.width),ebook.SingleView.zoomScreenSize.height<n.height&&(n.height=ebook.SingleView.zoomScreenSize.height),n};ebook.SingleView.getZoomPageSize=function(){var n=ebook.SingleView.zoomPageMinSize.multi(ebook.SingleView.zoomPage_scale).clone(),t=ebook.SingleView.isTopOrLast();return n.width*=t==enum_isTopOrLast.other?1:1,n};ebook.SingleView.getZoomPageAbsolutePos=function(){var t=ebook.SingleView.getZoomPageSize(),i=ebook.SingleView.getScreenAjustPageSize(),n=new Size;return n.width=(ebook.SingleView.zoomPage_pos.x+i.width/2)/t.width,n.height=(ebook.SingleView.zoomPage_pos.y+i.height/2)/t.height,n};ebook.SingleView.setZoomPageScale=function(n){return n>ebook.SingleView.zoomPage_scale_max&&(n=ebook.SingleView.zoomPage_scale_max),n<ebook.SingleView.zoomPage_scale_min&&(n=ebook.SingleView.zoomPage_scale_min),ebook.SingleView.zoomPage_scale=n,n};ebook.SingleView.getZoomScreenAbsolutePosByPos=function(n){var i=new Point(n.x-ebook.SingleView.zoomPage_lt.x,n.y-ebook.SingleView.zoomPage_lt.y),r=ebook.SingleView.zoomScreenSize.clone(),t=new Size;return t.width=i.x/r.width,t.height=i.y/r.height,t};ebook.SingleView.getZoomPageAbsolutePosByPos=function(n){var i=new Point(n.x-ebook.SingleView.zoomPage_lt.x-ebook.SingleView.zoomPage_Margin.width,n.y-ebook.SingleView.zoomPage_lt.y-ebook.SingleView.zoomPage_Margin.height),r=ebook.SingleView.zoomPageMinSize.multi(ebook.SingleView.zoomPage_scale),t=new Size;return t.width=(ebook.SingleView.zoomPage_pos.x+i.x)/r.width,t.height=(ebook.SingleView.zoomPage_pos.y+i.y)/r.height,t};ebook.SingleView.setLargeImagePos=function(){var n=ebook.SingleView.zoomPageMinSize.multir(ebook.SingleView.zoomPage_scale),i=ebook.SingleView.isTopOrLast(),t;i==enum_isTopOrLast.other;ebook.SingleView.zoomPage_Margin=new Size(0,0);ebook.SingleView.zoomScreenSize.width>n.width&&(ebook.SingleView.zoomPage_Margin.width=(ebook.SingleView.zoomScreenSize.width-n.width)/2);ebook.SingleView.zoomScreenSize.height>n.height&&(ebook.SingleView.zoomPage_Margin.height=(ebook.SingleView.zoomScreenSize.height-n.height)/2);ebook.SingleView.zoomPage_pos.x<0?ebook.SingleView.zoomPage_pos.x=0:ebook.SingleView.zoomPage_pos.x>n.width-ebook.SingleView.zoomScreenSize.width&&(ebook.SingleView.zoomPage_pos.x=n.width-ebook.SingleView.zoomScreenSize.width);ebook.SingleView.zoomPage_pos.y<0?ebook.SingleView.zoomPage_pos.y=0:ebook.SingleView.zoomPage_pos.y>n.height-ebook.SingleView.zoomScreenSize.height&&(ebook.SingleView.zoomPage_pos.y=n.height-ebook.SingleView.zoomScreenSize.height);ebook.SingleView.zoomPage_pos.x=ebook.SingleView.zoomPage_pos.x>0?ebook.SingleView.zoomPage_pos.x:0;ebook.SingleView.zoomPage_pos.y=ebook.SingleView.zoomPage_pos.y>0?ebook.SingleView.zoomPage_pos.y:0;t=$("#l_canvas");$("#l_img",t).css({left:MathRound(ebook.SingleView.zoomPage_lt.x+ebook.SingleView.zoomPage_Margin.width-ebook.SingleView.zoomPage_pos.x)+"px ",top:MathRound(ebook.SingleView.zoomPage_lt.y+ebook.SingleView.zoomPage_Margin.height-ebook.SingleView.zoomPage_pos.y)+"px"});0&&i==enum_isTopOrLast.other?($("#l_img",t).css({width:n.width}),$(".l_pageframe .z-page",t).css({width:MathRound(n.width/2),height:n.height}),$("#zoomImg_right,#zoomMImg_right,#zoomSImg_right",t).css({left:MathRound(n.width/2)})):($("#l_img",t).css({width:n.width}),$(".l_pageframe .z-page",t).css({width:n.width,height:n.height}),$("#zoomImg_right,#zoomMImg_right,#zoomSImg_right",t).css({left:n.width}));ebook.SingleView.setZoomMapPos();ebook.SingleView.set_slice_size()};ebook.SingleView.calcZoomPageSize=function(){var i=ebook.SingleView.marginTop+ebook.SingleView.marginBottom,r=ebook.SingleView.marginLeft+ebook.SingleView.marginRight,n,t;ebook.SingleView.l_img_size=new Size(ebook.BookData.pageImgSize_large.width,ebook.BookData.pageImgSize_large.height);ebook.SingleView.zoomScreenSize=new Size($("#l_canvas").width()-r,$("#l_canvas").outerHeight()-ebook.SingleView.marginBottom-i);n=ebook.SingleView.l_img_size.width/ebook.SingleView.l_img_size.height;t=ebook.SingleView.zoomScreenSize.width/ebook.SingleView.zoomScreenSize.height;n<=t?(ebook.SingleView.zoomPageMinSize=new Size(ebook.SingleView.zoomScreenSize.height*n,ebook.SingleView.zoomScreenSize.height),ebook.SingleView.zoomPage_scale_max=ebook.BookData.pageImgSize_large.height*2/ebook.SingleView.zoomScreenSize.height):(ebook.SingleView.zoomPageMinSize=new Size(ebook.SingleView.zoomScreenSize.width,ebook.SingleView.zoomScreenSize.width/n),ebook.SingleView.zoomPage_scale_max=ebook.BookData.pageImgSize_large.width*2/ebook.SingleView.zoomScreenSize.width);ebook.SingleView.zoomPage_scale_max<1&&(ebook.SingleView.l_img_size=ebook.SingleView.zoomPageMinSize.clone(),ebook.SingleView.zoomPage_scale_max=1);ebook.SingleView.zoomPage_lt=new Point(ebook.SingleView.marginTop,ebook.SingleView.marginLeft)};ebook.SingleView.setZoomMapPos=function(){return};ebook.SingleView.makeLinkMapZoomPage=function(n){var t;ebook.SingleView.removeLinkMapZoomPage();var r=ebook.SingleView.zoomPageMinSize.multi(ebook.SingleView.zoomPage_scale),u=new Size(ebook.BookData.pageImgSize_large.width,ebook.BookData.pageImgSize_large.height),i=ebook.SingleView.isTopOrLast();n<0&&n++;(i==enum_isTopOrLast.other||i==enum_isTopOrLast.top)&&(pagenum=getPageNum(n),t=new Position(0,0),makeLinkMapPage_sub($("#l_canvasimg>div#l_img"),pagenum,t,r));i==enum_isTopOrLast.last&&(ebook.BookData.pageTopDirectionIsLeft&&n--,pagenum=getPageNum(n+1),t=new Position(0,0),makeLinkMapPage_sub($("#l_canvasimg>div#l_img"),pagenum,t,r))};ebook.SingleView.removeLinkMapZoomPage=function(){ebook.Linkmap.makeLinkMapPage_bparam=!1;$("#l_canvasimg>div#l_img a[data-rel=_linkmap_base]").remove()};ebook.SingleView.makeZoomSlide=function(){var n={handleH:0,pos:new Point(0,0),lt:new Point(0,0),size:new Size(0,0),spos:new Point(0,0),npos:new Point(0,0),viewposx:0,binded:!1,vitemCount:0},c=function(){var t=$("#zoom_slider .slider_wrap"),i=parseInt(t.width()),r=parseInt(t.height());n.handleH=$("#zoom_slider .slider_handle").outerHeight();n.lt=t.offset();n.size=new Size(i,r-n.handleH)},s=function(n){per=(n-ebook.SingleView.zoomPage_scale_min)*100/(ebook.SingleView.zoomPage_scale_max-ebook.SingleView.zoomPage_scale_min);per>100&&(per=100);per<0&&(per=0);u(per)},u=function(t){t>100&&(t=100);t<0&&(t=0);n.per=t;var i=n.size.height*(100-t)/100;$("#zoom_slider .slider_handle").css("top",i+"px");$("#zoom_slider .slider_range").css("height",i+"px")},f=function(){return per=(ebook.SingleView.zoomPage_scale-ebook.SingleView.zoomPage_scale_min)*100/(ebook.SingleView.zoomPage_scale_max-ebook.SingleView.zoomPage_scale_min),per>100&&(per=100),per<0&&(per=0),per},h=function(t){var i,r;return n.lt=$("#zoom_slider .slider_wrap").offset(),i=t.y-n.lt.top-n.handleH/2,i<0&&(i=0),i>n.size.height&&(i=n.size.height),r=Math.round(i*1e4/n.size.height)/100,100-r},e=function(n){u(n);ebook.SingleView.zoomPage_scale=ebook.SingleView.zoomPage_scale_min+(ebook.SingleView.zoomPage_scale_max-ebook.SingleView.zoomPage_scale_min)*n/100},l=function(n){var t=h(n);e(t)},i=!1,t=function(n,t){var i=".dragslider",r=ebook.Compatibility.isTouchDevice;return(r?n:t)+i},v=!1,a=0,o=function(n){var i=ebook.SingleView.getZoomPageAbsolutePos(),t,r,u;ebook.SingleView.zoomPage_scale==1&&(i=new Size(.5,.5));t={};t.st_per=f();t.per_dist=n-t.st_per;t.per_dir=n>t.st_per?1:-1;t.to_per=n;t.absPos=i;t.idx=a++;ebook.SingleView.removeLinkMapZoomPage();r=function(n){var t=n.st_per+n.per_dist*n.value;e(t);ebook.SingleView.setZoomPageAbsolutePos(n.absPos);ebook.SingleView.setLargeImagePos()};u=function(n){var t=n.st_per+n.per_dist*n.value;e(t);ebook.SingleView.setZoomPageAbsolutePos(n.absPos);ebook.SingleView.setLargeImagePos();ebook.SingleView.makeLinkMapZoomPage(ebook.SingleView.zoomPage_pageNum)};ebook.easing.setEasing(t,"value",6,0,1,r,u,"easeOutQuad")},r;return $("#zoom_slider").get(0)||($('<div id="zoom_slider" ><div class="slider_wrap"><span class="slider_range"><\/span><span class="slider_handle"><\/span><\/div><\/div>').appendTo(ebook.SingleView.zoomSliderInsertTargetTag),$(ebook.SingleView.zoomSliderInsertTargetTag).addClass("cf"),ebook.PageTool.setMiddleCtrlPanel(),$("#l_canvas,#l_canvas .close").setDisableSelection(),$("#zoom_slider .slider_wrap").setDisableSelection().clicks({start_func:function(n,t){return t.mousePos=getMouseClientPosEvent(n),!0},end_func:function(n,t){var r=ebook.SingleView.getZoomPageAbsolutePos(),i;ebook.SingleView.zoomPage_scale==1&&(r=new Size(.5,.5));i=h(t.mousePos);o(i)}}),$("#icon_set_zoom .zoomin_icon").setDisableSelection().clicks(function(n){var i=ebook.SingleView.getZoomPageAbsolutePos(),t;if(ebook.SingleView.zoomPage_scale==1)return!1;t=f();t-=25;t<0&&(t=0);o(t)}),$("#icon_set_zoom .zoomout_icon").setDisableSelection().clicks(function(n){var i=ebook.SingleView.getZoomPageAbsolutePos(),t;if(ebook.SingleView.zoomPage_scale==1&&(i=new Size(.5,.5)),t=f(),t>=100)return!1;t+=25;t>100&&(t=100);o(t)}),r=ebook.Compatibility.getMoveTarget($("#stage")),$("#zoom_slider .slider_handle").setDisableSelection().off(t(leb.e.ts,leb.e.md)).bind(t(leb.e.ts,leb.e.md),function(u){var o=function(){$(r).off(t(leb.e.tm,leb.e.mm));$(r).off(t(leb.e.te,leb.e.mu))},s=u.type===leb.e.ts?u.originalEvent.touches[0]:u,f,e;if(u.type===leb.e.ts&&u.originalEvent.touches.length>1){i=!1;return}return i=!0,f=getMousePosEvent(s),n.spos=f.clone(),n.npos=f.clone(),e=ebook.SingleView.getZoomPageAbsolutePos(),ebook.SingleView.zoomPage_scale==1&&(e=new Size(.5,.5)),ebook.SingleView.removeLinkMapZoomPage(),$(r).one(t(leb.e.te,leb.e.mu),function(n){if(i)return o(),n.preventDefault(),ebook.SingleView.makeLinkMapZoomPage(ebook.SingleView.zoomPage_pageNum),i=!1,!1}).bind(t(leb.e.tm,leb.e.mm),function(t){var u=t.type===leb.e.tm?t.originalEvent.touches[0]:t,r;if(t.type===leb.e.tm&&t.originalEvent.touches.length>1){i=!1;o();return}r=getMousePosEvent(u);n.npos=r.clone();l(r);ebook.SingleView.setZoomPageAbsolutePos(e);ebook.SingleView.setLargeImagePos();t.preventDefault()}),u.preventDefault(),!1})),ebook.SingleView.ZoomSlide.setSlideHandlePosByPer=u,ebook.SingleView.ZoomSlide.setSlideHandlePosByScale=s,c(),s(ebook.SingleView.zoomPage_scale),this};$.fn.clicks=function(n){return this.each(function(){clicks(this,n)})};var pageHintImageSize={x:200,y:260},pageHintImageUrl="https://www.ebook5.net/v2.1/hintImage/",pageHintLinkUrl="https://www.ebook5.net/summary/func.html#v5",pageHintLinkUrlSp="https://www.ebook5.net/summary/func.html#func_sp",pageHintInfoUrl="https://www.ebook5.net/v2.1/bannerInfov5/?callback=?",showPageHint_visible=!1;ebook.Linkmap={};ebook.Linkmap.data={JQ_all_linkmap:"#stage *[data-rel=_linkmap_base]",JQ_allfade_linkmap:" a[data-rel=_linkmap_base]",_d:0};ebook.Linkmap.private={};ebook.Linkmap.data.typeFuncs={};ebook.Linkmap.data.typeFuncs.link=function(n){return ebook.Linkmap.makeLinkRect(n.dat,n.pagenum,n.linkseq)};ebook.Linkmap.data.typeFuncs.youtube=function(n){return ebook.Linkmap.makeYoutubeRect(n.dat,n.pagenum,n.linkseq)};ebook.Linkmap.data.typeFuncs.video=function(n){return ebook.Linkmap.makeVideoRect(n.dat,n.pagenum,n.linkseq,n.target)};ebook.Linkmap.data.typeFuncs.googlemapv3=function(n){return ebook.Linkmap.makeGoogleMapV3Rect(n.dat,n.pagenum,n.linkseq)};ebook.Linkmap.data.typeFuncs.googlemap=function(n){return ebook.Linkmap.makeGoogleMapRect(n.dat,n.pagenum,n.linkseq)};ebook.Linkmap.private.reqcount=[];ebook.Linkmap.private.maped=!1;ebook.Linkmap.removeLinkMap=function(){$(ebook.Linkmap.data.JQ_all_linkmap).remove();ebook.Linkmap.private.maped=!1};ebook.Linkmap.private.startTarget=!1;ebook.Linkmap.private.lastTarget=!1;ebook.Linkmap.private.fadestart=!1;ebook.Linkmap.fadeInTime=1e3;ebook.Linkmap.linkFadeProcess=function(){function n(){var t;if(ebook.Linkmap.private.startTarget)ebook.Linkmap.private.lastTarget=ebook.Linkmap.private.startTarget,ebook.Linkmap.private.startTarget=!1,t=new Date,ebook.Linkmap.private.fadestart=t.getTime();else if(ebook.Linkmap.private.lastTarget){var i=ebook.Linkmap.private.fadestart,t=new Date,r=t.getTime()-i;ebook.Linkmap.fadeInTime<r&&($(ebook.Linkmap.data.JQ_allfade_linkmap,ebook.Linkmap.private.lastTarget).each(function(){$(this).hasClass("nofade")||$(this).stop(!0).css({opacity:1}).animate({opacity:0},300)}),ebook.Linkmap.private.lastTarget=!1)}setTimeout(n,100)}setTimeout(n,100)};ebook.Linkmap.makeLinkMapPage=function(n,t){var i=new Size(ebook.PageFlipper.diaplayPage_size.width,ebook.PageFlipper.diaplayPage_size.height),r=new Position(ebook.PageFlipper.diaplayPage_offset.left+(t?0:ebook.PageFlipper.diaplayPage_size.width),ebook.PageFlipper.diaplayPage_offset.top);ebook.Linkmap.makeLinkMapPage_sub($("#canvas .linkwrap"),n,r,i)};ebook.Linkmap.makeLinkMapPage_bparam=!1;ebook.Linkmap.makeLinkMapPage_sub=function(n,t,i,r,u){ebook.Linkmap.private.startTarget=n;u=typeof u==_undefined?!1:u;ebook.Linkmap.private.reqcount[t]=(ebook.Linkmap.private.reqcount[t]||0)+1;setTimeout($.proxy(ebook.Linkmap.makeLinkMapPage_sub_delay,{removeOnly:!1,_target:n.selector,_pagenum:t,_pos:i,_psize:r,withRemove:u}),100)};ebook.Linkmap.makeLinkMapPage_sub_delay=function(){var i=$(this._target),n=this._pagenum,f=this._pos,e=this._psize,p=this.withRemove||!1,t,r,o,v,c,l,u,y,s,a,h;if(this.removeOnly===!0){ebook.Linkmap.makeLinkMapPage_bparam=!1;ebook.Linkmap.removeLinkMap();return}if(typeof ebook.Linkmap.private.reqcount[n]!=_undefined&&(ebook.Linkmap.private.reqcount[n]=ebook.Linkmap.private.reqcount[n]-1,!(ebook.Linkmap.private.reqcount[n]>0))&&(t=ebook.Linkmap.makeLinkMapPage_bparam||!1,r=!1,!t||(r=t._target.selector||!1,!r||t.selector!=r||t._pagenum!=n||t._pos.left!=f.left||t._pos.top!=f.top||t._psize.width!=e.width||t._psize.height!=e.height))){if(o=!1,t&&r&&t.selector==r&&t._pagenum==n&&(o=!0),o||p!==!0||ebook.Linkmap.removeLinkMap(),v=i.selector||!1,ebook.Linkmap.makeLinkMapPage_bparam={selector:v,_target:i,_pagenum:n,_pos:f.clone(),_psize:e.clone()},ebook.Linkmap.private.reqcount[n]=0,ebook.Linkmap.private.maped=!0,ebook.Linkmap.private.psize=e,ebook.Linkmap.private.pos=f,n++,ebook.Linkmap.stopAllVideoOnLinkMap(),typeof ebook.BookData.pageLinkContents!="undefined"&&ebook.BookData.pageLinkContents[n]){c=ebook.BookData.pageLinkContents[n];for(l in c)u=c[l]||{},y=(u.type||"link").toLowerCase(),u.rect&&(s=parseInt(l)+1,a=ebook.Linkmap.data.typeFuncs[y]||!1,a&&(o?$("*[_linkseq="+s+"]",i).each(function(){ebook.Linkmap.updateLinkRect(this,u,n,s)}):(h=a({dat:u,pagenum:n,linkseq:s,target:i}),h!=!1&&typeof h!=_undefined&&h.appendTo(i))))}$("a",i).addClass("op0");setTimeout(function(){$("a",i).removeClass("op0")},200)}};ebook.Linkmap.stopAllVideoOnLinkMap=function(){$(ebook.Linkmap.data.JQ_all_linkmap).each(function(){this.tagName.toLowerCase()==="video"&&(this.player&&typeof this.player.pause=="function"?this.player.pause():typeof this.pause=="function"&&this.pause())})};ebook.Linkmap.makeVideoRect=function(n,t,i,r){function v(n,t){var i=$("<source />"),r=t.src||!1,u=t.type||!1;r&&i.attr("src",r);u&&i.attr("type",u);n.append(i)}function y(n){narrowToolsHideDelay();var t=$(this).attr("_pagenum"),i=$(this).attr("_linkseq");ebook.BookData.LinkClickCallBack(t,i);this.paused!=_undefined&&(this.paused===!0?typeof this.play=="function"&&(this.play(),n.preventDefault()):typeof this.pause=="function"&&(this.pause(),n.preventDefault()))}var e=n.rect,u={},o=ebook.Linkmap.private.psize,l=ebook.Linkmap.private.pos,a,f,h,c,s;if(u.top=e.top||0,u.left=e.left||0,u.width=e.width||100,u.height=e.height||100,u.title=n.title||null,u.source=n.source||null,u["class"]=n["class"]||null,u.hoverclass=n.hoverclass||null,u.option=n.option||"",u.poster=n.poster||null,u["class"]=n["class"]||null,u.init_callback=n.init_callback||null,a='<video data-rel="_linkmap_base" class="nofade" '+u.option+" ><p><\/p><\/video>",f=$(a).clone(!0),f.css({width:MathRound(o.width*u.width/100)+"px",height:MathRound(o.height*u.height/100)+"px",left:MathRound(l.left+o.width*u.left/100)+"px",top:MathRound(l.top+o.height*u.top/100)+"px","z-index":800,position:"absolute",overflow:"hidden",display:"block"}),h="_video_"+t+"_"+i,n.id=h,f.attr("id",h),u.title&&f.attr("title",u.title),u.poster&&f.attr("poster",u.poster),u["class"]&&f.addClass(u["class"]),f.attr({_pagenum:t,_linkseq:i}),u.source)if(u.source[0]||!1)for(c=u.source||[],s=0;s<c.length;s++)v(f,c[s]);else v(f,u.source);return f[0].addEventListener("click",y),f.appendTo(r),u.init_callback&&typeof u.init_callback=="function"&&u.init_callback(f,n),!1};ebook.Linkmap.makeYoutubeRect=function(n,t,i){var f=n.viewsize||{width:640,height:400},e=n.poster||null,o=n.title||!1,s=n.css||!1,u=n.youtube_id||!1,v=n["class"]||!1,h=n.url||!1,r;if(!h&&!u)return!1;if(!h&&u&&(n.url=ebook.BookData.youtubeDefaultUrl.replace("(ID:)",u)),r=ebook.Linkmap.makeLinkRectSub(n,t,i,function(n){var t,i;narrowToolsHideDelay();var r=$(n.obj).attr("data-ref"),u=$(n.obj).attr("viewsize_height"),f=$(n.obj).attr("viewsize_width");displayYoutubeLayer(r,f,u);t=$(n.obj).attr("_pagenum");i=$(n.obj).attr("_linkseq");ebook.BookData.LinkClickCallBack(t,i)}),r.attr({viewsize_height:f.height,viewsize_width:f.width,target:""}),s&&r.css(s),e){var c=r.width(),l=r.height(),a=$('<img src="'+e+'" border="0" style="width:'+c+"px;height:"+l+'px;" '+(o?'alt="'+o+'"':"")+">").setDisableSelection().on(leb.e.md+" "+leb.e.ts,function(n){n.preventDefault()});r.append(a).addClass("nofade")}return r};ebook.Linkmap.makeLinkRect=function(n,t,i,r){var u=ebook.Linkmap.makeLinkRectSub(n,t,i,function(n){if(!ebook.BookData.linkopenNatural){var r=$(n.obj).attr("data-ref"),u=$(n.obj).attr("xtarget");window.open(r,u)}return ebook.BookData.LinkClickCallBack(t,i),ebook.BookData.linkopenNatural?void 0:!1},r),f=$(u).attr("data-ref"),e=$(u).attr("xtarget");return u};ebook.Linkmap.updateLinkRect=function(n,t,i,r,u){var e=t.rect,f={},o=ebook.Linkmap.private.psize,c=ebook.Linkmap.private.pos,s,h;f.top=e.top||0;f.left=e.left||0;f.width=e.width||100;f.height=e.height||100;s=MathRound(o.width*f.width/100);h=MathRound(o.height*f.height/100);$(n).css({width:s+"px",height:h+"px",left:MathRound(c.left+o.width*f.left/100)+"px",top:MathRound(c.top+o.height*f.top/100)+"px"}).attr({width:s,height:h})};ebook.Linkmap.makeLinkRectSub=function(n,t,i,r,u,f){var a,v,l,y;u||(u="a");f||(f=!1);var w=$("<"+u+' class="" data-rel="_linkmap_base" style="z-index:800;position:absolute;overflow:hidden;display:block;"><\/'+u+">"),o=$(w.clone(!0)),b=n.type||"link",s=n.rect,e={},h=ebook.Linkmap.private.psize,p=ebook.Linkmap.private.pos,c=b=="link"&&ebook.BookData.linkopenNatural;if(e.top=s.top||0,e.left=s.left||0,e.width=s.width||100,e.height=s.height||100,e.url=n.url||null,e.target=n.target||"_self",e["class"]=n["class"]||"linkmapclass",e.hoverclass=n.hoverclass||null,e["class"]&&o.addClass(e["class"]),a=MathRound(h.width*e.width/100),v=MathRound(h.height*e.height/100),o.css({width:a+"px",height:v+"px",left:MathRound(p.left+h.width*e.left/100)+"px",top:MathRound(p.top+h.height*e.top/100)+"px"}),o.attr({width:a,height:v}),o.attr({_pagenum:t,_linkseq:i}),n.title&&o.attr("title",n.title),n.poster&&o.attr("poster",n.poster),e.url){l={c:e["class"],h:e.hoverclass,xtarget:e.target,"data-ref":e.url};c&&(e.target&&(l.target=e.target),l.href=e.url);o.css("cursor","pointer").attr(l);e.hoverclass&&(o.hover(function(){var n=$(this).attr("c"),t=$(this).attr("h");n&&$(this).removeClass(n);$(this).addClass(t)},function(){var n=$(this).attr("c"),t=$(this).attr("h");$(this).removeClass(t);n&&$(this).addClass(n)}),c||o.click(function(n){return!1}));y=function(){this.param.hd_timer=!1;this.param.clickcnt=0;r&&r(this)};function k(n,t){return(t.ntime=new Date,t.movecnt=0,t.clickcnt++,t.clickcnt>1&&t.hd_timer!=!1)?(clearTimeout(t.hd_timer),t.hd_timer=!1,!1):!0}function d(n,t){var u,f,i;if(!(t.movecnt>4))return narrowToolsHideDelay(),u=new Date,f=u.getTime()-t.ntime.getTime(),f>400?(i=this,$.proxy(y,{obj:i,param:t})(n)):t.hd_timer==!1&&(i=this,logw(r),t.hd_timer=setTimeout($.proxy(y,{obj:i,param:t}),500)),c||n.preventDefault(),!0}function g(n,t){t.movecnt++}return f||(c?o.click(function(n){r&&r(this)}):clicks(o,{param:{clickcnt:0,hd_timer:!1},timeout:0,end_func:d,start_func:k,move_func:g})),o}};makeLinkMapPage=ebook.Linkmap.makeLinkMapPage;makeLinkMapPage_sub=ebook.Linkmap.makeLinkMapPage_sub;ebook.Linkmap.loadedGoogleMapV3=!1;ebook.Linkmap.GoogleMap_loadCallback=function(){};ebook.Linkmap.makeGoogleMapV3Rect=function(n,t,i){var o=n.viewsize||{width:640,height:400},v=n.title||!1,s=n.css||!1,y=n["class"]||!1,h=n.latitude||!1,c=n.longitude||!1,f,e,a;if(!h&&!c)return!1;n.url=ebook.BookData.googlemapApiV3DefaultUrl;var r=ebook.Linkmap.makeLinkRectSub(n,t,i,function(n){var t,i,r;ebook.Linkmap.GoogleMap_loadCallback=function(){var i=$(n.obj).attr("latitude"),r=$(n.obj).attr("longitude"),u=$(n.obj).attr("_zoom")||!1,o=$(n.obj).attr("_mapTypeId")||"ROADMAP",s=$(n.obj).attr("title"),h=$(n.obj).attr("_markertitle")||s,f={center:new google.maps.LatLng(i,r),mapTypeId:google.maps.MapTypeId[o]},t,e;u!=!1&&(f.zoom=parseInt(u));t=new google.maps.Map($("#ebookGoogleMap_canvas").get(0),f);e=new google.maps.Marker({position:new google.maps.LatLng(i,r),map:t,title:h});typeof n.obj.mapinitCallback=="function"&&n.obj.mapinitCallback(t,e)};narrowToolsHideDelay();var u=$(n.obj).attr("data-ref"),f=$(n.obj).attr("viewsize_height"),e=$(n.obj).attr("viewsize_width");displayGoogleMapLayer(u,e,f);ebook.Linkmap.loadedGoogleMapV3?ebook.Linkmap.GoogleMap_loadCallback():(t=ebook.Compatibility.isTabletDevice||ebook.Compatibility.isSmartPhone,ebook.Linkmap.GoogleMap_loadScript("ebook.Linkmap.GoogleMap_loadCallback",t));i=$(n.obj).attr("_pagenum");r=$(n.obj).attr("_linkseq");ebook.BookData.LinkClickCallBack(i,r)}),u={viewsize_height:o.height,viewsize_width:o.width,target:"",latitude:h,longitude:c},l=n.mapinitCallback||!1;return l!=!1&&(r.get(0).mapinitCallback=l),f=n.markertitle||!1,f!=!1&&(u._markertitle=f),e=n.zoom||12,e!=!1&&(u._zoom=e),a=n.mapTypeId||!1,a!=!1&&(u._mapTypeId=f),r.attr(u),s&&r.css(s),r};ebook.Linkmap.GoogleMap_loadScript=function(n,t){ebook.Linkmap.loadedGoogleMapV3=!0;var i=document.createElement("script");i.type="text/javascript";i.src=ebook.BookData.googlemapApiV3DefaultUrl+"sensor="+t+"&callback="+n;document.body.appendChild(i)};ebook.Linkmap.makeGoogleMapRect=function(n,t,i){var u=n.viewsize||{width:640,height:400},s=n.title||!1,f=n.css||!1,h=n["class"]||!1,o=n.url||!1,r,e;return o?(r=ebook.Linkmap.makeLinkRectSub(n,t,i,function(n){var i,r,u;narrowToolsHideDelay();var t=$(n.obj).attr("data-ref"),f=$(n.obj).attr("viewsize_height"),e=$(n.obj).attr("viewsize_width");displayGoogleMapLayer(t,e,f);try{i=$(t).attr({width:"100%",height:"100%"});$("#ebookGoogleMap_canvas").append(i)}catch(o){}r=$(n.obj).attr("_pagenum");u=$(n.obj).attr("_linkseq");ebook.BookData.LinkClickCallBack(r,u)}),e={viewsize_height:u.height,viewsize_width:u.width,target:""},r.attr(e),f&&r.css(f),r):!1},function(n){function r(t){var i=t||window.event,e=[].slice.call(arguments,1),r=0,o=!0,f=0,u=0;return t=n.event.fix(i),t.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),u=r,i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS&&(u=0,f=-1*r),i.wheelDeltaY!==undefined&&(u=i.wheelDeltaY/120),i.wheelDeltaX!==undefined&&(f=i.wheelDeltaX/-120),e.unshift(t,r,f,u),(n.event.dispatch||n.event.handle).apply(this,e)}var t=["DOMMouseScroll","mousewheel"],i;if(n.event.fixHooks)for(i=t.length;i;)n.event.fixHooks[t[--i]]=n.event.mouseHooks;n.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var n=t.length;n;)this.addEventListener(t[--n],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var n=t.length;n;)this.removeEventListener(t[--n],r,!1);else this.onmousewheel=null}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})}(jQuery)